1
00:00:01,516 --> 00:00:04,500
[音乐]


2
00:00:06,516 --> 00:00:13,556
[掌声]


3
00:00:14,056 --> 00:00:14,916
>> 下午好 欢迎各位


4
00:00:14,916 --> 00:00:16,456
参加今天的“订阅优惠的最佳实践”会议


5
00:00:17,176 --> 00:00:18,046
我是 Ross LaBeau


6
00:00:18,046 --> 00:00:19,396
我是 App Store 团队的一名工程师


7
00:00:20,206 --> 00:00:21,086
今天我们将深入地了解


8
00:00:21,086 --> 00:00:22,646
App Store 中


9
00:00:22,646 --> 00:00:23,946
App 内购买项目的最新特性


10
00:00:26,496 --> 00:00:28,556
订阅提供者


11
00:00:28,556 --> 00:00:29,726
可通过订阅优惠


12
00:00:29,726 --> 00:00:31,016
这一全新的方式


13
00:00:31,016 --> 00:00:32,476
为用户提供


14
00:00:32,476 --> 00:00:34,386
特定时长的折扣价格


15
00:00:35,836 --> 00:00:37,996
我们知道


16
00:00:38,266 --> 00:00:41,076
用户流失是订阅 App


17
00:00:41,236 --> 00:00:42,016
利润下降的主要原因之一


18
00:00:42,946 --> 00:00:44,516
这是一个强大的新工具


19
00:00:44,516 --> 00:00:46,646
通过留住用户


20
00:00:47,046 --> 00:00:49,316
或赢回已经流失的用户


21
00:00:49,316 --> 00:00:50,856
来帮助减少用户流失


22
00:00:51,526 --> 00:00:54,336
订阅优惠


23
00:00:54,336 --> 00:00:55,486
最酷的地方在于


24
00:00:55,486 --> 00:00:56,826
你可以选择何时


25
00:00:56,826 --> 00:00:58,216
向用户提供优惠


26
00:00:58,216 --> 00:00:59,246
以及向他们展示哪些优惠


27
00:01:00,176 --> 00:01:03,576
例如 如果你刚刚收到一条


28
00:01:04,056 --> 00:01:05,656
服务器对服务器的自动续订通知


29
00:01:05,656 --> 00:01:10,026
一位用户已经取消了自动续订


30
00:01:10,026 --> 00:01:13,166
你想在即刻采取行动


31
00:01:13,166 --> 00:01:15,226
并给予他优惠


32
00:01:15,226 --> 00:01:16,896
例如为期三个月的半价订阅


33
00:01:16,896 --> 00:01:18,436
从而让用户继续使用你的 App 并保持订阅


34
00:01:21,356 --> 00:01:22,726
与试用优惠不同的是


35
00:01:23,006 --> 00:01:24,476
用户可以在你的允许下


36
00:01:24,476 --> 00:01:25,496
多次兑换订阅优惠


37
00:01:25,496 --> 00:01:27,276
他们甚至可以


38
00:01:27,276 --> 00:01:28,226
多次兑换同一优惠


39
00:01:28,716 --> 00:01:33,226
App Store 提出的唯一条件是


40
00:01:33,226 --> 00:01:34,756
用户必须


41
00:01:34,756 --> 00:01:36,076
正在自动续订


42
00:01:36,106 --> 00:01:37,706
或者订阅过你的 App


43
00:01:41,666 --> 00:01:43,426
今天我们将介绍


44
00:01:43,426 --> 00:01:44,606
在 App Store Connect 中


45
00:01:44,606 --> 00:01:45,276
创建这些优惠的具体设置


46
00:01:47,416 --> 00:01:48,466
我们将讨论如何生成


47
00:01:48,466 --> 00:01:49,906
在每次交易中


48
00:01:49,906 --> 00:01:51,636
你都需要发送的密码签名


49
00:01:53,056 --> 00:01:54,456
我们也将谈到新的 StoreKit API


50
00:01:54,456 --> 00:01:56,136
以及如何使用它们


51
00:01:56,176 --> 00:01:58,236
向 App Store 发送一个交易


52
00:01:58,236 --> 00:01:59,500
并进行一次购买


53
00:02:02,556 --> 00:02:04,016
我们将从 App Store 的角度


54
00:02:04,016 --> 00:02:05,216
以及如何创建你的


55
00:02:05,216 --> 00:02:06,696
自定义业务规则的角度


56
00:02:06,696 --> 00:02:08,586
来讨论用户的资格审查


57
00:02:09,735 --> 00:02:12,066
我们将提供一些提示和技巧


58
00:02:12,066 --> 00:02:13,386
帮助你给你的用户


59
00:02:13,386 --> 00:02:14,656
分配和营销这些优惠


60
00:02:15,196 --> 00:02:18,346
最后 我们将讨论


61
00:02:18,346 --> 00:02:19,836
更多关于如何


62
00:02:19,836 --> 00:02:20,536
减少用户流失的商业策略


63
00:02:25,056 --> 00:02:26,456
首先 就像试用优惠一样


64
00:02:26,456 --> 00:02:27,866
你需要在 App Store Connect 中


65
00:02:27,866 --> 00:02:28,946
设置订阅优惠


66
00:02:29,816 --> 00:02:32,416
进入“功能”选项卡下的


67
00:02:32,416 --> 00:02:34,046
“App 内购买”


68
00:02:34,466 --> 00:02:36,436
之后选择任一自动续订的订阅选项


69
00:02:37,986 --> 00:02:39,066
然后点按“订阅价格”


70
00:02:39,066 --> 00:02:40,776
旁边的加号按钮


71
00:02:40,776 --> 00:02:41,976
选择“创建促销优惠”


72
00:02:45,306 --> 00:02:46,356
在这里 你可以输入


73
00:02:46,356 --> 00:02:48,236
易于理解的优惠名称


74
00:02:48,236 --> 00:02:49,476
以及产品代码


75
00:02:50,176 --> 00:02:51,546
这个产品代码


76
00:02:51,546 --> 00:02:52,476
也就是标识符


77
00:02:53,446 --> 00:02:55,586
从这开始 你将使用这个特定的标识符


78
00:02:55,586 --> 00:02:56,846
来指代这个优惠


79
00:02:58,216 --> 00:02:59,696
之后就和试用优惠的设置


80
00:02:59,696 --> 00:03:00,406
非常相似了


81
00:03:00,666 --> 00:03:02,116
你需要选择类型


82
00:03:02,116 --> 00:03:03,166
时长以及价格


83
00:03:03,636 --> 00:03:04,926
除了设置这些优惠之外


84
00:03:05,546 --> 00:03:08,696
你还需要设置一个私钥


85
00:03:08,696 --> 00:03:10,216
以便生成之前提及的签名


86
00:03:10,216 --> 00:03:13,146
我们之后再进一步讨论这个签名


87
00:03:13,146 --> 00:03:15,116
创建你的私钥


88
00:03:15,856 --> 00:03:16,816
你需要进入


89
00:03:16,816 --> 00:03:18,156
App Store Connect 的“用户与访问”


90
00:03:19,066 --> 00:03:20,286
选择“密钥”


91
00:03:20,286 --> 00:03:21,816
并确保选择左侧的“订阅”


92
00:03:22,246 --> 00:03:24,286
点按加号按钮


93
00:03:25,576 --> 00:03:26,816
输入易于理解的密钥的名字


94
00:03:26,816 --> 00:03:27,976
并点按“生成”


95
00:03:32,476 --> 00:03:33,756
之后你就可以


96
00:03:33,756 --> 00:03:35,276
在上方的“活跃”密钥列表中


97
00:03:35,526 --> 00:03:36,176
发现这个新建的密钥


98
00:03:37,276 --> 00:03:38,176
你也会发现


99
00:03:38,176 --> 00:03:39,686
App Store Connect 已经为它生成了


100
00:03:39,686 --> 00:03:40,956
一个密钥 ID


101
00:03:41,206 --> 00:03:42,156
这也是一个


102
00:03:42,156 --> 00:03:43,276
特定的标识符


103
00:03:43,276 --> 00:03:43,976
用来在 StoreKit 中引用这个密钥


104
00:03:47,046 --> 00:03:47,666
现在你可以


105
00:03:47,666 --> 00:03:48,836
下载你的私钥


106
00:03:49,276 --> 00:03:50,246
只需点按“下载密钥”


107
00:03:50,756 --> 00:03:51,976
但是重要的一点需要注意


108
00:03:51,976 --> 00:03:54,446
你仅可以下载一次这个密钥


109
00:03:55,356 --> 00:03:56,816
没有错 只有一次


110
00:03:57,736 --> 00:03:58,986
一旦你下载了它


111
00:03:58,986 --> 00:03:59,966
App Store Connect 将会


112
00:03:59,966 --> 00:04:01,256
永久地从 Apple 服务器中删除它


113
00:04:01,256 --> 00:04:04,076
这么处理的原因是


114
00:04:04,076 --> 00:04:07,626
这些密钥是非常敏感的加密信息


115
00:04:08,226 --> 00:04:10,196
这个私钥就像是你的身份


116
00:04:10,316 --> 00:04:12,786
它被用来证明授权用户


117
00:04:12,786 --> 00:04:14,976
兑换这笔交易的是你本人


118
00:04:20,236 --> 00:04:21,716
如果你在你的所有 App 中


119
00:04:21,716 --> 00:04:23,516
以及为这些 App 设置的优惠中


120
00:04:23,666 --> 00:04:25,176
都使用了同一个密钥


121
00:04:25,176 --> 00:04:27,216
那么这些密钥将在


122
00:04:27,216 --> 00:04:28,776
你的整个开发者帐户中生效


123
00:04:29,926 --> 00:04:31,336
但是你也可以按照喜好


124
00:04:31,336 --> 00:04:31,996
使用多个密钥


125
00:04:32,546 --> 00:04:33,756
如果你使用


126
00:04:33,756 --> 00:04:35,296
一个开发者帐户来服务


127
00:04:35,566 --> 00:04:37,046
多个 App 或不同的业务组分


128
00:04:37,046 --> 00:04:40,706
那么你可以创建多个密钥


129
00:04:40,706 --> 00:04:42,566
来将它们分割开


130
00:04:42,816 --> 00:04:44,516
就像我所提到的


131
00:04:44,656 --> 00:04:47,416
每笔交易都需要一个加密签名


132
00:04:47,416 --> 00:04:48,686
你需要把它发送到 App Store


133
00:04:48,686 --> 00:04:48,936
来兑换优惠


134
00:04:51,546 --> 00:04:52,716
现在 为了确保只有授权用户才能兑换优惠


135
00:04:52,716 --> 00:04:55,866
我们需要做出如下的设置


136
00:04:56,846 --> 00:04:58,766
使用有效载荷生成一个签名


137
00:04:58,766 --> 00:05:00,766
你同样需要将这个有效载荷


138
00:05:00,766 --> 00:05:01,386
发送到 App Store


139
00:05:02,396 --> 00:05:05,116
这个签名运用了一个叫“非对称加密”的东西


140
00:05:05,736 --> 00:05:09,376
非对称加密 是一个十分常见的技术


141
00:05:09,426 --> 00:05:10,976
它使用两个密钥来生成


142
00:05:10,976 --> 00:05:12,996
并验证签名


143
00:05:12,996 --> 00:05:14,616
而不仅仅是我们刚才讨论的私钥


144
00:05:15,276 --> 00:05:16,596
我们使用私钥作为你身份的证明


145
00:05:16,596 --> 00:05:18,366
来签署你的有效载荷


146
00:05:18,366 --> 00:05:21,646
第二个密钥 叫做公钥


147
00:05:22,666 --> 00:05:23,546
就像它的字面意思


148
00:05:23,616 --> 00:05:25,276
这个公钥实际上


149
00:05:25,276 --> 00:05:26,016
可以显示给其他人


150
00:05:26,186 --> 00:05:27,936
你不能用它 生成任何签名


151
00:05:28,566 --> 00:05:29,406
使用公钥所能做的一切


152
00:05:29,406 --> 00:05:31,596
就是证明该签名


153
00:05:31,676 --> 00:05:33,106
是用你的私钥生成的


154
00:05:33,106 --> 00:05:34,966
并与你用来签署的


155
00:05:34,966 --> 00:05:35,496
有效负载匹配


156
00:05:39,046 --> 00:05:40,346
由于生成签名


157
00:05:40,776 --> 00:05:42,056
需要使用你的私钥


158
00:05:42,526 --> 00:05:43,596
所以你应该始终在


159
00:05:43,596 --> 00:05:45,256
安全服务器上进行


160
00:05:45,256 --> 00:05:46,516
而不是从设备本身进行


161
00:05:46,516 --> 00:05:47,356
因为你一定不想


162
00:05:47,736 --> 00:05:49,086
将这段加密信息


163
00:05:49,086 --> 00:05:50,516
放在其他人的硬件上


164
00:05:51,706 --> 00:05:53,106
我们现在看一看


165
00:05:53,106 --> 00:05:54,806
我们利用 NodeJS 和 Express


166
00:05:54,806 --> 00:05:55,966
构建的服务器


167
00:05:56,156 --> 00:05:58,066
这实际上是可以


168
00:05:58,066 --> 00:05:59,406
在网上下载到的示例代码


169
00:06:00,566 --> 00:06:01,746
如果你不使用 JavaScript


170
00:06:01,826 --> 00:06:02,286
也不用担心


171
00:06:03,056 --> 00:06:04,216
这里展示的一切成果


172
00:06:04,216 --> 00:06:05,706
都可以以其他语言完成


173
00:06:06,046 --> 00:06:09,206
比如 Python PHP Java Swift 等等


174
00:06:09,206 --> 00:06:10,546
选择哪个都可以


175
00:06:14,346 --> 00:06:15,976
第一步


176
00:06:15,976 --> 00:06:17,246
当你的 App


177
00:06:17,246 --> 00:06:18,746
准备好向用户展示优惠时


178
00:06:18,746 --> 00:06:19,806
你需要将这个请求


179
00:06:19,806 --> 00:06:20,806
发送到服务器


180
00:06:20,806 --> 00:06:21,686
然后生成一个签名


181
00:06:23,336 --> 00:06:25,276
在本例中


182
00:06:25,276 --> 00:06:26,316
App 已经知道我们想要签署的


183
00:06:26,366 --> 00:06:28,366
几个有效载荷


184
00:06:28,366 --> 00:06:29,216
因此我们仅需


185
00:06:29,216 --> 00:06:31,066
在请求中的主题部分获取它们


186
00:06:32,486 --> 00:06:33,386
我们将获得 App 的


187
00:06:33,386 --> 00:06:36,006
套装标识符


188
00:06:36,006 --> 00:06:37,666
订阅的产品标识符


189
00:06:38,786 --> 00:06:39,876
以及优惠标识符


190
00:06:39,876 --> 00:06:41,146
对应的是你将展示给


191
00:06:41,356 --> 00:06:43,546
用户的优惠


192
00:06:43,626 --> 00:06:46,516
最后我们会得到一个哈希 App 用户名


193
00:06:47,426 --> 00:06:50,116
这是一个单向排序的安全哈希值


194
00:06:50,116 --> 00:06:53,696
包含一些关于用户的标识信息


195
00:06:54,146 --> 00:06:55,316
也许是他们在你的 App 中的用户名


196
00:06:55,316 --> 00:06:55,946
或者他们的邮箱


197
00:06:57,056 --> 00:06:57,956
但很重要的一点是


198
00:06:57,956 --> 00:06:59,106
你要对它进行哈希 处理


199
00:06:59,106 --> 00:07:01,196
并且永远不要把纯文本标识信息


200
00:07:01,196 --> 00:07:02,236
发送到 App Store


201
00:07:02,736 --> 00:07:03,586
你需要在自己的数据库中


202
00:07:03,586 --> 00:07:03,976
保持这种安全性


203
00:07:07,336 --> 00:07:08,336
下一个有效载荷


204
00:07:08,336 --> 00:07:09,426
叫做“nonce”（唯一性参数）


205
00:07:10,586 --> 00:07:12,386
这只是一个随机的数据片段


206
00:07:12,386 --> 00:07:15,486
以确保没有两个交易是相同的


207
00:07:15,486 --> 00:07:20,486
我们使用它来防止重放攻击


208
00:07:20,486 --> 00:07:21,446
和其他绕过它的方法


209
00:07:21,446 --> 00:07:23,486
如此用户将不能重新发送相同的请求


210
00:07:23,486 --> 00:07:25,606
在没有你的批准下


211
00:07:25,606 --> 00:07:26,636
获得多次的免费订阅


212
00:07:27,196 --> 00:07:30,006
App Store 使用


213
00:07:30,006 --> 00:07:31,476
版本为 4 的 UUID


214
00:07:31,476 --> 00:07:31,966
这就是我们要创建的


215
00:07:34,146 --> 00:07:35,216
然后我们会得到一个时间戳


216
00:07:36,136 --> 00:07:37,306
这是自 Unix Epoch 格式以来的


217
00:07:37,306 --> 00:07:39,346
以毫秒为单位的时间戳


218
00:07:40,506 --> 00:07:42,256
这是一个十分常用的格式


219
00:07:42,256 --> 00:07:43,396
你可以看到


220
00:07:43,396 --> 00:07:44,466
在 JavaScript 中生成它十分容易


221
00:07:45,876 --> 00:07:47,336
这个时间戳


222
00:07:47,336 --> 00:07:49,196
也被用来帮助阻止攻击


223
00:07:50,226 --> 00:07:54,066
重要的是你所做的每一笔交易


224
00:07:54,066 --> 00:07:55,916
将只在该时间戳之后的


225
00:07:56,026 --> 00:07:57,036
24 小时内被接受


226
00:07:57,496 --> 00:07:58,196
所以你不应该


227
00:07:58,196 --> 00:07:59,956
提前一周产生这些签名


228
00:08:05,046 --> 00:08:06,426
有效载荷的最后一部分


229
00:08:06,426 --> 00:08:07,086
是密钥 ID


230
00:08:07,346 --> 00:08:08,416
这个是 App Store Connect


231
00:08:08,416 --> 00:08:09,606
之前生成的密钥 ID


232
00:08:12,116 --> 00:08:13,276
我在这里植入了一个


233
00:08:13,276 --> 00:08:13,896
名为 getKeyID() 的函数


234
00:08:15,136 --> 00:08:16,116
我们要做的就是


235
00:08:16,116 --> 00:08:17,396
返回我们存储在


236
00:08:17,396 --> 00:08:18,916
环境变量中的密钥 ID


237
00:08:18,916 --> 00:08:22,796
我们这样做


238
00:08:22,796 --> 00:08:24,436
而不是将它提交到代码


239
00:08:24,436 --> 00:08:25,426
并将其放入存储库中


240
00:08:25,426 --> 00:08:26,226
是因为这样更安全


241
00:08:27,426 --> 00:08:28,346
暴露更少的弱点


242
00:08:30,266 --> 00:08:31,196
如果你只返回了


243
00:08:31,196 --> 00:08:33,436
一个密钥 ID


244
00:08:33,436 --> 00:08:34,476
但如果你使用多个密钥


245
00:08:34,476 --> 00:08:36,326
这实际上是实现逻辑的


246
00:08:36,326 --> 00:08:37,395
理想位置


247
00:08:38,905 --> 00:08:41,096
或者 如果你确定


248
00:08:41,096 --> 00:08:42,466
你的一个密钥被泄露了


249
00:08:42,466 --> 00:08:44,536
有人未经授权访问了它


250
00:08:44,536 --> 00:08:46,196
你可以在 App Store Connect 中禁用它


251
00:08:46,796 --> 00:08:49,506
你可以生成一个新密钥


252
00:08:49,546 --> 00:08:50,896
只需要切换这里的逻辑


253
00:08:50,896 --> 00:08:52,016
就可以使用这里的新密钥


254
00:08:52,016 --> 00:08:52,896
来签署它们


255
00:08:53,306 --> 00:08:56,756
你甚至不需要推送 App 更新


256
00:08:56,756 --> 00:08:57,596
这样你可以把停运时间降到最低


257
00:08:59,156 --> 00:09:00,536
现在我们已经有了所有


258
00:09:00,536 --> 00:09:01,846
要签署的有效载荷


259
00:09:02,796 --> 00:09:03,846
我们想把它们合并成


260
00:09:03,846 --> 00:09:05,966
一个数据块来生成签名


261
00:09:06,546 --> 00:09:09,336
现在你可以看到


262
00:09:09,336 --> 00:09:10,826
我们的方法是


263
00:09:10,986 --> 00:09:12,716
把它们按这个顺序组合成一个字符串


264
00:09:13,776 --> 00:09:16,056
我们使用字符


265
00:09:16,056 --> 00:09:17,376
将它们连接起来


266
00:09:17,376 --> 00:09:19,226
每个字符之间的代码点为“\u2063”


267
00:09:20,176 --> 00:09:21,386
好吧 我明白你们的疑惑


268
00:09:21,386 --> 00:09:22,196
为什么我们不使用空格呢


269
00:09:23,126 --> 00:09:25,406
十分重要的一点是


270
00:09:25,406 --> 00:09:26,896
当你生成


271
00:09:26,896 --> 00:09:27,846
或验证加密签名时


272
00:09:27,846 --> 00:09:29,286
你要非常精确地知道


273
00:09:29,286 --> 00:09:30,536
你使用的是哪个字符


274
00:09:31,096 --> 00:09:31,986
正如你们中的一些人可能知道的


275
00:09:31,986 --> 00:09:33,236
单词空格可以指


276
00:09:33,236 --> 00:09:35,056
多种不同类型的空白字符


277
00:09:35,796 --> 00:09:37,236
所以我们使用这个


278
00:09:40,046 --> 00:09:41,796
现在我们有了有效载荷


279
00:09:41,796 --> 00:09:43,316
下一步是得到密钥本身


280
00:09:44,066 --> 00:09:47,366
我们使用 getKeyStringForID(keyID)


281
00:09:49,386 --> 00:09:50,206
我们要做的就是检查


282
00:09:50,206 --> 00:09:51,736
确保密钥 ID


283
00:09:51,736 --> 00:09:52,926
和我们的期望匹配


284
00:09:52,926 --> 00:09:55,166
然后我们将从另一个环境变量


285
00:09:55,166 --> 00:09:56,416
返回密钥


286
00:09:56,416 --> 00:09:59,636
这里我使用的是


287
00:09:59,636 --> 00:10:00,676
字符串中的密钥


288
00:10:01,196 --> 00:10:03,036
它以 PEM 格式记录


289
00:10:04,046 --> 00:10:05,236
这是一个十分常见的格式


290
00:10:05,236 --> 00:10:06,166
App Store Connect


291
00:10:06,166 --> 00:10:07,736
会把它发送给你


292
00:10:08,086 --> 00:10:09,396
几乎任何第三方


293
00:10:09,396 --> 00:10:11,266
或第一方的库


294
00:10:11,266 --> 00:10:11,976
都能处理它


295
00:10:17,056 --> 00:10:18,516
我们有了密钥有效载荷


296
00:10:19,036 --> 00:10:19,936
我们准备好签署了


297
00:10:22,246 --> 00:10:23,826
我们在这里做的是


298
00:10:23,886 --> 00:10:25,416
创建一个椭圆曲线


299
00:10:25,416 --> 00:10:27,176
数字签名算法对象


300
00:10:27,176 --> 00:10:28,986
这听起来很神奇


301
00:10:28,986 --> 00:10:29,386
但很容易做到


302
00:10:29,386 --> 00:10:30,436
正如你所看到的


303
00:10:30,436 --> 00:10:32,336
这里只有一行使用了 NodeJS 中的


304
00:10:32,336 --> 00:10:33,786
JavaScript 语言的 ECKey 库代码


305
00:10:35,186 --> 00:10:36,826
其他语言的库


306
00:10:36,826 --> 00:10:37,756
也使它变得非常简单


307
00:10:39,056 --> 00:10:40,256
我们传入密钥字符串


308
00:10:40,256 --> 00:10:41,706
并告诉它 它是 PEM 格式


309
00:10:42,436 --> 00:10:44,776
我们将把这个


310
00:10:44,906 --> 00:10:46,606
cryptoSign 对象作为


311
00:10:46,606 --> 00:10:47,836
NodeJS 的加密库的一部分


312
00:10:48,676 --> 00:10:49,476
我们要告诉它


313
00:10:49,476 --> 00:10:51,196
使用 SHA256 哈希算法


314
00:10:52,236 --> 00:10:53,776
这是你一直应该使用的算法


315
00:10:53,776 --> 00:10:54,736
无论你使用什么库


316
00:10:54,736 --> 00:10:56,676
你都应该确保指定它


317
00:10:59,226 --> 00:11:00,346
接下来 我们把有效负载


318
00:11:00,346 --> 00:11:01,316
添加到这个 cryptoSign 对象


319
00:11:01,636 --> 00:11:02,636
它只是告诉我们


320
00:11:02,636 --> 00:11:04,336
这是我们用来生成签名的东西


321
00:11:07,216 --> 00:11:09,326
最终 生成签名


322
00:11:09,906 --> 00:11:12,236
这里的加密库


323
00:11:12,236 --> 00:11:13,296
在默认情况下


324
00:11:13,296 --> 00:11:15,996
以 DER 格式生成签名


325
00:11:17,096 --> 00:11:18,346
大多数情况都是这样的


326
00:11:18,346 --> 00:11:19,716
但如果你的库默认情况下


327
00:11:19,716 --> 00:11:21,216
不使用这个格式


328
00:11:21,216 --> 00:11:22,036
请确保在这里指定 DER


329
00:11:23,766 --> 00:11:25,186
它不会返回


330
00:11:25,186 --> 00:11:27,666
一大堆原始的加密字节


331
00:11:28,406 --> 00:11:29,696
我们要求它发送一个


332
00:11:29,696 --> 00:11:31,376
Base64 编码的字符串


333
00:11:32,306 --> 00:11:33,216
这使得将数据


334
00:11:33,216 --> 00:11:35,916
从服务器传输到设备


335
00:11:35,916 --> 00:11:37,016
非常容易


336
00:11:37,016 --> 00:11:39,446
这也是 StoreKit 使用的格式


337
00:11:44,346 --> 00:11:45,426
现在我们有了我们的签名


338
00:11:46,876 --> 00:11:49,886
下一步是做一些验证


339
00:11:49,886 --> 00:11:51,626
你不必每次


340
00:11:51,626 --> 00:11:53,606
都进行这种验证


341
00:11:53,606 --> 00:11:55,016
但是当你在自己的服务器上


342
00:11:55,016 --> 00:11:56,916
编写签名生成代码时


343
00:11:57,176 --> 00:11:58,226
这样做确实很有帮助


344
00:11:58,226 --> 00:12:00,886
只是为了确保没有错误


345
00:12:00,886 --> 00:12:01,766
或者什么奇怪的事情发生


346
00:12:02,786 --> 00:12:04,436
它的作用是


347
00:12:04,496 --> 00:12:05,906
基于你的私钥


348
00:12:05,906 --> 00:12:07,836
生成一个公钥


349
00:12:07,836 --> 00:12:08,966
然后像 App Store 一样


350
00:12:08,966 --> 00:12:09,516
验证你的签名和有效载荷


351
00:12:11,046 --> 00:12:13,186
最后 剩下的就是将签名


352
00:12:13,186 --> 00:12:15,176
连同我们在这里生成的


353
00:12:15,176 --> 00:12:16,196
这些有效负载片段


354
00:12:16,196 --> 00:12:17,576
包括 密钥 ID  nonce 和时间戳


355
00:12:17,576 --> 00:12:18,976
一起发送回设备


356
00:12:23,326 --> 00:12:24,286
现在你已经设置好服务器


357
00:12:24,286 --> 00:12:25,286
来生成这些签名


358
00:12:25,286 --> 00:12:28,976
下一步就是设置 App


359
00:12:28,976 --> 00:12:32,536
发出请求并发送交易


360
00:12:34,096 --> 00:12:36,076
首先要做的是


361
00:12:36,346 --> 00:12:37,696
获取优惠细节


362
00:12:38,086 --> 00:12:39,016
这些你当然都可在 App Store Connect 中


363
00:12:39,016 --> 00:12:42,766
通过 SKProducts 请求进行设置


364
00:12:45,326 --> 00:12:46,386
我们将添加一些代码


365
00:12:46,386 --> 00:12:47,756
来发送签名请求到服务器


366
00:12:47,756 --> 00:12:48,976
并运行我们刚刚讲过的代码


367
00:12:52,046 --> 00:12:53,066
具体执行时


368
00:12:53,066 --> 00:12:55,166
一个好的策略是


369
00:12:55,166 --> 00:12:56,566
在用户准备购买时


370
00:12:56,566 --> 00:12:57,966
发送签名请求


371
00:12:58,946 --> 00:13:00,536
我们建议你


372
00:13:00,536 --> 00:13:02,406
在展示你的故事线


373
00:13:02,406 --> 00:13:03,356
或向用户展示这个优惠之前


374
00:13:03,356 --> 00:13:04,006
发送签名请求


375
00:13:05,126 --> 00:13:06,236
这样做不仅是因为


376
00:13:06,236 --> 00:13:07,256
24 小时的


377
00:13:07,256 --> 00:13:09,006
时间戳限制


378
00:13:09,006 --> 00:13:09,736
还因为这样你就可以


379
00:13:09,776 --> 00:13:11,136
从自己的服务器中获得最新的业务逻辑


380
00:13:11,926 --> 00:13:13,536
你可能已经换了密钥


381
00:13:13,536 --> 00:13:14,886
或者你有了关于你的用户的


382
00:13:14,886 --> 00:13:16,086
新的资格信息


383
00:13:16,086 --> 00:13:17,296
从而使你决定


384
00:13:17,296 --> 00:13:18,276
是否向其发送优惠信息


385
00:13:18,986 --> 00:13:20,126
你希望所有这些


386
00:13:20,126 --> 00:13:20,976
都是最新的


387
00:13:24,066 --> 00:13:25,176
最后 我们将处理


388
00:13:25,176 --> 00:13:26,546
来自服务器的响应


389
00:13:26,546 --> 00:13:27,976
然后将交易发送到 App Store


390
00:13:32,486 --> 00:13:33,776
当你发出 SKProducts 请求时


391
00:13:33,776 --> 00:13:36,726
你将注意到在每个 SKProduct 上


392
00:13:36,726 --> 00:13:38,226
都有一个用于订阅优惠的新属性


393
00:13:38,626 --> 00:13:39,426
它就是 discounts


394
00:13:40,716 --> 00:13:43,596
这是一个 SKProductDiscount 对象数组


395
00:13:44,976 --> 00:13:46,076
你可能会认出


396
00:13:46,076 --> 00:13:47,606
SKProductDiscount


397
00:13:47,606 --> 00:13:48,646
因为它与我们用于


398
00:13:48,646 --> 00:13:50,006
试用优惠的模型相同


399
00:13:50,006 --> 00:13:50,586
因为它们非常相似


400
00:13:51,146 --> 00:13:53,486
你可以看到


401
00:13:53,486 --> 00:13:56,166
它有价格 订阅时长等信息


402
00:13:57,276 --> 00:13:58,616
但我们还为订阅优惠


403
00:13:58,616 --> 00:13:59,976
添加了两个新属性


404
00:14:02,576 --> 00:14:04,816
其中一个是 identifier


405
00:14:04,816 --> 00:14:06,016
这是你在 App Store Connect 中


406
00:14:06,016 --> 00:14:06,986
添加的产品代码


407
00:14:08,106 --> 00:14:09,756
它是可选的


408
00:14:09,756 --> 00:14:11,226
因为试用优惠并没有标识符


409
00:14:11,226 --> 00:14:12,496
所以它在那里为 nil


410
00:14:12,746 --> 00:14:15,106
但是对于每一个订阅优惠而言


411
00:14:15,106 --> 00:14:20,516
它是存在的 我们添加了一个类型


412
00:14:21,186 --> 00:14:22,206
这是一个数组


413
00:14:22,206 --> 00:14:23,476
它会告诉你


414
00:14:23,636 --> 00:14:24,966
这是一个订阅优惠


415
00:14:24,966 --> 00:14:25,686
还是一个试用优惠


416
00:14:27,166 --> 00:14:28,976
然而 你永远不会在 discounts 数组中


417
00:14:28,976 --> 00:14:29,646
获得试用优惠


418
00:14:30,276 --> 00:14:31,576
那些将只会存在于


419
00:14:31,576 --> 00:14:33,696
SKProduct 的试用价格属性中


420
00:14:38,076 --> 00:14:39,636
这样你已经准备好向用户


421
00:14:39,636 --> 00:14:40,396
展示你的优惠了


422
00:14:40,576 --> 00:14:41,736
第一步是向服务器


423
00:14:41,736 --> 00:14:42,716
发送一个请求


424
00:14:42,776 --> 00:14:43,746
来获取优惠细节


425
00:14:47,056 --> 00:14:48,836
在本例中


426
00:14:49,166 --> 00:14:52,856
我们将传入 App 用户名的哈希版本 


427
00:14:52,856 --> 00:14:54,116
订阅的产品标识符


428
00:14:55,806 --> 00:14:56,716
以及优惠标识符


429
00:14:56,716 --> 00:14:58,676
这里 我们的服务器


430
00:14:58,676 --> 00:15:00,416
已经知道我们使用的是什么 App 套装 ID


431
00:15:01,236 --> 00:15:05,156
它会运行所有我们提及的代码


432
00:15:05,156 --> 00:15:09,296
然后返回一个 nonce 一个时间戳 一个密钥标识符


433
00:15:09,296 --> 00:15:10,616
当然还有


434
00:15:10,616 --> 00:15:13,896
在 Base64 格式字符串中的签名本身


435
00:15:16,056 --> 00:15:18,376
我们不会详细讨论如何发出


436
00:15:18,376 --> 00:15:20,246
安全的 HTTPS 请求和响应


437
00:15:20,326 --> 00:15:21,896
有许多关于这点的资源可供参考


438
00:15:22,526 --> 00:15:23,816
我们将继续


439
00:15:23,816 --> 00:15:24,786
把目光放在 completion() 代码块中


440
00:15:28,226 --> 00:15:30,956
你需要对所有这些信息进行处理


441
00:15:30,956 --> 00:15:33,296
创建这个名为 SKPaymentDiscount 的新类


442
00:15:34,626 --> 00:15:36,746
注意这里是 SKPaymentDiscount


443
00:15:36,746 --> 00:15:37,946
而不是 SKProductDiscount


444
00:15:38,966 --> 00:15:40,436
SKProductDiscount


445
00:15:40,436 --> 00:15:42,196
是我们刚刚提到的


446
00:15:42,196 --> 00:15:43,806
它提供了你在 App Store Connect 中


447
00:15:43,806 --> 00:15:44,566
设置的优惠的详细信息


448
00:15:45,646 --> 00:15:47,796
这个 SKPaymentDiscount 实际上


449
00:15:47,796 --> 00:15:48,856
包含了有效负载


450
00:15:48,856 --> 00:15:49,876
和签名的所有细节


451
00:15:50,266 --> 00:15:52,066
你需要使用它附加到支付上


452
00:15:52,066 --> 00:15:52,976
并发送到 StoreKit


453
00:15:56,276 --> 00:15:57,026
我们在这里创建一个


454
00:15:57,026 --> 00:15:58,646
把这些细节


455
00:15:58,696 --> 00:16:00,076
传递到初始化器


456
00:16:00,076 --> 00:16:01,066
然后返回到 completion() 代码块中


457
00:16:01,066 --> 00:16:01,976
这样我们便准备好显示优惠


458
00:16:07,416 --> 00:16:08,866
当顾客轻点购买时


459
00:16:08,866 --> 00:16:10,406
我们将调用这里的


460
00:16:10,406 --> 00:16:11,856
buyProduct 函数


461
00:16:11,856 --> 00:16:16,246
你需要确保订阅本身


462
00:16:16,246 --> 00:16:18,586
具有 SKProduct


463
00:16:18,786 --> 00:16:21,306
用于生成签名的


464
00:16:21,306 --> 00:16:22,126
相同的哈希 App 用户名


465
00:16:22,126 --> 00:16:24,526
以及我们刚刚创建的


466
00:16:24,526 --> 00:16:25,646
SKPaymentDiscount


467
00:16:28,046 --> 00:16:29,876
从这里开始设置就非常简单了


468
00:16:30,606 --> 00:16:32,216
使用该产品


469
00:16:32,496 --> 00:16:33,136
创建一个新的 SKMutablePayment


470
00:16:35,086 --> 00:16:36,396
我们将设置 applicationUsername


471
00:16:39,046 --> 00:16:39,816
然后用 SKPaymentDiscount


472
00:16:39,816 --> 00:16:41,316
设置这个新的


473
00:16:41,316 --> 00:16:42,436
paymentDiscount 属性


474
00:16:44,216 --> 00:16:45,186
就是这样


475
00:16:46,366 --> 00:16:47,336
只需将支付


476
00:16:47,336 --> 00:16:48,456
添加到支付队列中


477
00:16:49,086 --> 00:16:50,086
就像其他 App 内购买项目的设置


478
00:16:55,136 --> 00:16:56,016
除此之外


479
00:16:56,016 --> 00:16:57,586
我们还专门为订阅优惠


480
00:16:57,586 --> 00:16:59,236
新添了 SKErrorCodes


481
00:17:00,886 --> 00:17:02,676
第一个是 invalidOfferIdentifier


482
00:17:03,456 --> 00:17:04,226
正如它的字面意思


483
00:17:04,226 --> 00:17:06,086
如果你试图使用的


484
00:17:06,086 --> 00:17:07,465
优惠标识符丢失


485
00:17:07,806 --> 00:17:08,886
或者你在 App Store Connect 中禁用了它


486
00:17:08,886 --> 00:17:10,705
就会返回这个代码


487
00:17:12,596 --> 00:17:14,626
下一个是 invalidOfferPrice


488
00:17:15,586 --> 00:17:16,925
App Store 实际上


489
00:17:16,925 --> 00:17:18,286
会对现收现付的订阅优惠


490
00:17:18,286 --> 00:17:19,935
进行价格验证


491
00:17:20,556 --> 00:17:21,526
我们想要确保


492
00:17:21,526 --> 00:17:23,415
优惠的价格


493
00:17:23,455 --> 00:17:24,736
比订阅本身的基础价格更低


494
00:17:25,346 --> 00:17:27,455
因为可能会发生这种情况


495
00:17:27,455 --> 00:17:29,116
你设定了一个优惠


496
00:17:29,116 --> 00:17:30,136
然后你又降低了


497
00:17:30,136 --> 00:17:30,806
基础订阅的价格


498
00:17:30,806 --> 00:17:31,856
我们要确保


499
00:17:31,856 --> 00:17:32,826
这确实是一个折扣


500
00:17:35,046 --> 00:17:36,216
然而 App Store 不为


501
00:17:36,216 --> 00:17:37,536
预付费订阅优惠


502
00:17:37,606 --> 00:17:39,296
进行价格验证


503
00:17:40,276 --> 00:17:41,806
原因是我们希望


504
00:17:41,806 --> 00:17:43,906
你能够创建套装


505
00:17:43,906 --> 00:17:45,866
例如 如果你开始运营


506
00:17:45,866 --> 00:17:46,546
一个全新的


507
00:17:46,546 --> 00:17:48,916
基于订阅的游戏


508
00:17:48,916 --> 00:17:50,416
你可能想给一些用户一个优惠


509
00:17:50,416 --> 00:17:53,696
比如三个月的订阅访问


510
00:17:53,696 --> 00:17:56,956
附赠一个额外的传奇装备


511
00:17:56,956 --> 00:17:58,326
或者经验包之类的赠品


512
00:17:58,326 --> 00:17:59,406
相比于仅仅三个月的订阅


513
00:17:59,406 --> 00:17:59,976
提供更多的价值


514
00:18:04,416 --> 00:18:06,416
下一个错误代码是 invalidSignature


515
00:18:08,036 --> 00:18:09,296
如果你发送的签名


516
00:18:09,296 --> 00:18:11,106
不能与你之前告诉我们


517
00:18:11,106 --> 00:18:12,496
你所使用的私钥


518
00:18:12,586 --> 00:18:14,726
或者与你发送的有效载荷


519
00:18:15,136 --> 00:18:17,646
进行验证匹配


520
00:18:17,646 --> 00:18:18,446
这意味着在这两者之间


521
00:18:18,446 --> 00:18:19,396
有什么被更换了


522
00:18:19,396 --> 00:18:19,976
我们将发回这段代码


523
00:18:24,056 --> 00:18:25,506
最后一个是 missingOfferParams


524
00:18:26,246 --> 00:18:28,306
如果你忘记发送


525
00:18:28,376 --> 00:18:29,906
或者你发送一个


526
00:18:29,906 --> 00:18:31,256
空字符串版本的有效载荷


527
00:18:31,256 --> 00:18:32,456
你会收到这段代码


528
00:18:33,696 --> 00:18:34,776
最常见的例子是


529
00:18:34,776 --> 00:18:36,036
忘记在 SKMutablePayment 上


530
00:18:36,036 --> 00:18:37,936
设置 App 用户名


531
00:18:44,186 --> 00:18:45,106
我们刚才看到的这些代码


532
00:18:45,106 --> 00:18:46,466
都可以在网上找到


533
00:18:47,486 --> 00:18:49,146
就像我说的


534
00:18:49,246 --> 00:18:50,816
你现在就可以下载 NodeJS 服务器


535
00:18:50,816 --> 00:18:52,016
并在本地运行


536
00:18:52,216 --> 00:18:53,336
这是一个随时可以运行的 App


537
00:18:54,446 --> 00:18:55,406
我们看到的 Swift 代码


538
00:18:55,406 --> 00:18:58,076
可以在这些文档页面上找到


539
00:18:58,076 --> 00:19:00,086
而且有更多关于它的详细文档


540
00:19:00,816 --> 00:19:02,046
另外 如果你有任何问题


541
00:19:02,556 --> 00:19:03,716
请在 3 点后


542
00:19:03,716 --> 00:19:04,646
到我们实验室来


543
00:19:09,046 --> 00:19:11,196
现在我们已经讨论了


544
00:19:11,196 --> 00:19:12,626
如何生成签名


545
00:19:12,816 --> 00:19:13,676
以及如何将交易


546
00:19:13,676 --> 00:19:15,446
发送到 StoreKit


547
00:19:15,446 --> 00:19:17,646
你可能会想


548
00:19:17,646 --> 00:19:18,946
“很好 但是我应该将这些优惠发送给谁呢”


549
00:19:22,216 --> 00:19:24,046
正如我所说


550
00:19:24,046 --> 00:19:27,376
App Store 只执行一条规则


551
00:19:27,376 --> 00:19:28,466
每个想要兑换优惠的用户


552
00:19:28,466 --> 00:19:30,986
必须在该 App 中订阅过


553
00:19:30,986 --> 00:19:34,466
自动续订的订阅服务


554
00:19:34,726 --> 00:19:36,066
这包括了


555
00:19:36,066 --> 00:19:37,026
任何自动续订的订阅


556
00:19:37,336 --> 00:19:38,626
它不一定是


557
00:19:38,626 --> 00:19:39,416
你想要给出优惠的


558
00:19:39,416 --> 00:19:39,976
那个订阅类别


559
00:19:42,046 --> 00:19:43,526
它可以来自任何订阅组


560
00:19:43,586 --> 00:19:45,686
重复一下 并不需要匹配


561
00:19:48,256 --> 00:19:49,886
这既包括当前的订阅用户


562
00:19:49,886 --> 00:19:50,996
也包括那些


563
00:19:50,996 --> 00:19:52,266
已经退出并流失的订阅用户


564
00:19:52,886 --> 00:19:54,076
因此你可以使用优惠


565
00:19:54,076 --> 00:19:55,956
来留住用户 或者重新召回用户


566
00:19:59,516 --> 00:20:00,656
用户从第一个订阅期起


567
00:20:00,656 --> 00:20:02,466
便具有资格


568
00:20:03,696 --> 00:20:05,186
包括他们正处于


569
00:20:05,186 --> 00:20:07,466
一个免费或付费的试用优惠订阅中


570
00:20:11,436 --> 00:20:13,166
记住这一点


571
00:20:13,166 --> 00:20:14,576
用来检查以确保用户


572
00:20:14,576 --> 00:20:15,766
确实符合条件的方法


573
00:20:15,796 --> 00:20:18,286
当然是查看收据


574
00:20:21,046 --> 00:20:22,906
其实很简单


575
00:20:22,906 --> 00:20:23,536
你只需要查看


576
00:20:23,536 --> 00:20:24,166
in_app 数组


577
00:20:24,166 --> 00:20:25,376
或者 latest_receipt_info 数组


578
00:20:25,376 --> 00:20:28,336
如果它可用 并且浏览那里的所有对象


579
00:20:28,806 --> 00:20:34,336
你需要查看每个产品 ID


580
00:20:35,066 --> 00:20:36,846
如果你发现一个产品 ID


581
00:20:36,846 --> 00:20:38,026
是自动更新订阅


582
00:20:38,826 --> 00:20:39,456
那么你就知道


583
00:20:39,456 --> 00:20:40,546
他们已经订阅了


584
00:20:40,576 --> 00:20:42,396
因此他们有资格


585
00:20:42,396 --> 00:20:44,556
兑换该 App 中


586
00:20:44,556 --> 00:20:45,666
任何自动续订订阅的


587
00:20:45,666 --> 00:20:46,696
任何优惠


588
00:20:47,686 --> 00:20:49,916
但这只是 App Store 提出的资格条件


589
00:20:50,506 --> 00:20:51,536
十分简单


590
00:20:52,086 --> 00:20:53,036
我们将更多的决定权交给你


591
00:20:54,146 --> 00:20:55,186
你一定希望


592
00:20:55,186 --> 00:20:56,136
实现自己的业务规则


593
00:20:56,136 --> 00:20:58,246
以确定向哪些客户展示优惠


594
00:20:58,246 --> 00:20:59,926
以及向他们展示哪些优惠


595
00:21:02,046 --> 00:21:03,846
为了给你们一些实用的


596
00:21:03,846 --> 00:21:04,836
关于这个内容的建议和见解


597
00:21:05,536 --> 00:21:06,546
我想请我的同事


598
00:21:06,546 --> 00:21:07,406
Michael 上台


599
00:21:08,516 --> 00:21:11,616
[掌声]


600
00:21:12,116 --> 00:21:12,506
>> 谢谢 Ross


601
00:21:13,016 --> 00:21:15,000
[掌声]


602
00:21:18,476 --> 00:21:19,406
下午好


603
00:21:19,976 --> 00:21:21,346
我是 Michael Gargas


604
00:21:21,346 --> 00:21:22,896
我是 App Store 商业团队的


605
00:21:22,896 --> 00:21:23,926
一名技术支持


606
00:21:24,526 --> 00:21:25,566
今天我很高兴


607
00:21:25,566 --> 00:21:26,656
能和大家一起


608
00:21:27,376 --> 00:21:29,806
使用我们超棒的新功能 


609
00:21:29,806 --> 00:21:31,206
订阅优惠


610
00:21:31,456 --> 00:21:32,626
并讨论用户的资格 分配


611
00:21:32,766 --> 00:21:33,616
和自发流失


612
00:21:36,046 --> 00:21:37,626
作为开发者


613
00:21:37,626 --> 00:21:39,166
你可能会问自己一些


614
00:21:39,166 --> 00:21:40,486
关于 App 中


615
00:21:40,486 --> 00:21:43,516
用户订阅活动的问题


616
00:21:44,276 --> 00:21:45,536
比如


617
00:21:45,536 --> 00:21:47,086
我的大多数用户什么时候会流失


618
00:21:47,776 --> 00:21:48,866
是否已经有用户流失了


619
00:21:49,886 --> 00:21:51,596
或者 为什么用户


620
00:21:51,596 --> 00:21:52,866
可能取消了他们的订阅


621
00:21:54,416 --> 00:21:56,076
正如 Ross 提到的


622
00:21:56,076 --> 00:21:57,926
你可以通过 App 收据


623
00:21:57,926 --> 00:21:59,996
确定订阅优惠的基本资格


624
00:22:00,826 --> 00:22:02,606
在 in_app 数组


625
00:22:02,606 --> 00:22:04,666
和 latest_receipt_info 中


626
00:22:04,726 --> 00:22:05,776
你将获知该订阅用户


627
00:22:05,776 --> 00:22:08,286
或普通用户之前的订阅活动


628
00:22:09,326 --> 00:22:10,706
此外 我们将通过更新的


629
00:22:10,706 --> 00:22:12,486
服务器到服务器通知


630
00:22:12,676 --> 00:22:14,246
提供此信息


631
00:22:16,496 --> 00:22:17,666
但这只是关于


632
00:22:17,666 --> 00:22:20,476
用户所订阅的产品


633
00:22:21,356 --> 00:22:22,986
在 App 收据的内部


634
00:22:22,986 --> 00:22:24,506
我们提供了许多额外的


635
00:22:24,656 --> 00:22:26,806
有价值的用户订阅信息


636
00:22:28,026 --> 00:22:29,106
比如订阅状态


637
00:22:29,106 --> 00:22:31,506
我的用户会在


638
00:22:31,506 --> 00:22:33,026
订阅到期后续订吗


639
00:22:33,896 --> 00:22:36,136
或者我的用户是否处于


640
00:22:36,606 --> 00:22:37,886
付款失败状态


641
00:22:38,086 --> 00:22:39,286
我们还提供了独特标识符


642
00:22:39,316 --> 00:22:41,176
比如原始的交易 ID


643
00:22:41,176 --> 00:22:43,236
和 WEB 订单行项目 ID


644
00:22:43,236 --> 00:22:45,236
以便你为服务器上的


645
00:22:45,236 --> 00:22:46,886
特定的用户


646
00:22:47,136 --> 00:22:49,386
确定特定的订阅


647
00:22:49,896 --> 00:22:53,016
我们提供


648
00:22:53,016 --> 00:22:54,226
该用户的订阅日期


649
00:22:54,226 --> 00:22:55,976
例如当前期间的订阅开始日期


650
00:22:55,976 --> 00:22:57,836
和到期日期


651
00:22:57,836 --> 00:22:59,206
以及之前的所有续订日期


652
00:22:59,746 --> 00:23:02,766
我们提供订阅意图


653
00:23:02,766 --> 00:23:04,376
让你知道


654
00:23:04,376 --> 00:23:05,236
是否有人取消了订阅


655
00:23:05,236 --> 00:23:06,806
以及他们为什么


656
00:23:06,806 --> 00:23:07,346
要取消订阅


657
00:23:07,696 --> 00:23:09,136
如果他们要求退款


658
00:23:09,516 --> 00:23:10,506
是你的 App 出了问题


659
00:23:10,506 --> 00:23:11,976
还是其他的什么原因


660
00:23:14,356 --> 00:23:15,806
在去年的“Engineering Subscription”会议中


661
00:23:15,806 --> 00:23:17,816
我们讨论了


662
00:23:17,816 --> 00:23:19,496
从 App 收据中


663
00:23:19,496 --> 00:23:21,236
存储额外用户数据的概念


664
00:23:22,046 --> 00:23:23,446
这里我们有一个


665
00:23:23,446 --> 00:23:24,616
查看用户的


666
00:23:24,616 --> 00:23:26,826
订阅到期日期的示例


667
00:23:26,826 --> 00:23:28,586
将其存储在服务器上


668
00:23:28,626 --> 00:23:30,196
并确定该用户不再符合


669
00:23:30,196 --> 00:23:31,826
订阅服务的资格


670
00:23:32,366 --> 00:23:35,566
我们也在此基础上


671
00:23:35,566 --> 00:23:36,736
并讨论了


672
00:23:36,776 --> 00:23:38,226
从 /verifyReceipt 存储


673
00:23:38,226 --> 00:23:39,476
额外的订阅用户状态栏


674
00:23:39,986 --> 00:23:43,226
然后从响应中


675
00:23:43,226 --> 00:23:45,266
解析出特定的栏


676
00:23:45,266 --> 00:23:46,466
比如 autoRenewStatus


677
00:23:49,046 --> 00:23:51,086
此外


678
00:23:51,086 --> 00:23:53,156
我们建议你现在保存


679
00:23:53,156 --> 00:23:56,476
来自服务器到服务器通知的状态更改


680
00:23:56,476 --> 00:23:58,056
因为我们也正在


681
00:23:58,056 --> 00:23:59,106
将统一的 App 收据


682
00:23:59,266 --> 00:24:00,976
包含在这些服务器到服务器通知中


683
00:24:03,436 --> 00:24:05,206
这是 Apple 提供给你的


684
00:24:05,206 --> 00:24:06,616
关于你的 App 中


685
00:24:06,616 --> 00:24:08,846
订阅用户和普通用户的数据


686
00:24:10,036 --> 00:24:12,756
作为一名开发者


687
00:24:12,756 --> 00:24:14,916
你的 App 中有许多


688
00:24:14,916 --> 00:24:16,606
Apple 没有的


689
00:24:16,606 --> 00:24:18,446
关于用户订阅活动的


690
00:24:18,446 --> 00:24:19,176
附加信息


691
00:24:20,496 --> 00:24:22,276
通过获取这些信息


692
00:24:22,276 --> 00:24:24,516
并将其与


693
00:24:24,516 --> 00:24:25,936
我们在购买或续订行为之后


694
00:24:25,936 --> 00:24:27,726
提供的 JSOJN 数据结合起来


695
00:24:27,726 --> 00:24:30,056
你就可以开始为用户群体


696
00:24:30,576 --> 00:24:32,486
策划特定的优惠


697
00:24:33,486 --> 00:24:35,436
随着时间的推移


698
00:24:35,436 --> 00:24:36,996
你可以使用关键的订阅指标


699
00:24:36,996 --> 00:24:38,896
如转化率 参与度


700
00:24:39,126 --> 00:24:40,796
保留率和客户流失率


701
00:24:41,276 --> 00:24:43,456
来监视这些用户群体


702
00:24:43,816 --> 00:24:45,096
如何对优惠做出响应


703
00:24:45,686 --> 00:24:49,336
为了更直观地了解这一点


704
00:24:49,336 --> 00:24:52,366
让我们看一下服务器上的


705
00:24:52,596 --> 00:24:53,366
一个用户表的示例


706
00:24:56,146 --> 00:24:58,676
这里我们看到


707
00:24:58,676 --> 00:25:00,886
按 userId 和 originalTransactionId 排序的用户


708
00:25:00,886 --> 00:25:02,906
originalTransactionId 是特定用户的


709
00:25:02,906 --> 00:25:04,616
任何订阅购买的


710
00:25:04,616 --> 00:25:06,066
父特定标识符


711
00:25:06,606 --> 00:25:09,426
正如我们所说


712
00:25:09,426 --> 00:25:11,726
你可以开始在 App 收据中


713
00:25:11,726 --> 00:25:13,396
添加额外的用户信息


714
00:25:13,396 --> 00:25:15,256
比如用户的


715
00:25:15,396 --> 00:25:17,376
自动续订状态


716
00:25:17,376 --> 00:25:19,066
和账单重试状态


717
00:25:19,836 --> 00:25:21,206
但你不应该止步于此


718
00:25:22,086 --> 00:25:25,356
你可以将其与 App 中


719
00:25:25,356 --> 00:25:27,316
有关用户活动的信息相结合


720
00:25:28,156 --> 00:25:29,506
这里我们有一个


721
00:25:29,506 --> 00:25:30,476
contentConsumed 的例子


722
00:25:31,466 --> 00:25:32,676
contentConsumed 可以是观看视频


723
00:25:33,036 --> 00:25:36,326
阅读文章 保存故事等等


724
00:25:39,076 --> 00:25:39,846
通过查看这些信息


725
00:25:39,846 --> 00:25:41,336
我们能够确定


726
00:25:41,336 --> 00:25:42,926
哪些用户


727
00:25:42,926 --> 00:25:44,646
有资格获得订阅优惠


728
00:25:44,646 --> 00:25:47,756
哪些没有


729
00:25:50,266 --> 00:25:52,386
更进一步


730
00:25:52,386 --> 00:25:53,756
我们可以开始存储额外的信息


731
00:25:53,756 --> 00:25:55,856
比如续订


732
00:25:55,856 --> 00:25:58,156
用户所经历的


733
00:25:58,156 --> 00:25:59,146
账单错误的数量


734
00:25:59,146 --> 00:26:01,186
以及他们是否有资格


735
00:26:01,186 --> 00:26:03,436
获得特定类型的优惠


736
00:26:04,486 --> 00:26:06,226
正如 Ross 所提到的


737
00:26:06,226 --> 00:26:08,146
每个订阅队列


738
00:26:08,466 --> 00:26:09,516
最多可以有 10 个订阅优惠


739
00:26:10,336 --> 00:26:11,496
这将允许你最多创建


740
00:26:11,496 --> 00:26:12,806
10 个不同的


741
00:26:12,806 --> 00:26:15,126
用户群体来标识


742
00:26:15,126 --> 00:26:16,606
和分配订阅优惠


743
00:26:17,176 --> 00:26:20,066
如果我们看一下


744
00:26:20,066 --> 00:26:22,186
服务器上的三个示例用户


745
00:26:22,186 --> 00:26:25,916
你将看到


746
00:26:25,916 --> 00:26:27,086
根据他们的订阅活动


747
00:26:27,836 --> 00:26:30,166
当用户在免费试用期间


748
00:26:30,166 --> 00:26:32,996
禁用了自动续订功能


749
00:26:33,186 --> 00:26:34,596
且订阅到期后并未续订时


750
00:26:34,596 --> 00:26:36,236
我们已经能够


751
00:26:36,466 --> 00:26:37,276
使他们有资格获得


752
00:26:37,276 --> 00:26:37,816
诸如回归奖励之类的优惠


753
00:26:38,396 --> 00:26:42,446
或者一个保留优惠


754
00:26:42,446 --> 00:26:43,926
指的是当前已订阅


755
00:26:43,926 --> 00:26:45,526
但已禁用自动续订功能的用户


756
00:26:45,526 --> 00:26:46,756
你希望向他们展示保留优惠


757
00:26:46,756 --> 00:26:48,196
以便让他们


758
00:26:48,196 --> 00:26:49,786
继续订阅你的服务


759
00:26:50,316 --> 00:26:53,806
还可以提供升级优惠


760
00:26:54,306 --> 00:26:55,466
找到那些在较低订阅级别上


761
00:26:55,466 --> 00:26:57,306
如按月订阅


762
00:26:57,306 --> 00:26:58,826
有连续续订的用户


763
00:26:58,826 --> 00:27:00,906
然后向他们


764
00:27:00,906 --> 00:27:02,106
提供订阅优惠


765
00:27:02,336 --> 00:27:03,806
激励他们升级到


766
00:27:03,806 --> 00:27:04,266
比如年度订阅的高级订阅级别


767
00:27:05,126 --> 00:27:08,316
这将通过


768
00:27:08,316 --> 00:27:09,946
更多的信息


769
00:27:09,946 --> 00:27:11,436
确定用户资格


770
00:27:11,436 --> 00:27:13,016
而不仅仅是查看用户


771
00:27:13,016 --> 00:27:14,826
之前是否在我的 App 中


772
00:27:14,826 --> 00:27:16,276
订阅了我的订阅产品


773
00:27:17,566 --> 00:27:19,126
在你构建了


774
00:27:19,126 --> 00:27:21,196
这个详细的用户资格之后


775
00:27:21,196 --> 00:27:22,706
下一步就是


776
00:27:22,706 --> 00:27:23,676
分配你的订阅优惠


777
00:27:25,146 --> 00:27:26,726
让我们来看看订阅优惠


778
00:27:26,726 --> 00:27:28,826
可能采取的方式


779
00:27:29,956 --> 00:27:31,686
首先 正如我们所讨论的


780
00:27:31,686 --> 00:27:33,856
你需要确定哪些用户


781
00:27:33,856 --> 00:27:35,356
或用户群体


782
00:27:35,356 --> 00:27:37,006
有资格获得订阅优惠


783
00:27:37,806 --> 00:27:38,886
然后你可以和这些用户互动


784
00:27:38,886 --> 00:27:40,816
从 App Store 中


785
00:27:40,816 --> 00:27:42,176
获取信息


786
00:27:42,516 --> 00:27:43,896
并呈现给你的用户


787
00:27:45,116 --> 00:27:47,056
此时 用户将有希望


788
00:27:47,056 --> 00:27:48,416
进行购买


789
00:27:48,416 --> 00:27:49,846
并兑换订阅优惠


790
00:27:50,396 --> 00:27:52,566
如果我们回到我们的标识


791
00:27:52,706 --> 00:27:54,366
你可以看到我们标记了


792
00:27:54,366 --> 00:27:55,676
三个不同的用户


793
00:27:55,676 --> 00:27:57,366
他们有资格获得三种


794
00:27:57,366 --> 00:27:59,176
不同类型的订阅优惠


795
00:28:01,116 --> 00:28:02,716
那么你在哪里


796
00:28:02,716 --> 00:28:03,356
展示这些信息呢


797
00:28:04,076 --> 00:28:07,546
如果用户仍在


798
00:28:07,546 --> 00:28:08,896
使用你的 App


799
00:28:09,006 --> 00:28:10,736
但处于未订阅状态


800
00:28:11,036 --> 00:28:12,406
你可以通过 App 内发送信息


801
00:28:12,406 --> 00:28:13,886
或本地通知


802
00:28:13,886 --> 00:28:15,916
将订阅优惠


803
00:28:15,916 --> 00:28:18,036
直接展示给用户


804
00:28:19,276 --> 00:28:20,536
重要的是要理解


805
00:28:20,536 --> 00:28:22,316
你的 App 应该


806
00:28:22,316 --> 00:28:25,136
能为所有消费提供相应的价值


807
00:28:25,996 --> 00:28:27,366
当你鼓励用户


808
00:28:27,366 --> 00:28:29,166
消费某个优惠时


809
00:28:29,166 --> 00:28:30,926
你要仔细考虑这种推销


810
00:28:30,926 --> 00:28:32,686
并确保你


811
00:28:32,686 --> 00:28:33,886
清楚地陈述了


812
00:28:33,886 --> 00:28:35,606
这个订阅优惠的价值定位


813
00:28:35,606 --> 00:28:37,206
以及拟定


814
00:28:37,206 --> 00:28:38,136
用户认可的条款


815
00:28:39,256 --> 00:28:40,876
和往常一样


816
00:28:40,876 --> 00:28:42,126
你需要确保


817
00:28:42,126 --> 00:28:43,576
你遵守了最新的


818
00:28:43,716 --> 00:28:44,656
关于订阅的 App 审查指南


819
00:28:45,746 --> 00:28:47,156
这是基于用户


820
00:28:47,156 --> 00:28:49,046
仍然在使用你的 App 的情况


821
00:28:50,446 --> 00:28:51,756
如果用户不再启动 App


822
00:28:51,756 --> 00:28:52,776
又该如何呢


823
00:28:53,736 --> 00:28:55,086
这对于订阅优惠而言


824
00:28:55,086 --> 00:28:55,896
又有什么不同呢


825
00:28:58,266 --> 00:28:58,916
这里我们可以


826
00:28:58,916 --> 00:29:00,996
看到标识阶段


827
00:29:00,996 --> 00:29:02,176
但是我们还需要了解


828
00:29:02,176 --> 00:29:03,676
在你的 App 之外


829
00:29:03,676 --> 00:29:06,446
推广订阅优惠的能力


830
00:29:07,086 --> 00:29:11,016
你需要


831
00:29:11,016 --> 00:29:12,426
在 App Store


832
00:29:12,426 --> 00:29:14,236
或者说 在 App 之外


833
00:29:14,236 --> 00:29:16,066
展示这些订阅优惠


834
00:29:16,066 --> 00:29:17,446
从而吸引这些老用户


835
00:29:20,046 --> 00:29:21,406
现在 让我们来谈谈


836
00:29:21,406 --> 00:29:23,896
在你的 App 之外展示优惠


837
00:29:25,116 --> 00:29:26,716
你可以使用


838
00:29:26,716 --> 00:29:28,426
现有的外部通道


839
00:29:28,516 --> 00:29:29,246
来分发对订阅优惠操作的调用


840
00:29:31,046 --> 00:29:32,686
比如 你已经采用了


841
00:29:32,686 --> 00:29:34,276
付费广告或电子邮件营销


842
00:29:35,396 --> 00:29:38,046
然后使用通用链接


843
00:29:38,646 --> 00:29:43,316
将用户从这些外部通道引导回 App


844
00:29:43,316 --> 00:29:46,456
并识别 他们可能接收到


845
00:29:46,516 --> 00:29:47,836
哪些订阅优惠


846
00:29:50,186 --> 00:29:51,126
有关通用链接的


847
00:29:51,126 --> 00:29:52,676
更多信息


848
00:29:52,676 --> 00:29:54,056
我强烈建议你查看


849
00:29:54,056 --> 00:29:55,606
“What's New in Universal Links” 的会议


850
00:29:55,676 --> 00:29:57,586
你可在今年的


851
00:29:57,646 --> 00:29:59,806
WWDC App 中获得会议内容


852
00:30:04,046 --> 00:30:04,736
我们现在已经讨论了


853
00:30:04,736 --> 00:30:06,306
确定用户资格


854
00:30:06,966 --> 00:30:07,896
以及在 App 内部


855
00:30:07,896 --> 00:30:09,276
或者通过现有的外部渠道


856
00:30:09,276 --> 00:30:12,826
向那些符合资格的用户


857
00:30:12,826 --> 00:30:14,776
推广订阅优惠


858
00:30:16,336 --> 00:30:19,806
接下来让我们谈谈一些


859
00:30:19,806 --> 00:30:21,026
可以利用在订阅优惠上的策略


860
00:30:21,026 --> 00:30:23,366
帮助我们减少用户流失


861
00:30:27,296 --> 00:30:28,626
在去年的“Engineering Subscription”中


862
00:30:28,626 --> 00:30:30,306
我们谈到了


863
00:30:30,306 --> 00:30:32,576
用户自主流失


864
00:30:32,576 --> 00:30:33,726
即用户在订阅期间


865
00:30:33,726 --> 00:30:36,406
主动取消订阅的行为


866
00:30:37,546 --> 00:30:39,016
自主流失指的是


867
00:30:39,016 --> 00:30:40,246
用户选择


868
00:30:40,246 --> 00:30:41,066
离开你的订阅产品


869
00:30:41,676 --> 00:30:43,166
这与非自主流失有所不同


870
00:30:43,166 --> 00:30:44,926
后者指的是用户没有做出任何选择


871
00:30:45,176 --> 00:30:46,896
只是账单问题导致的流失


872
00:30:48,336 --> 00:30:51,996
去年 我们给了你一些策略


873
00:30:52,166 --> 00:30:53,246
比如向那些自主流失的用户


874
00:30:53,246 --> 00:30:55,786
提供其他可选的订阅产品


875
00:30:56,446 --> 00:30:59,046
但这不是赢回客户的好方法


876
00:30:59,736 --> 00:31:02,156
今年 我们将给出如下的建议


877
00:31:03,266 --> 00:31:05,006
我们希望你


878
00:31:05,006 --> 00:31:06,616
使用来自 App 收据的数据


879
00:31:06,986 --> 00:31:08,506
以及你所拥有的


880
00:31:08,716 --> 00:31:10,256
关于订阅用户


881
00:31:10,576 --> 00:31:11,916
如何在 App 中消费内容的信息


882
00:31:11,916 --> 00:31:14,566
来分析你的用户订阅行为


883
00:31:15,316 --> 00:31:16,506
我们想让你


884
00:31:16,506 --> 00:31:17,866
使用这些信息


885
00:31:17,866 --> 00:31:19,916
并确定特定的用户群体


886
00:31:20,576 --> 00:31:23,646
然后把你的订阅优惠


887
00:31:23,646 --> 00:31:26,406
最好是匹配的订阅优惠


888
00:31:26,406 --> 00:31:27,586
分配给


889
00:31:27,926 --> 00:31:29,526
不同的用户群体


890
00:31:30,886 --> 00:31:34,036
在谈到订阅优惠时


891
00:31:34,356 --> 00:31:36,916
我们通常只考虑


892
00:31:36,916 --> 00:31:37,836
赢回未订阅的用户


893
00:31:38,866 --> 00:31:41,196
但我们想


894
00:31:41,196 --> 00:31:43,246
在此基础上再扩展一下


895
00:31:43,246 --> 00:31:44,496
讨论另外五种


896
00:31:44,496 --> 00:31:45,846
为你的订阅用户


897
00:31:46,106 --> 00:31:47,006
展示订阅优惠的方式


898
00:31:47,656 --> 00:31:49,926
你可以利用订阅优惠


899
00:31:49,926 --> 00:31:51,416
来进行用户保留营销


900
00:31:52,346 --> 00:31:54,326
当你看到


901
00:31:54,526 --> 00:31:56,106
用户在订阅到期后


902
00:31:56,106 --> 00:31:57,736
选择不再续订时


903
00:31:57,736 --> 00:31:59,126
你可以尝试通过订阅优惠


904
00:31:59,126 --> 00:31:59,886
来留住该客户


905
00:32:01,326 --> 00:32:02,846
如果你掌握的信息


906
00:32:02,846 --> 00:32:03,946
使你相信在某个时间点


907
00:32:03,946 --> 00:32:05,766
这个用户可能会流失


908
00:32:05,766 --> 00:32:08,176
那么你可以为他们提供一个挽留优惠


909
00:32:08,176 --> 00:32:10,126
实质上是预测


910
00:32:10,126 --> 00:32:11,906
用户可能会


911
00:32:11,986 --> 00:32:13,066
从 App 中流失


912
00:32:13,616 --> 00:32:15,796
你可以在 App 收据中


913
00:32:15,796 --> 00:32:17,026
查看用户的订阅活动


914
00:32:17,026 --> 00:32:18,036
和他们当前


915
00:32:18,036 --> 00:32:19,446
订阅的产品


916
00:32:19,876 --> 00:32:21,306
你可以提供订阅优惠


917
00:32:21,306 --> 00:32:23,086
从而在订阅组中


918
00:32:23,086 --> 00:32:25,346
升级或降级该用户


919
00:32:25,646 --> 00:32:29,786
此外 你还可以使用订阅优惠


920
00:32:29,826 --> 00:32:31,206
来安抚可能在 App 中


921
00:32:31,206 --> 00:32:33,066
体验不佳的用户


922
00:32:34,376 --> 00:32:36,736
你也可以使用订阅优惠


923
00:32:36,736 --> 00:32:38,106
来奖励你最忠实的订阅用户


924
00:32:38,106 --> 00:32:41,596
让我们来逐个探讨


925
00:32:41,596 --> 00:32:43,596
并展示如何


926
00:32:43,596 --> 00:32:44,546
在 App 中


927
00:32:44,546 --> 00:32:46,826
向用户展示这些订阅优惠


928
00:32:48,236 --> 00:32:50,406
首先 让我们看一个


929
00:32:50,406 --> 00:32:51,306
赢回用户的例子


930
00:32:52,246 --> 00:32:53,796
这里我们有一位


931
00:32:54,216 --> 00:32:57,146
在 26 日购买订阅的用户


932
00:32:58,236 --> 00:32:59,536
但是在订阅期间中


933
00:33:00,406 --> 00:33:02,776
该用户选择取消


934
00:33:03,516 --> 00:33:04,526
他们致电 Apple Care


935
00:33:04,526 --> 00:33:05,656
并阐述对服务不满意


936
00:33:05,656 --> 00:33:08,276
想要取消订阅并退款


937
00:33:08,736 --> 00:33:10,786
正如我们在今天早些时候


938
00:33:10,786 --> 00:33:12,716
与你谈论到的


939
00:33:12,716 --> 00:33:13,856
我们通过


940
00:33:13,856 --> 00:33:16,066
带有取消日期等栏的收据


941
00:33:16,066 --> 00:33:17,396
让你知道这一信息


942
00:33:17,396 --> 00:33:18,976
以便你立即知道


943
00:33:18,976 --> 00:33:20,296
退款 取消发生的时间


944
00:33:21,246 --> 00:33:23,256
以及取消原因


945
00:33:23,256 --> 00:33:24,906
这样你就能知道


946
00:33:24,906 --> 00:33:27,126
是因为 App 本身还是其他原因


947
00:33:27,666 --> 00:33:30,086
我们还通过更新的


948
00:33:30,086 --> 00:33:31,316
服务器到服务器通知


949
00:33:31,316 --> 00:33:32,896
发送这些信息


950
00:33:32,896 --> 00:33:34,666
以便你能够实时了解


951
00:33:34,666 --> 00:33:36,426
订阅用户


952
00:33:36,426 --> 00:33:37,756
和普通用户的动态


953
00:33:38,306 --> 00:33:40,386
让他们知道


954
00:33:40,386 --> 00:33:41,376
他们有其他的


955
00:33:41,376 --> 00:33:42,446
订阅优惠选项


956
00:33:42,856 --> 00:33:45,516
我们进一步考虑这个问题


957
00:33:45,516 --> 00:33:47,086
我们希望从收据


958
00:33:47,086 --> 00:33:49,316
或者服务器到服务器的通知中


959
00:33:49,316 --> 00:33:51,466
获取信息


960
00:33:51,466 --> 00:33:53,596
比如自动续订状态


961
00:33:53,596 --> 00:33:55,386
过期意图 等等


962
00:33:55,386 --> 00:33:57,976
我们想把它存储在服务器上


963
00:33:59,556 --> 00:34:01,746
标记那些


964
00:34:01,746 --> 00:34:03,136
可享受回归优惠的用户


965
00:34:03,836 --> 00:34:04,856
这是向你的用户


966
00:34:04,856 --> 00:34:06,886
展示订阅优惠的信号


967
00:34:11,056 --> 00:34:14,946
例如 在这里你可以看到一个


968
00:34:15,335 --> 00:34:16,476
“再一次与我们同行”的标语


969
00:34:16,505 --> 00:34:17,896
展示给一个可能已经流失的用户


970
00:34:17,896 --> 00:34:19,585
作为开发者的你现在


971
00:34:19,585 --> 00:34:20,686
正试图重新赢得这个用户


972
00:34:23,246 --> 00:34:25,005
我们还有一个


973
00:34:25,005 --> 00:34:26,616
来自《iTranslate》App 的开发者的示例


974
00:34:26,616 --> 00:34:28,016
他利用订阅优惠为用户提供了


975
00:34:28,016 --> 00:34:30,126
免费续订一个月的优惠


976
00:34:31,326 --> 00:34:32,795
这些都是订阅优惠


977
00:34:32,966 --> 00:34:33,956
这项全新特性的优秀应用实例


978
00:34:38,065 --> 00:34:39,025
现在让我们讨论一下保留用户


979
00:34:39,626 --> 00:34:42,156
保留当前 仍在订阅你的 App 的


980
00:34:42,156 --> 00:34:43,896
订阅用户的行为


981
00:34:45,016 --> 00:34:46,485
这里我们看到一个用户


982
00:34:46,545 --> 00:34:47,545
已经购买了他们的订阅


983
00:34:48,806 --> 00:34:50,646
然而在订阅期间


984
00:34:50,646 --> 00:34:52,626
他们选择来到


985
00:34:52,706 --> 00:34:53,536
Apple 的“管理订阅”界面


986
00:34:53,536 --> 00:34:56,666
并取消了订阅


987
00:34:59,386 --> 00:35:00,836
我们更新了


988
00:35:00,836 --> 00:35:02,166
服务器到服务器的通知


989
00:35:02,556 --> 00:35:03,876
你可以通过


990
00:35:04,096 --> 00:35:05,546
与 Apple 重新验证收据


991
00:35:05,546 --> 00:35:07,526
并确认“auto_renew_status”的值


992
00:35:07,526 --> 00:35:08,996
已从 1 更改为 0


993
00:35:08,996 --> 00:35:10,446
来找到此信息


994
00:35:11,126 --> 00:35:12,556
这是你的用户


995
00:35:12,556 --> 00:35:14,326
将不会在订阅到期后


996
00:35:14,326 --> 00:35:15,666
继续订阅的信号


997
00:35:16,206 --> 00:35:20,306
但如果你发布了订阅优惠


998
00:35:20,306 --> 00:35:21,616
我们将发送一个状态


999
00:35:21,616 --> 00:35:23,016
或服务器到服务器的通知


1000
00:35:23,446 --> 00:35:24,776
让你知道


1001
00:35:24,776 --> 00:35:26,406
该用户将不再续订


1002
00:35:27,136 --> 00:35:28,776
当用户禁用续订状态


1003
00:35:28,776 --> 00:35:30,266
和启用续订状态时


1004
00:35:30,266 --> 00:35:32,246
我们都会


1005
00:35:32,246 --> 00:35:33,556
发送此消息


1006
00:35:36,046 --> 00:35:37,276
这将告诉你


1007
00:35:37,276 --> 00:35:38,176
应该让他们知道


1008
00:35:38,176 --> 00:35:41,016
他们还不应该离开


1009
00:35:41,016 --> 00:35:42,216
并期待接下来你的订阅产品


1010
00:35:42,216 --> 00:35:43,326
会提供什么新功能


1011
00:35:43,716 --> 00:35:46,566
如果我们回顾数据库中的


1012
00:35:47,006 --> 00:35:48,056
用户的例子


1013
00:35:48,056 --> 00:35:49,716
你可以看到


1014
00:35:50,166 --> 00:35:51,966
我们已经更新了


1015
00:35:51,966 --> 00:35:53,756
用于保留优惠的栏


1016
00:35:54,416 --> 00:35:55,466
当这个用户


1017
00:35:55,466 --> 00:35:56,586
返回到 App


1018
00:35:56,586 --> 00:35:58,646
无论是被你的营销激励


1019
00:35:58,646 --> 00:36:01,956
还是仅仅出于使用的目的


1020
00:36:01,956 --> 00:36:02,856
都可以向他们展示订阅优惠


1021
00:36:02,856 --> 00:36:04,846
并让他们知道


1022
00:36:04,846 --> 00:36:06,086
现在是订阅的好时候


1023
00:36:07,186 --> 00:36:08,396
“请再一次与我们同行 


1024
00:36:08,826 --> 00:36:09,786
我们注意到你下个月


1025
00:36:09,786 --> 00:36:11,446
将会离开我们了”


1026
00:36:11,996 --> 00:36:13,636
这是一个很棒的标语


1027
00:36:13,936 --> 00:36:15,846
能够赢回和保留用户


1028
00:36:15,846 --> 00:36:17,206
继续订阅你的 App


1029
00:36:18,676 --> 00:36:20,206
我们还有一个


1030
00:36:20,206 --> 00:36:22,066
来自《Ultimate Guitar》的例子


1031
00:36:22,066 --> 00:36:23,896
提供一个月的免费订阅和 50% 的折扣


1032
00:36:23,896 --> 00:36:25,796
让用户知道


1033
00:36:25,796 --> 00:36:26,726
这个优惠仅限今日


1034
00:36:30,286 --> 00:36:31,136
那么这就是用户保留


1035
00:36:32,626 --> 00:36:35,126
让我们看一个升级示例


1036
00:36:35,956 --> 00:36:38,046
在这里


1037
00:36:38,046 --> 00:36:39,826
我们看到一个订阅用户


1038
00:36:39,826 --> 00:36:41,316
选择在 4 月 1 日降级他们的订阅


1039
00:36:41,796 --> 00:36:44,286
你已经知道


1040
00:36:44,286 --> 00:36:46,216
我们将在收据中显示即将更新的产品


1041
00:36:47,586 --> 00:36:48,986
你可以选择从响应中


1042
00:36:48,986 --> 00:36:51,266
解析它并将其存储在服务器中


1043
00:36:52,486 --> 00:36:54,036
我们还向你发送


1044
00:36:54,036 --> 00:36:55,406
服务器到服务器的通知


1045
00:36:55,806 --> 00:36:56,916
为了让你知道


1046
00:36:56,916 --> 00:36:58,456
该用户已选择


1047
00:36:58,456 --> 00:36:59,176
降级他的订阅


1048
00:37:03,046 --> 00:37:04,176
如果用户


1049
00:37:04,176 --> 00:37:06,246
选择了另一种产品


1050
00:37:06,246 --> 00:37:07,316
你知道他们一直在消费


1051
00:37:07,316 --> 00:37:08,396
更高级别的服务


1052
00:37:08,926 --> 00:37:09,876
无论是


1053
00:37:09,876 --> 00:37:11,056
享有更高折扣


1054
00:37:11,056 --> 00:37:12,836
和更长订阅时间的


1055
00:37:12,836 --> 00:37:14,236
年度订阅


1056
00:37:14,836 --> 00:37:16,766
还是高级订阅服务


1057
00:37:16,816 --> 00:37:18,286
其能够访问


1058
00:37:18,286 --> 00:37:20,226
低级订阅无权访问的


1059
00:37:20,266 --> 00:37:22,676
这名用户查看过的特定内容


1060
00:37:22,676 --> 00:37:26,596
在本例中


1061
00:37:26,786 --> 00:37:28,426
当你看到用户降级订阅时


1062
00:37:28,426 --> 00:37:29,836
你可以将他们标记为


1063
00:37:29,836 --> 00:37:30,576
有资格获得升级优惠


1064
00:37:31,096 --> 00:37:34,926
当这名用户


1065
00:37:34,926 --> 00:37:37,576
返回到你的 App 时


1066
00:37:37,786 --> 00:37:39,616
利用一个明确且简洁的标语


1067
00:37:39,846 --> 00:37:41,396
展示一个订阅优惠


1068
00:37:41,396 --> 00:37:44,006
说明优惠的内容


1069
00:37:44,236 --> 00:37:45,286
以及他们将


1070
00:37:45,286 --> 00:37:46,426
在这项优惠中获得什么


1071
00:37:47,216 --> 00:37:49,156
我们还有一个


1072
00:37:49,156 --> 00:37:51,466
很棒的《Dashlane》开发者的例子


1073
00:37:51,466 --> 00:37:52,416
他们试图让用户


1074
00:37:52,416 --> 00:37:54,316
再次升级到


1075
00:37:54,316 --> 00:37:55,226
他们的高级服务


1076
00:37:58,116 --> 00:37:59,726
那么这就是升级的例子


1077
00:38:00,266 --> 00:38:03,296
让我们来讨论一下用户服务


1078
00:38:06,046 --> 00:38:07,186
我们都在尽我们最大的努力


1079
00:38:07,256 --> 00:38:08,956
制作完美的软件


1080
00:38:08,956 --> 00:38:10,186
但是很明显 有些时候用户可能会


1081
00:38:10,186 --> 00:38:12,666
在你的订阅产品中


1082
00:38:12,666 --> 00:38:14,156
遇到问题 故障


1083
00:38:14,156 --> 00:38:15,486
某种类型的错误或者停机


1084
00:38:16,756 --> 00:38:18,546
这个用户可能决定


1085
00:38:18,546 --> 00:38:19,346
通过你的支持渠道


1086
00:38:19,346 --> 00:38:20,806
与你联系


1087
00:38:20,806 --> 00:38:22,816
并让你知道他们的使用体验并不理想


1088
00:38:23,316 --> 00:38:26,686
如果我们在你的服务器上


1089
00:38:26,686 --> 00:38:29,486
回顾用户表


1090
00:38:29,486 --> 00:38:30,936
如果你的用户服务代理


1091
00:38:30,936 --> 00:38:32,656
有能力查找那些特定的用户


1092
00:38:32,706 --> 00:38:34,926
并将他们标识为


1093
00:38:34,926 --> 00:38:36,966
有资格享受优惠


1094
00:38:36,966 --> 00:38:38,796
你的代理就可以指示


1095
00:38:38,796 --> 00:38:40,626
那个用户重新启动 App


1096
00:38:40,626 --> 00:38:41,706
因为他们现在有资格享受优惠


1097
00:38:43,006 --> 00:38:45,646
你可能希望


1098
00:38:45,646 --> 00:38:46,946
在设置界面上


1099
00:38:46,946 --> 00:38:48,196
显示订阅优惠


1100
00:38:49,046 --> 00:38:51,486
在这里 我们看到了一个


1101
00:38:51,486 --> 00:38:53,616
免费续订一个月的优惠


1102
00:38:53,736 --> 00:38:55,076
并为用户可能经历的


1103
00:38:55,076 --> 00:38:56,856
任何服务中断道歉


1104
00:38:58,196 --> 00:39:00,186
当用户使用 App 时


1105
00:39:00,186 --> 00:39:02,566
他将看到一个订阅优惠


1106
00:39:03,316 --> 00:39:05,126
和一个明确且简洁的标语


1107
00:39:06,186 --> 00:39:07,316
这是让你的用户


1108
00:39:07,316 --> 00:39:09,766
满意的好方法


1109
00:39:10,046 --> 00:39:11,186
并且可以安抚任何在你的 App 中


1110
00:39:11,186 --> 00:39:11,906
有过糟糕使用体验的用户


1111
00:39:16,046 --> 00:39:17,396
你还可以使用订阅优惠


1112
00:39:17,396 --> 00:39:20,276
来奖励你最忠实的订阅用户


1113
00:39:20,786 --> 00:39:24,436
在这里


1114
00:39:24,436 --> 00:39:25,606
我们看到一个用户


1115
00:39:25,606 --> 00:39:26,626
即将连续地第 11 次续订


1116
00:39:27,416 --> 00:39:28,596
对于开发者来说


1117
00:39:28,596 --> 00:39:30,596
他显然是一个很棒的的订阅用户


1118
00:39:31,236 --> 00:39:32,276
我们希望给予他们一些奖励


1119
00:39:33,196 --> 00:39:35,716
如果我们查看


1120
00:39:35,716 --> 00:39:37,646
服务器上的用户表


1121
00:39:37,646 --> 00:39:39,306
你将看到我们一直在捕捉续订周期


1122
00:39:39,896 --> 00:39:41,616
这是通过存储在


1123
00:39:41,616 --> 00:39:42,896
App 收据中的信息找到的


1124
00:39:45,196 --> 00:39:46,486
如果我们回顾


1125
00:39:46,486 --> 00:39:48,876
用户的时间线


1126
00:39:49,096 --> 00:39:50,636
我们现在可以将该用户


1127
00:39:50,636 --> 00:39:52,646
标记为有资格享受忠诚用户优惠


1128
00:39:52,646 --> 00:39:54,096
因为他们已经越过了一个阈值


1129
00:39:54,126 --> 00:39:56,666
所以我们认为这些用户值得奖励


1130
00:39:57,716 --> 00:39:59,356
在下一次


1131
00:39:59,356 --> 00:40:01,046
使用 App 时


1132
00:40:01,046 --> 00:40:02,266
你可以通过


1133
00:40:02,266 --> 00:40:03,956
比如一个月的免费订阅


1134
00:40:03,956 --> 00:40:04,976
来奖励他们的服务和忠诚度


1135
00:40:09,106 --> 00:40:10,466
在这里 我们看到一个


1136
00:40:10,466 --> 00:40:12,526
《Luminary》开发者的例子


1137
00:40:12,576 --> 00:40:14,166
他们奖励早期的高级用户


1138
00:40:14,786 --> 00:40:16,256
如果现在激活


1139
00:40:16,256 --> 00:40:18,656
用户就能享受额外的两个月的服务


1140
00:40:22,536 --> 00:40:25,446
最后让我们谈谈挽留优惠


1141
00:40:26,846 --> 00:40:28,506
挽留优惠


1142
00:40:28,506 --> 00:40:30,466
和保留优惠十分相似


1143
00:40:31,846 --> 00:40:33,866
作为一名开发者


1144
00:40:33,866 --> 00:40:35,506
你可能掌握一些信息


1145
00:40:35,506 --> 00:40:37,926
使你相信这个用户可能会流失


1146
00:40:38,606 --> 00:40:39,966
这指的是


1147
00:40:39,966 --> 00:40:41,996
在用户可能采取行动


1148
00:40:41,996 --> 00:40:43,506
进入“管理订阅”界面


1149
00:40:43,506 --> 00:40:44,506
并取消订阅之前


1150
00:40:46,076 --> 00:40:47,926
如果你发现


1151
00:40:48,116 --> 00:40:49,756
其中一个有流失倾向的用户


1152
00:40:49,756 --> 00:40:51,956
进入到


1153
00:40:52,006 --> 00:40:53,306
你在 App 内部的设置界面中


1154
00:40:53,306 --> 00:40:54,576
安置的的一个深链接


1155
00:40:54,576 --> 00:40:56,836
使得他跳转到


1156
00:40:57,026 --> 00:40:58,476
Apple 的“管理订阅”界面


1157
00:40:58,476 --> 00:41:00,576
你可以在这名用户


1158
00:41:00,576 --> 00:41:03,776
跳转到 Apple 的


1159
00:41:03,776 --> 00:41:05,436
“管理订阅”界面之前


1160
00:41:05,436 --> 00:41:06,946
向他展示一个订阅优惠


1161
00:41:11,046 --> 00:41:12,276
以上是六个不同的例子


1162
00:41:12,276 --> 00:41:14,126
向你展示了


1163
00:41:14,126 --> 00:41:16,366
如何使用订阅优惠


1164
00:41:16,366 --> 00:41:18,806
来最小化 App 的用户自主流失


1165
00:41:19,506 --> 00:41:21,596
但这仅仅是一个开始


1166
00:41:21,596 --> 00:41:22,956
我非常兴奋地看到


1167
00:41:22,956 --> 00:41:25,006
作为开发者


1168
00:41:25,006 --> 00:41:26,566
你能够提出一些


1169
00:41:26,566 --> 00:41:27,756
非常棒的想法


1170
00:41:27,756 --> 00:41:29,636
为你的 App 中的订阅用户


1171
00:41:29,636 --> 00:41:30,626
提供良好的用户体验


1172
00:41:35,046 --> 00:41:36,546
在订阅优惠


1173
00:41:36,546 --> 00:41:37,766
被分配给用户之后


1174
00:41:38,346 --> 00:41:40,086
下一步是


1175
00:41:40,216 --> 00:41:43,356
分析订阅优惠的性能


1176
00:41:43,926 --> 00:41:47,766
今天 我很高兴地宣布


1177
00:41:47,846 --> 00:41:50,416
我们推出了两个全新的报告仪表盘


1178
00:41:50,416 --> 00:41:51,746
能够帮助你


1179
00:41:51,746 --> 00:41:53,476
分析订阅活动


1180
00:41:53,476 --> 00:41:55,326
订阅状态仪表盘


1181
00:41:55,326 --> 00:41:56,796
和订阅事件仪表盘


1182
00:41:57,306 --> 00:42:00,656
让我们看一看 App Store Connect


1183
00:42:01,706 --> 00:42:03,036
如果你导航到


1184
00:42:03,036 --> 00:42:05,236
销售和趋势模块


1185
00:42:05,236 --> 00:42:06,506
你将看到


1186
00:42:06,506 --> 00:42:07,486
我们推出的订阅状态指示板


1187
00:42:08,276 --> 00:42:09,926
这个仪表盘允许你


1188
00:42:09,926 --> 00:42:11,816
随着时间的推移


1189
00:42:12,186 --> 00:42:13,376
了解你的订阅用户基础


1190
00:42:14,176 --> 00:42:18,056
例如 你将能够在标准价格


1191
00:42:18,056 --> 00:42:20,076
与试用优惠


1192
00:42:20,506 --> 00:42:22,506
或订阅优惠之间比较


1193
00:42:22,506 --> 00:42:23,436
精确地查看有多少订阅用户


1194
00:42:24,956 --> 00:42:26,916
这是一个很好的工具


1195
00:42:26,916 --> 00:42:28,356
帮助你查看和分析


1196
00:42:28,356 --> 00:42:29,466
你的订阅用户在不同时间


1197
00:42:29,466 --> 00:42:29,956
和地区的增长情况


1198
00:42:33,066 --> 00:42:37,836
此外 你还可以使用此仪表盘


1199
00:42:38,146 --> 00:42:39,996
查看 App 中的用户


1200
00:42:39,996 --> 00:42:41,976
正在选择哪些优惠


1201
00:42:46,166 --> 00:42:47,516
我们还启用了


1202
00:42:47,516 --> 00:42:49,226
全新的订阅事件仪表盘


1203
00:42:49,976 --> 00:42:52,316
它允许你


1204
00:42:52,316 --> 00:42:53,416
随时查看


1205
00:42:53,416 --> 00:42:55,006
用户订阅活动


1206
00:42:56,266 --> 00:42:57,596
你可以使用它


1207
00:42:57,596 --> 00:42:58,826
来查看用户如何转换到


1208
00:42:58,826 --> 00:42:59,846
订阅的标准价格


1209
00:42:59,846 --> 00:43:02,156
或者你甚至可以


1210
00:43:02,156 --> 00:43:03,666
使用它来了解


1211
00:43:03,906 --> 00:43:06,176
新订阅用户


1212
00:43:06,176 --> 00:43:07,166
与回归的订阅用户的比率


1213
00:43:11,046 --> 00:43:12,326
通过应用正确的过滤器


1214
00:43:12,736 --> 00:43:13,776
你还可以使用它


1215
00:43:13,776 --> 00:43:15,556
来具体查看


1216
00:43:15,556 --> 00:43:17,036
特定的订阅优惠


1217
00:43:17,626 --> 00:43:19,456
如何赢回以前未订阅的用户


1218
00:43:19,496 --> 00:43:21,776
然后你可以


1219
00:43:21,776 --> 00:43:23,826
使用这些信息


1220
00:43:23,826 --> 00:43:25,656
通知和优化你的订阅优惠


1221
00:43:25,656 --> 00:43:27,916
并决定在何时分配优惠


1222
00:43:31,046 --> 00:43:33,156
总而言之


1223
00:43:33,156 --> 00:43:35,226
如果你从今天的会议中


1224
00:43:35,226 --> 00:43:36,986
学习到了什么


1225
00:43:36,986 --> 00:43:37,806
我们希望是实现订阅优惠


1226
00:43:38,446 --> 00:43:41,996
但是你必须在 App 内


1227
00:43:41,996 --> 00:43:44,056
和服务器上实现它们


1228
00:43:44,616 --> 00:43:47,426
我们强烈建议你


1229
00:43:47,426 --> 00:43:49,046
执行详细的


1230
00:43:49,046 --> 00:43:49,996
用户资格规则


1231
00:43:50,676 --> 00:43:51,906
通过使用


1232
00:43:51,906 --> 00:43:54,926
来自收据的信息


1233
00:43:54,986 --> 00:43:56,336
我们更新了服务器到服务器的通知


1234
00:43:56,336 --> 00:43:57,776
以便你能够实时了解


1235
00:43:57,776 --> 00:43:59,606
用户活动


1236
00:44:00,146 --> 00:44:03,216
并获得只有开发者能够拥有


1237
00:44:03,216 --> 00:44:05,626
且 Apple 不会拥有的数据


1238
00:44:08,046 --> 00:44:09,356
我们鼓励你向用户提供


1239
00:44:09,446 --> 00:44:11,856
内容定向的订阅优惠


1240
00:44:11,956 --> 00:44:14,636
我们希望你这样做


1241
00:44:14,636 --> 00:44:16,046
以便在 App 中


1242
00:44:16,046 --> 00:44:18,436
提供最佳的用户体验


1243
00:44:18,836 --> 00:44:23,556
最后 在订阅优惠被分发到用户之后


1244
00:44:23,596 --> 00:44:25,216
建议你使用我们的两个


1245
00:44:25,216 --> 00:44:27,106
全新的报告仪表盘


1246
00:44:27,106 --> 00:44:28,896
来监视这些


1247
00:44:28,896 --> 00:44:35,986
订阅优惠的性能 获取更多信息


1248
00:44:35,986 --> 00:44:37,336
欢迎大家


1249
00:44:37,336 --> 00:44:38,496
在演讲之后的下午 3 点


1250
00:44:38,496 --> 00:44:41,146
来到我们的实验室


1251
00:44:41,916 --> 00:44:44,106
感谢今天所有参加


1252
00:44:44,106 --> 00:44:45,336
“订阅优惠”会议的各位


1253
00:44:45,336 --> 00:44:46,766
我真的很期待


1254
00:44:46,766 --> 00:44:48,006
能够看到你们在你们的 App 中


1255
00:44:48,006 --> 00:44:49,256
做出怎样的创新


1256
00:44:49,256 --> 00:44:50,496
为我们共同的用户


1257
00:44:50,496 --> 00:44:51,296
提供优异的使用体验


1258
00:44:51,706 --> 00:44:51,976
谢谢大家


1259
00:44:52,516 --> 00:44:55,500
[掌声]

