1
00:00:07,107 --> 00:00:11,111 line:0
（语义分割蒙版）


2
00:00:11,178 --> 00:00:12,679 line:0
大家好 我是Jacob


3
00:00:12,746 --> 00:00:15,649 line:-1
今天我向大家介绍的是语义分割蒙版


4
00:00:15,716 --> 00:00:19,186 line:-1
首先 我会谈谈这些新的蒙版是什么


5
00:00:19,253 --> 00:00:20,654 line:-1
之后 David会和你们介绍


6
00:00:20,721 --> 00:00:23,957 line:-2
如何运用Core Image
来处理这些新的蒙版


7
00:00:25,359 --> 00:00:29,329 line:-2
在iOS 12中
我们向大家介绍了人像效果蒙版


8
00:00:29,396 --> 00:00:34,701 line:-2
这是一款专门为
肖像的效果处理而设计的蒙版


9
00:00:35,035 --> 00:00:39,439 line:-2
我们在内部用该蒙版来对人像模式
和人像光效下的照片进行渲染


10
00:00:39,506 --> 00:00:41,008 line:-1
让照片更美


11
00:00:41,975 --> 00:00:45,445 line:-1
让我们细看人像效果蒙版


12
00:00:46,180 --> 00:00:50,317 line:-2
你可以看到该蒙版将
前景图像清晰地从背景中


13
00:00:50,384 --> 00:00:51,685 line:-1
勾勒出来


14
00:00:51,752 --> 00:00:55,923 line:-1
所以 这是一副美丽的黑白蒙版


15
00:00:55,989 --> 00:01:00,360 line:-1
前景取值为1 背景为0


16
00:01:02,062 --> 00:01:03,230 line:-1
在iOS 13中


17
00:01:03,297 --> 00:01:06,433 line:-1
我们进一步提升了语义分割蒙版


18
00:01:07,501 --> 00:01:09,136 line:-1
你可以看到头发


19
00:01:12,105 --> 00:01:13,006 line:-1
皮肤


20
00:01:14,341 --> 00:01:15,275 line:-1
还有牙齿


21
00:01:17,511 --> 00:01:20,280 line:-1
所以 我们以头发蒙版为例来细看


22
00:01:20,347 --> 00:01:24,785 line:-2
你可以看到
它能够清晰地将头发区域


23
00:01:24,852 --> 00:01:26,153 line:-1
与非头发区域区分开来


24
00:01:26,220 --> 00:01:29,289 line:-2
所以 我们在背景上可以看到
更为细致的头发


25
00:01:29,356 --> 00:01:32,993 line:-2
同时 头发与非头发区域
也得到了更好区分


26
00:01:34,528 --> 00:01:37,431 line:-1
同样的 对于皮肤区域


27
00:01:37,497 --> 00:01:41,935 line:-1
alpha值表示皮肤像素的大小


28
00:01:42,269 --> 00:01:43,871 line:-1
比如alpha值为0.7


29
00:01:43,937 --> 00:01:47,674 line:-1
就表示皮肤像素为70%


30
00:01:48,208 --> 00:01:51,178 line:-1
所以 我们希望这三种蒙版


31
00:01:51,245 --> 00:01:53,580 line:-1
可以让你自由创作


32
00:01:54,114 --> 00:01:57,317 line:-1
渲染出更酷的效果和更美的图片


33
00:01:58,952 --> 00:02:00,320 line:-1
要注意的一些事情是


34
00:02:00,387 --> 00:02:03,457 line:-1
该蒙版是原图大小的一半


35
00:02:03,824 --> 00:02:06,393 line:-2
也就是说它的每个维度
都是原图的一半


36
00:02:06,460 --> 00:02:08,095 line:-1
那么整个蒙版就是原图的四分之一


37
00:02:08,929 --> 00:02:10,364 line:-1
你还要记住另一件事情


38
00:02:10,430 --> 00:02:13,133 line:-1
这些分割蒙版会重叠


39
00:02:13,200 --> 00:02:16,069 line:-2
因此 对于本身就会
重叠的人像效果蒙版


40
00:02:16,136 --> 00:02:18,172 line:-1
和皮肤蒙版来说更是如此


41
00:02:20,674 --> 00:02:23,610 line:-1
所以这些蒙版并不能自由移动


42
00:02:23,677 --> 00:02:25,479 line:-1
我们利用Apple神经网络引擎


43
00:02:25,546 --> 00:02:27,948 line:-1
进行谱图机器学习


44
00:02:28,015 --> 00:02:30,450 line:-1
让我们更深入来看


45
00:02:30,517 --> 00:02:32,553 line:-1
我们获取原图


46
00:02:32,619 --> 00:02:34,354 line:-1
将其放入Apple神经网络引擎中


47
00:02:34,421 --> 00:02:36,089 line:-1
通过引擎和原图


48
00:02:36,156 --> 00:02:38,458 line:-1
我们用高度相容的蒙版


49
00:02:38,525 --> 00:02:42,162 line:-1
渲染出这些高分辨率 高质量的图片


50
00:02:42,429 --> 00:02:44,731 line:-2
之后可以将他们嵌至
HEIF或JPG文件中


51
00:02:44,798 --> 00:02:45,666 line:-1
如你所知


52
00:02:45,732 --> 00:02:49,770 line:-1
与原图和iOS 11的原深感一起


53
00:02:51,872 --> 00:02:56,176 line:-2
因此 生成这两种蒙版
有两种不同的方式


54
00:02:56,710 --> 00:02:59,379 line:-2
首先 因为它们已经嵌入
所有人像模式捕捉中


55
00:02:59,446 --> 00:03:01,148 line:-1
所以你可以直接从文件中抓取出来


56
00:03:01,415 --> 00:03:03,483 line:-2
或者更好的是你自己写一个
图像捕捉app


57
00:03:03,550 --> 00:03:05,719 line:-1
再将这些蒙版加入到捕捉中


58
00:03:06,420 --> 00:03:09,022 line:-1
如果你有自带分割蒙版的文件


59
00:03:09,089 --> 00:03:12,259 line:-2
你可通过Core Image和
Image I/O对其进行编辑


60
00:03:12,326 --> 00:03:13,894 line:-1
David之后会进一步说到这个


61
00:03:14,695 --> 00:03:18,799 line:-2
我先谈谈如何用
AV Foundation API进行图像捕捉


62
00:03:22,503 --> 00:03:24,371 line:-1
我们要进行有关扩展的


63
00:03:24,438 --> 00:03:25,672 line:-1
四个阶段


64
00:03:25,739 --> 00:03:28,742 line:-2
第一阶段是建立
AVCapturePhotoOutput


65
00:03:28,809 --> 00:03:31,512 line:-1
第二阶段是在app生命周期内


66
00:03:31,578 --> 00:03:33,847 line:-1
捕捉请求被唤起时


67
00:03:34,715 --> 00:03:35,916 line:-1
之后是两个回调


68
00:03:35,983 --> 00:03:38,986 line:-1
一个是捕捉设置已解决时


69
00:03:39,052 --> 00:03:40,120 line:-1
最后一个


70
00:03:40,187 --> 00:03:42,456 line:-1
是照片处理完成时


71
00:03:42,523 --> 00:03:44,591 line:-1
关于该过程的详细介绍


72
00:03:44,658 --> 00:03:48,295 line:-2
可观看Brad在
2017年的专项演讲


73
00:03:50,898 --> 00:03:53,901 line:-2
我们先来介绍如何建立
AVCapturePhotoOutput


74
00:03:53,967 --> 00:03:57,538 line:-1
这经常会在你配置会话的时候使用


75
00:03:58,372 --> 00:04:01,275 line:-1
这时你已经在会话点开始配置了


76
00:04:01,341 --> 00:04:02,309 line:-1
你已经设定好了预设


77
00:04:02,376 --> 00:04:06,446 line:-2
添加了设备输入
添加AVCapturePhotoOutput


78
00:04:06,513 --> 00:04:10,784 line:-2
此时就进入到在app
生命周期的任何时刻


79
00:04:10,851 --> 00:04:13,487 line:-2
告诉API你想要分割蒙版的
哪个超集的阶段


80
00:04:15,355 --> 00:04:17,391 line:-1
当你想唤起捕捉请求时


81
00:04:17,457 --> 00:04:19,760 line:-2
你需要指定
AVCapturePhoto设定


82
00:04:20,027 --> 00:04:22,563 line:-1
所以这时你就告诉API


83
00:04:22,629 --> 00:04:24,831 line:-1
这就是我在该特定捕捉中想要的


84
00:04:24,898 --> 00:04:28,769 line:-2
再次强调 你可以指定
你已经启动的东西


85
00:04:28,836 --> 00:04:31,405 line:-2
或者可以指定子集
比如头发或是皮肤


86
00:04:32,372 --> 00:04:34,608 line:-1
现在 你已经唤起了捕捉请求


87
00:04:34,675 --> 00:04:36,610 line:-2
所以你给它
AVCapturePhoto设定


88
00:04:36,677 --> 00:04:39,580 line:-1
也给它你在哪里想召起回调的委托


89
00:04:41,348 --> 00:04:42,382 line:-1
时间飞逝


90
00:04:42,749 --> 00:04:47,187 line:-2
不久之后你就会得到
willBeginCaptureFor回调


91
00:04:48,455 --> 00:04:50,190 line:-1
这就是API告诉你


92
00:04:50,490 --> 00:04:51,792 line:-1
你向它发起了请求


93
00:04:51,859 --> 00:04:53,560 line:-1
但这才是你会得到的


94
00:04:53,627 --> 00:04:55,729 line:-2
所以 这对人像效果蒙版和
语义分割蒙版来说


95
00:04:55,796 --> 00:04:57,164 line:-1
是十分重要的


96
00:04:57,231 --> 00:04:59,166 line:-1
因为在场景中没有人像的话


97
00:04:59,233 --> 00:05:00,868 line:-1
你就得不到蒙版


98
00:05:00,934 --> 00:05:04,938 line:-1
所以你要检查语义分割蒙版的大小


99
00:05:05,005 --> 00:05:06,507 line:-1
在上述情况中的大小就为0


100
00:05:09,543 --> 00:05:10,878 line:-1
更多时间过去了


101
00:05:10,944 --> 00:05:12,679 line:-1
照片处理完成


102
00:05:12,746 --> 00:05:17,551 line:-1
这时AV语义分割蒙版又会重新回来


103
00:05:17,618 --> 00:05:19,386 line:-1
在这种情况中 这就是变量蒙版


104
00:05:19,653 --> 00:05:20,921 line:-1
所以 这一新类别


105
00:05:20,988 --> 00:05:23,824 line:-1
具有与人像效果蒙版


106
00:05:23,891 --> 00:05:25,325 line:-1
同类的方法和属性


107
00:05:25,392 --> 00:05:27,728 line:-2
也就是说你可以根据
Exif数据来旋转


108
00:05:27,794 --> 00:05:32,199 line:-2
每一个I/O文件都可以得到
CVPixelBuffer引用


109
00:05:32,266 --> 00:05:33,467 line:-1
或是字典表达


110
00:05:35,869 --> 00:05:39,006 line:-1
如果你想了解关于如何进行捕捉的


111
00:05:39,072 --> 00:05:43,043 line:-2
生命周期的全部介绍
请参考AVCam样本app


112
00:05:43,443 --> 00:05:45,679 line:-1
其中语义分割蒙版已经更新


113
00:05:45,746 --> 00:05:48,715 line:-1
该app将会带你完成所有的步骤


114
00:05:51,084 --> 00:05:54,121 line:0
接下来有请David 他将会介绍
Core Image的有关内容


115
00:05:59,993 --> 00:06:01,295 line:-1
好 谢谢大家


116
00:06:01,361 --> 00:06:03,597 line:-2
我们刚刚学习了如何用
语义分割蒙版捕捉图像


117
00:06:03,664 --> 00:06:06,533 line:-1
现在我们来做一些好玩的事


118
00:06:06,600 --> 00:06:10,838 line:-2
学习如何利用Core Image
来加一些有趣的效果


119
00:06:10,904 --> 00:06:13,473 line:-1
我接下来要做一个演示


120
00:06:13,540 --> 00:06:16,610 line:-1
但是我要警告你 图片中会有小丑


121
00:06:16,677 --> 00:06:20,848 line:0
所以如果你有小丑恐惧症
或者就是害怕小丑


122
00:06:21,915 --> 00:06:22,883 line:0
那么请挡住你的眼睛


123
00:06:23,383 --> 00:06:26,620 line:-2
好 这是一张在我们的
设备上用人像模式


124
00:06:26,687 --> 00:06:27,788 line:-1
捕捉到的照片


125
00:06:27,855 --> 00:06:32,759 line:-2
我们在这个app里
能够非常容易地看到


126
00:06:32,826 --> 00:06:34,761 line:-1
在这个文件中所有不同的


127
00:06:34,828 --> 00:06:36,363 line:-1
语义分割蒙版


128
00:06:36,830 --> 00:06:41,635 line:-1
我们可以使用一般的人像效果蒙版


129
00:06:41,702 --> 00:06:44,037 line:-1
或者是皮肤蒙版


130
00:06:45,072 --> 00:06:47,007 line:-1
或是头发蒙版


131
00:06:47,474 --> 00:06:48,609 line:-1
又或者是牙齿蒙版


132
00:06:48,942 --> 00:06:50,878 line:-1
你也可以使用Core Image


133
00:06:50,944 --> 00:06:54,081 line:-1
将这些蒙版与其他蒙版结合起来


134
00:06:54,147 --> 00:06:56,083 line:-1
比如我用逻辑运算


135
00:06:56,149 --> 00:07:00,854 line:-2
将这两个蒙版结合起来
创造出了一个眼睛和嘴巴的蒙版


136
00:07:01,555 --> 00:07:03,390 line:-1
如果我回到原图


137
00:07:03,457 --> 00:07:06,393 line:-2
这是一张
我在Apple Park的照片


138
00:07:06,460 --> 00:07:08,028 line:-1
一件很厉害的事情是


139
00:07:09,229 --> 00:07:13,901 line:-2
通过人像效果蒙版
你可以给照片轻易加上背景


140
00:07:13,967 --> 00:07:17,871 line:-2
如你所见
我们可以把我放到马戏团帐篷里


141
00:07:17,938 --> 00:07:20,674 line:-1
虽然背景看起来很像马戏团


142
00:07:21,041 --> 00:07:22,709 line:-1
但是我显得格格不入


143
00:07:22,776 --> 00:07:25,112 line:-1
所以我们就可以使用一些效果


144
00:07:25,179 --> 00:07:29,049 line:-1
比如说 我们可以给我化一个小丑妆


145
00:07:29,416 --> 00:07:34,388 line:-2
或者如果我们还想要进一步的效果
可以给我加上绿色的头发


146
00:07:34,454 --> 00:07:36,723 line:-1
最后 我们可以用其他蒙版


147
00:07:36,790 --> 00:07:38,158 line:-1
给我化个妆


148
00:07:39,193 --> 00:07:42,362 line:-1
所以 这就是我今天想要说的


149
00:07:42,429 --> 00:07:44,965 line:-2
如何在你的app中
实现这些有趣的效果


150
00:07:50,971 --> 00:07:51,805 line:-1
好了


151
00:07:52,673 --> 00:07:56,243 line:-2
有关小丑的东西基本上都已经结束了
你现在可以看屏幕了


152
00:07:57,711 --> 00:07:59,880 line:-1
今天我们要说三件事情


153
00:07:59,947 --> 00:08:03,817 line:-2
一是如何用Core Image
创建蒙版图像


154
00:08:03,884 --> 00:08:06,253 line:-1
如何为这些图像加上滤镜


155
00:08:06,320 --> 00:08:08,922 line:-1
最后 如何保存这些文件


156
00:08:09,323 --> 00:08:12,359 line:-2
首先 我们先来谈谈
如何用Core Image


157
00:08:12,426 --> 00:08:13,393 line:-1
创建蒙版图像


158
00:08:13,460 --> 00:08:14,561 line:-1
有两种方法


159
00:08:14,628 --> 00:08:19,833 line:-2
一是可以用AVCapturePhoto
API来创建蒙版图像


160
00:08:20,100 --> 00:08:23,737 line:-2
之后你就能够创建
Core Image


161
00:08:24,037 --> 00:08:25,672 line:-1
所以 代码非常简单


162
00:08:25,739 --> 00:08:26,773 line:-1
我们想要做的就是


163
00:08:26,840 --> 00:08:29,309 line:-1
运用语义分割蒙版API


164
00:08:29,376 --> 00:08:31,545 line:-1
来制定我们要的是头发


165
00:08:31,612 --> 00:08:33,113 line:-1
皮肤还是牙齿


166
00:08:33,547 --> 00:08:37,351 line:-2
之后会返回到
AVSemanticSegmentationMatte对象


167
00:08:37,751 --> 00:08:40,554 line:-1
由此我们就可以创建CIImage


168
00:08:40,621 --> 00:08:43,924 line:-2
或者通过该对象
我们可以加强CIImage


169
00:08:44,892 --> 00:08:45,826 line:-1
另一种常见的方法是


170
00:08:45,893 --> 00:08:47,694 line:-1
你想创建蒙版图像


171
00:08:47,761 --> 00:08:50,964 line:-2
可以通过从HEIF或
JPG文件来加载


172
00:08:51,231 --> 00:08:54,401 line:-1
这些文件中有你熟悉的主要图像


173
00:08:54,468 --> 00:08:56,203 line:-1
也就是RGB图像


174
00:08:56,270 --> 00:09:00,407 line:-2
但他们也包含辅助图像
比如说人像效果蒙版


175
00:09:00,474 --> 00:09:03,677 line:-1
还有一些我们介绍过的新的蒙版


176
00:09:03,744 --> 00:09:07,481 line:-1
皮肤分割蒙版 或是头发牙齿蒙版


177
00:09:08,315 --> 00:09:09,983 line:-1
代码非常简单


178
00:09:10,050 --> 00:09:13,620 line:-2
从HEIF文件
创建CIImage的代码


179
00:09:13,687 --> 00:09:16,657 line:-2
就是直接说CIImage
然后指定一个URL


180
00:09:16,990 --> 00:09:19,059 line:-1
关于创建辅助图像


181
00:09:19,126 --> 00:09:23,096 line:-2
你要做的就是做相同的调用
再提供一个选项字典


182
00:09:23,163 --> 00:09:26,533 line:-1
指定你想返回的蒙版图像


183
00:09:26,600 --> 00:09:30,938 line:-2
所以 你可以指定
auxiliarySegmentationHairMatte


184
00:09:31,004 --> 00:09:35,542 line:-2
或者你想的话 我们也可以将蒙版
用于其他的语义分割


185
00:09:36,543 --> 00:09:39,046 line:-1
所以 非常简单 就几行代码


186
00:09:40,714 --> 00:09:44,918 line:-2
接下来就讲讲如何
在这些图像中加上效果


187
00:09:45,185 --> 00:09:46,820 line:-1
刚刚我展示了很多效果


188
00:09:46,887 --> 00:09:49,223 line:-1
我就挑一个来重点讲


189
00:09:49,790 --> 00:09:51,024 line:-1
我们要做的是


190
00:09:51,091 --> 00:09:53,393 line:-1
从基础的RGB图像开始


191
00:09:53,827 --> 00:09:55,662 line:-1
然后在上面加上效果


192
00:09:55,729 --> 00:10:00,434 line:-1
比如说我们要做褪色白脸小丑妆


193
00:10:01,001 --> 00:10:03,203 line:-1
所以我们先进行一些校正


194
00:10:03,270 --> 00:10:05,706 line:-1
但这些校正会用于整张图片


195
00:10:05,772 --> 00:10:08,709 line:-1
而我们只想将它限制于皮肤区域


196
00:10:08,976 --> 00:10:10,944 line:-1
所以我们使用皮肤蒙版


197
00:10:11,311 --> 00:10:13,347 line:-1
之后我们将这三张图片结合起来


198
00:10:13,413 --> 00:10:15,015 line:-1
就达到了我们先要的效果


199
00:10:16,416 --> 00:10:19,286 line:-2
让我们来看看它的代码
其实非常简单


200
00:10:20,254 --> 00:10:22,556 line:-2
但首先我想
说说Core Image的


201
00:10:22,623 --> 00:10:25,359 line:-2
顶级功能请求
这能让人们更加容易地


202
00:10:25,425 --> 00:10:29,796 line:-2
发现和使用
我们的200多个内置滤镜


203
00:10:29,863 --> 00:10:34,134 line:-2
这是一个新的标题
叫Core Image CIFilterBuiltins


204
00:10:34,201 --> 00:10:36,803 line:-1
它能够让你使用所有的内置滤镜


205
00:10:36,870 --> 00:10:40,440 line:-2
而不用记住这些滤镜的名字
或是输入的名字


206
00:10:45,312 --> 00:10:46,246 line:-1
真的很棒


207
00:10:46,680 --> 00:10:49,316 line:-2
我来给你们展示
用到这个新标题的一些代码


208
00:10:49,716 --> 00:10:52,019 line:-2
所以我们要做的第一件事
是创建基础图像


209
00:10:52,085 --> 00:10:54,454 line:-2
我们就用contentsOf:url
来调用图像


210
00:10:54,955 --> 00:10:57,457 line:-1
这样就能生成RGB图像了


211
00:10:58,492 --> 00:11:00,327 line:-1
现在 我们来加上一些效果


212
00:11:00,394 --> 00:11:03,330 line:-1
首先我要将它转换为灰度图像


213
00:11:03,397 --> 00:11:06,333 line:-2
之后我要使用一个叫
maximumComponent的滤镜


214
00:11:06,700 --> 00:11:10,304 line:-1
将基础图像输入滤镜中


215
00:11:10,771 --> 00:11:13,273 line:-1
之后再让滤镜进行输出


216
00:11:13,607 --> 00:11:16,610 line:-1
这样就能生成一张像这样的灰度图像


217
00:11:17,477 --> 00:11:20,647 line:-1
但这看起来还不够亮 不像小丑妆


218
00:11:20,714 --> 00:11:22,616 line:-1
所以我们还要再加一个滤镜


219
00:11:22,683 --> 00:11:25,152 line:-1
我们就用gamma校正滤镜


220
00:11:25,219 --> 00:11:29,022 line:-1
该输入就是前一个滤镜的输出


221
00:11:29,089 --> 00:11:32,860 line:-1
之后我们指定gamma函数的幂


222
00:11:33,493 --> 00:11:35,395 line:-1
再要求输出图像


223
00:11:35,996 --> 00:11:40,434 line:-2
你会发现现在
指定gamma滤镜的幂很简单


224
00:11:40,501 --> 00:11:43,837 line:-2
它直接是一个Float
这样你就不用记NSNumber了


225
00:11:46,073 --> 00:11:47,674 line:-1
这是加效果的第一部分


226
00:11:48,041 --> 00:11:49,309 line:-1
接下来我们要做的


227
00:11:49,743 --> 00:11:50,577 line:-1
就是


228
00:11:51,845 --> 00:11:55,215 line:-1
得到皮肤分割滤镜


229
00:11:55,282 --> 00:11:58,051 line:-2
再次强调 正如我前面所说
我们从URL开始


230
00:11:58,118 --> 00:12:00,354 line:-1
指定我们要皮肤滤镜


231
00:12:01,154 --> 00:12:02,623 line:-1
但是 当我们得到图片的时候


232
00:12:02,990 --> 00:12:05,592 line:-1
我们发现它比其他图片要小


233
00:12:05,659 --> 00:12:08,161 line:-2
就像我们前面提到的
它默认是一半大小


234
00:12:09,763 --> 00:12:13,133 line:-1
所以我们要放大来与原图匹配


235
00:12:13,200 --> 00:12:15,102 line:-2
所以我们创建一个
CGAffineTransform


236
00:12:15,169 --> 00:12:18,472 line:-1
将蒙版放大至基础图像大小


237
00:12:18,539 --> 00:12:21,475 line:-1
之后我们将变换用于图像


238
00:12:21,542 --> 00:12:22,709 line:-1
这样就可以生成一个新的图像


239
00:12:22,776 --> 00:12:25,846 line:-1
而新图像能够匹配正确的大小


240
00:12:27,181 --> 00:12:30,484 line:-1
下一步就是将二者结合起来


241
00:12:31,585 --> 00:12:33,987 line:-2
我们用的是
blendWithMask滤镜


242
00:12:34,054 --> 00:12:34,888 line:-1
这很棒


243
00:12:34,955 --> 00:12:37,124 line:-2
在我刚刚展示的例子中
也一直在用这个滤镜


244
00:12:37,958 --> 00:12:39,760 line:-1
我们将背景图像指定为


245
00:12:39,826 --> 00:12:42,930 line:-1
基础RGB图像 看起来就像这样


246
00:12:43,597 --> 00:12:45,799 line:-1
接下来 我们指定输入图像


247
00:12:46,099 --> 00:12:47,334 line:-1
也就是前景图像


248
00:12:47,401 --> 00:12:50,938 line:-1
也就是白脸妆容效果的图像


249
00:12:51,572 --> 00:12:54,842 line:-1
最后 我们指定遮罩图像


250
00:12:55,175 --> 00:12:58,712 line:-1
也就是我刚才展示的图像


251
00:12:59,246 --> 00:13:00,581 line:-1
根据这三个输入


252
00:13:00,647 --> 00:13:02,816 line:-2
你就可以要求
混合效果的滤镜进行输出


253
00:13:03,116 --> 00:13:04,618 line:-1
结果就像这样


254
00:13:05,252 --> 00:13:06,820 line:-1
如你所见 这只是开始


255
00:13:06,887 --> 00:13:08,922 line:-1
你可以将所有有趣的效果结合起来


256
00:13:09,523 --> 00:13:11,758 line:-1
在你的app中生成更好的图像


257
00:13:13,994 --> 00:13:16,630 line:-1
当你加上了这些效果之后就要保存


258
00:13:17,097 --> 00:13:18,632 line:-1
基本上


259
00:13:18,699 --> 00:13:21,368 line:-2
你都会把它们保存为
HEIF或者JPG格式


260
00:13:21,435 --> 00:13:24,605 line:-1
这些格式能够支持保存辅助图像


261
00:13:25,239 --> 00:13:26,406 line:-1
所以 除了主要图像外


262
00:13:26,473 --> 00:13:29,743 line:-1
你还可以保存语义分割蒙版


263
00:13:29,810 --> 00:13:32,613 line:-1
这样你的app或其他app


264
00:13:32,679 --> 00:13:34,581 line:-1
也可以运用这些额外效果


265
00:13:36,250 --> 00:13:37,718 line:-1
代码非常简单


266
00:13:37,784 --> 00:13:41,588 line:-2
运用Core Image的
writeHEIFRepresentation


267
00:13:41,855 --> 00:13:47,461 line:-2
一般你先指定主要图像
也就是你要将其保存到的URL


268
00:13:47,728 --> 00:13:50,697 line:-1
之后是你想保存的像素格式


269
00:13:50,764 --> 00:13:52,866 line:-1
然后是你想保存的色彩空间


270
00:13:53,300 --> 00:13:56,103 line:-1
今天我想强调的是另一种


271
00:13:56,170 --> 00:13:58,505 line:-1
你可以用来保存图片的方法


272
00:13:58,872 --> 00:14:02,876 line:-2
比如说 你可以指定
主要语义分割皮肤蒙版


273
00:14:02,943 --> 00:14:04,478 line:-1
再指定皮肤图像


274
00:14:05,212 --> 00:14:07,648 line:-1
或是头发图像 牙齿图像


275
00:14:07,714 --> 00:14:12,419 line:-2
而所有的这四个图像都会保存到
生成的HEIF或JPG文件中


276
00:14:13,487 --> 00:14:16,256 line:-1
现在还有另一种达到同样效果的方法


277
00:14:16,323 --> 00:14:19,059 line:-1
如果你想的话 你可以保存主要图像


278
00:14:19,126 --> 00:14:24,364 line:-2
再将分割蒙版指定为
AVSemanticSegmentationMatte对象


279
00:14:24,665 --> 00:14:26,667 line:-1
API也非常简单


280
00:14:26,733 --> 00:14:32,506 line:-2
指定URL 主要图像
像素格式和色彩空间


281
00:14:32,873 --> 00:14:35,209 line:-2
在这种情况下
如果你想指定这些对象


282
00:14:35,275 --> 00:14:39,179 line:-2
并保存在文件中 你只需要输
AVSemanticSegmentationMattes


283
00:14:39,246 --> 00:14:41,248 line:-1
再提供一系列蒙版就可以了


284
00:14:43,350 --> 00:14:46,620 line:-2
这就是使用Core Image
和这些蒙版可以做的事


285
00:14:46,687 --> 00:14:51,291 line:-1
今天我谈到了如何为蒙版创建图像


286
00:14:51,358 --> 00:14:53,660 line:-1
如何添加滤镜 以及如何保存


287
00:14:53,727 --> 00:14:56,430 line:-2
我也会提到刚刚
我向你们展示的示例app


288
00:14:56,496 --> 00:14:59,099 line:-1
被写为Photos app插件


289
00:14:59,166 --> 00:15:01,034 line:-1
如果你想了解关于如何


290
00:15:01,101 --> 00:15:03,704 line:-2
在你的app里做到这一点
这样你就可以保存图片


291
00:15:03,770 --> 00:15:07,007 line:-2
不仅保存为HEIF
还可以存进用户的图片库里


292
00:15:07,074 --> 00:15:10,477 line:-1
我建议你参考之前的演讲


293
00:15:10,744 --> 00:15:12,880 line:-1
特别是2014年WWDC的


294
00:15:12,946 --> 00:15:15,549 line:-1
照片框架简介


295
00:15:16,984 --> 00:15:18,619 line:-1
好 谢谢大家


296
00:15:18,685 --> 00:15:20,854 line:-2
期待看到你们运用这些
好用的功能创造出的精彩


297
00:15:20,921 --> 00:15:21,755 line:-1
谢谢

