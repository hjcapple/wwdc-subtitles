1
00:00:17,651 --> 00:00:22,990 line:10%
<c.magenta>（Core Data新特性是什么？</c>
<c.magenta>2004年来持续至今）</c>


2
00:00:26,159 --> 00:00:29,563 line:90%,end
<c.magenta>大家好 欢迎来到演讲210</c>
<c.magenta>本场演讲主题是“Core Data新特性”</c>


3
00:00:30,297 --> 00:00:31,298 line:90%,end
<c.magenta>我是梅利莎</c>


4
00:00:31,365 --> 00:00:32,966 line:90%,end
<c.magenta>Core Data的工程师</c>


5
00:00:33,033 --> 00:00:36,436 line:90%,end
<c.magenta>今天我的同事瑞希</c>
<c.magenta>将会和我一起登台演讲</c>


6
00:00:37,070 --> 00:00:39,673 line:90%,end
<c.magenta>我们将会介绍</c>


7
00:00:39,740 --> 00:00:41,441 line:90%,end
<c.magenta>过去一年里</c>
<c.magenta>我们所做的工作</c>


8
00:00:41,508 --> 00:00:42,943 line:90%,end
<c.magenta>这项工作对我们来说充满乐趣</c>


9
00:00:43,010 --> 00:00:44,578 line:90%,end
<c.magenta>希望你们也会觉得有趣</c>


10
00:00:44,645 --> 00:00:47,681 line:90%,end
<c.magenta>而且对你们的应用开发有用处</c>


11
00:00:48,215 --> 00:00:50,684 line:90%,end
<c.magenta>我们希望本场演讲中</c>
<c.magenta>所涉及的所有技术问题</c>


12
00:00:50,751 --> 00:00:51,852 line:90%,end
<c.magenta>大家都曾经遇到过</c>


13
00:00:52,252 --> 00:00:53,887 line:90%,end
<c.magenta>（路线图）</c>


14
00:00:53,987 --> 00:00:55,322 line:90%,end
<c.magenta>那么 我们在做些什么呢？</c>


15
00:00:55,956 --> 00:00:58,025 line:90%,end
<c.magenta>我们一直在做</c>
<c.magenta>Core Spotlight整合工作</c>


16
00:00:58,959 --> 00:01:00,894 line:90%,end
<c.magenta>我们已经增加一系列的</c>
<c.magenta>新Indexing API</c>


17
00:01:00,961 --> 00:01:03,697 line:90%,end
<c.magenta>我们还增加了另外一项重要功能</c>
<c.magenta>持续性历史跟踪</c>


18
00:01:03,764 --> 00:01:05,532 line:90%,end
<c.magenta>瑞希将会介绍这项功能</c>


19
00:01:05,799 --> 00:01:06,967 line:90%,end
<c.magenta>这是一项很酷的功能</c>


20
00:01:07,034 --> 00:01:08,902 line:90%,end
<c.magenta>我很高兴能够在这里为大家展示</c>


21
00:01:09,837 --> 00:01:13,006 line:90%,end
<c.magenta>首先让阿方斯给大家打一声招呼</c>
<c.magenta>它是我的吉祥物 一直陪伴着我</c>


22
00:01:14,441 --> 00:01:15,442 line:90%,end
<c.magenta>那么Core Spotlight</c>


23
00:01:16,276 --> 00:01:17,477 line:90%,end
<c.magenta>什么是Core Spotlight？</c>


24
00:01:18,345 --> 00:01:19,446 line:90%,end
<c.magenta>讨论Core Spotlight之前</c>


25
00:01:19,513 --> 00:01:21,281 line:90%,end
<c.magenta>首先让我谈谈Spotlight</c>


26
00:01:21,815 --> 00:01:25,219 line:90%,end
<c.magenta>Spotlight是原创性的搜索API</c>
<c.magenta>它是Mac OS 10上的搜索技术</c>


27
00:01:25,285 --> 00:01:28,322 line:90%,end
<c.magenta>它以文档为中心</c>
<c.magenta>这意味着…</c>


28
00:01:28,589 --> 00:01:30,624 line:90%,end
<c.magenta>在Spotlight菜单中</c>


29
00:01:30,691 --> 00:01:33,393 line:90%,end
<c.magenta>进行搜索操作</c>


30
00:01:33,460 --> 00:01:36,263 line:90%,end
<c.magenta>所获得的搜索结果</c>
<c.magenta>将会标识出Spotlight</c>


31
00:01:36,330 --> 00:01:38,365 line:90%,end
<c.magenta>检索到的文档</c>


32
00:01:38,432 --> 00:01:41,201 line:90%,end
<c.magenta>但是不会告诉你</c>
<c.magenta>检索内容位于文档的哪个位置</c>


33
00:01:42,102 --> 00:01:43,737 line:90%,end
<c.magenta>对于数据库来说</c>
<c.magenta>这并不是理想的方法</c>


34
00:01:43,804 --> 00:01:46,006 line:90%,end
<c.magenta>我们知道</c>
<c.magenta>数据库中有大量的记录</c>


35
00:01:47,541 --> 00:01:48,876 line:90%,end
<c.magenta>于是我们推出了</c>
<c.magenta>Core Spotlight</c>


36
00:01:49,343 --> 00:01:50,811 line:90%,end
<c.magenta>Core Spotlight是iOS上的</c>


37
00:01:50,878 --> 00:01:52,446 line:90%,end
<c.magenta>原创性搜索技术</c>


38
00:01:52,513 --> 00:01:54,381 line:90%,end
<c.magenta>它十分适合数据库</c>


39
00:01:54,781 --> 00:01:58,652 line:90%,end
<c.magenta>它不仅会返回</c>
<c.magenta>用户所选择的</c>


40
00:01:58,986 --> 00:02:00,454 line:90%,end
<c.magenta>应用程序和文档</c>


41
00:02:00,787 --> 00:02:02,723 line:90%,end
<c.magenta>而且会告诉你</c>
<c.magenta>搜索内容在文档中的位置</c>


42
00:02:03,123 --> 00:02:05,058 line:90%,end
<c.magenta>你可以在你的应用程序中</c>
<c.magenta>集成这项功能</c>


43
00:02:05,125 --> 00:02:09,530 line:90%,end
<c.magenta>这样就可以提供</c>
<c.magenta>你的用户真正想看到的结果</c>


44
00:02:09,696 --> 00:02:12,065 line:90%,end
<c.magenta>现在Mac OS和iOS</c>
<c.magenta>已经支持这项功能</c>


45
00:02:12,132 --> 00:02:15,068 line:90%,end
<c.magenta>我们认为现在应该将它集成到</c>
<c.magenta>Core Data之中</c>


46
00:02:16,503 --> 00:02:18,071 line:90%,end
<c.magenta>那么Core Spotlight</c>
<c.magenta>是如何运作的？</c>


47
00:02:18,138 --> 00:02:19,306 line:90%,end
<c.magenta>它与Spotlight十分相似</c>


48
00:02:19,573 --> 00:02:20,807 line:90%,end
<c.magenta>当你安装一个应用之后</c>


49
00:02:20,874 --> 00:02:21,975 line:90%,end
<c.magenta>里面会有很多的数据</c>


50
00:02:23,043 --> 00:02:25,512 line:90%,end
<c.magenta>用户进入Spotlight菜单</c>


51
00:02:25,579 --> 00:02:26,947 line:90%,end
<c.magenta>查找应用之中的数据内容</c>


52
00:02:27,147 --> 00:02:29,750 line:90%,end
<c.magenta>比如 一张印度照片</c>


53
00:02:30,384 --> 00:02:36,423 line:90%,end
<c.magenta>Spotlight会启动你的应用</c>
<c.magenta>为你提供一个用户活动</c>


54
00:02:38,592 --> 00:02:40,260 line:90%,end
<c.magenta>你可以用它</c>


55
00:02:40,327 --> 00:02:42,396 line:90%,end
<c.magenta>检索用户想要查找的信息</c>


56
00:02:43,096 --> 00:02:46,033 line:90%,end
<c.magenta>弹出指定窗口</c>
<c.magenta>让用户能够看到搜索结果</c>


57
00:02:47,768 --> 00:02:51,138 line:90%,end
<c.magenta>前面我说过 现在</c>
<c.magenta>Mac OS和iOS已支持此功能</c>


58
00:02:51,438 --> 00:02:54,141 line:90%,end
<c.magenta>今天Core Spotlight团队</c>
<c.magenta>希望我告诉你们</c>


59
00:02:54,575 --> 00:02:56,210 line:10%
<c.magenta>你们也可以使用</c>
<c.magenta>Core Spotlight API</c>


60
00:02:56,276 --> 00:02:59,446 line:10%
<c.magenta>在你们的应用中</c>
<c.magenta>访问Spotlight搜索索引</c>


61
00:02:59,513 --> 00:03:00,514 line:10%
<c.magenta>这真的很酷</c>


62
00:03:00,948 --> 00:03:02,115 line:10%
<c.magenta>它可以完成这些功能</c>


63
00:03:02,282 --> 00:03:04,718 line:10%
<c.magenta>而不会造成在系统中</c>
<c.magenta>留下大量的零长度文件</c>


64
00:03:05,152 --> 00:03:06,253 line:10%
<c.magenta>我真的非常希望</c>


65
00:03:06,320 --> 00:03:09,189 line:10%
<c.magenta>你们喜欢这个功能</c>


66
00:03:11,525 --> 00:03:12,526 line:90%,end
<c.magenta>它是如何运作的呢？</c>


67
00:03:12,593 --> 00:03:15,128 line:90%,end
<c.magenta>Core Spotlight集成</c>
<c.magenta>包含三个基本组件</c>


68
00:03:15,195 --> 00:03:16,763 line:90%,end
<c.magenta>第一个是…</c>


69
00:03:17,197 --> 00:03:20,868 line:90%,end
<c.magenta>我们已经在NSPropertyDescription上</c>
<c.magenta>重新定义Spotlight属性索引的用途</c>


70
00:03:20,934 --> 00:03:23,904 line:90%,end
<c.magenta>用它指示属性</c>
<c.magenta>应该被推入Core Spotlight</c>


71
00:03:25,138 --> 00:03:27,307 line:90%,end
<c.magenta>但我们需要一种方法来说明</c>
<c.magenta>在Spotlight 菜单中</c>


72
00:03:27,374 --> 00:03:28,709 line:90%,end
<c.magenta>应该显示哪些内容</c>


73
00:03:28,876 --> 00:03:29,877 line:90%,end
<c.magenta>我们的表达式为：</c>


74
00:03:29,943 --> 00:03:32,646 line:90%,end
<c.magenta>NSEntityDescription.</c>
<c.magenta>coreSpotlightDisplayNameExpression</c>


75
00:03:33,013 --> 00:03:34,615 line:90%,end
<c.magenta>当然还有Exporter</c>


76
00:03:34,681 --> 00:03:36,617 line:90%,end
<c.magenta>无论何时在应用中进行存储</c>


77
00:03:36,950 --> 00:03:40,454 line:90%,end
<c.magenta>无论将用户进行的任何更改</c>
<c.magenta>推入Core Spotlight Index</c>


78
00:03:42,089 --> 00:03:44,091 line:90%,end
<c.magenta>CoreSpotlightDisplayNameExpression</c>


79
00:03:44,157 --> 00:03:46,360 line:90%,end
<c.magenta>都能够理解这些操作</c>


80
00:03:46,426 --> 00:03:48,161 line:90%,end
<c.magenta>它其实是NSExpression</c>
<c.magenta>的一个实例</c>


81
00:03:48,228 --> 00:03:51,365 line:90%,end
<c.magenta>你将它设置为</c>
<c.magenta>NS Entity Description上的属性</c>


82
00:03:51,965 --> 00:03:55,335 line:90%,end
<c.magenta>在Core Spotlight索引更新时</c>
<c.magenta>将会计算它的值</c>


83
00:03:55,936 --> 00:03:56,970 line:90%,end
<c.magenta>在对象方面…</c>


84
00:03:57,037 --> 00:04:00,474 line:90%,end
<c.magenta>经过更新的托管对象</c>
<c.magenta>作为求值对象参数</c>


85
00:04:00,908 --> 00:04:04,044 line:90%,end
<c.magenta>这样就能够返回</c>
<c.magenta>被推入Core Spotlight的任何内容</c>


86
00:04:04,111 --> 00:04:06,380 line:90%,end
<c.magenta>甚至不是</c>
<c.magenta>基本Core Data类型</c>


87
00:04:06,446 --> 00:04:09,016 line:90%,end
<c.magenta>比如 一个</c>
<c.magenta>CS Localized String实例</c>


88
00:04:09,750 --> 00:04:12,452 line:90%,end
<c.magenta>这些表达式</c>
<c.magenta>进行Keypaths求值</c>


89
00:04:12,519 --> 00:04:14,354 line:90%,end
<c.magenta>但是 更有趣的是</c>


90
00:04:14,421 --> 00:04:17,925 line:90%,end
<c.magenta>它们可以是内建函数</c>
<c.magenta>可以是小写 大写等</c>


91
00:04:18,325 --> 00:04:21,428 line:90%,end
<c.magenta>当然 如果你也可以像我一样</c>
<c.magenta>使用完全随机的函数</c>


92
00:04:21,495 --> 00:04:25,666 line:90%,end
<c.magenta>在你的运行时 寻找类实例</c>


93
00:04:25,732 --> 00:04:28,635 line:90%,end
<c.magenta>调用随机方法以获取内容</c>


94
00:04:29,636 --> 00:04:30,704 line:90%,end
<c.magenta>这是很酷的功能</c>


95
00:04:32,439 --> 00:04:34,474 line:90%,end
<c.magenta>当然</c>
<c.magenta>还有NSCoreDataSpotlightDelegate</c>


96
00:04:34,541 --> 00:04:36,777 line:90%,end
<c.magenta>它相当于一大块的代码</c>


97
00:04:36,844 --> 00:04:37,911 line:90%,end
<c.magenta>完成所有工作</c>


98
00:04:38,846 --> 00:04:41,381 line:90%,end
<c.magenta>它实现CSSearchableIndexDelegate</c>


99
00:04:41,582 --> 00:04:44,017 line:90%,end
<c.magenta>提供所有方法的实现</c>


100
00:04:44,084 --> 00:04:45,619 line:90%,end
<c.magenta>你可以直接使用它</c>


101
00:04:46,553 --> 00:04:48,388 line:90%,end
<c.magenta>它在后台线程上使用单独的存储空间</c>


102
00:04:48,455 --> 00:04:50,157 line:90%,end
<c.magenta>因此你不需要担心</c>


103
00:04:50,224 --> 00:04:52,259 line:90%,end
<c.magenta>Spotlight Exporter</c>
<c.magenta>所做的任何事情</c>


104
00:04:52,326 --> 00:04:55,629 line:90%,end
<c.magenta>阻止你的主视图上下文完成其工作</c>


105
00:04:56,463 --> 00:04:57,297 line:90%,end
<c.magenta>你可以使用</c>


106
00:04:57,364 --> 00:04:59,800 line:90%,end
<c.magenta>NSPersistentStoreDescription</c>
<c.magenta>和一个模型对它进行初始化</c>


107
00:04:59,867 --> 00:05:01,935 line:90%,end
<c.magenta>因此它需要知道其处理的工作是什么</c>


108
00:05:02,870 --> 00:05:05,172 line:90%,end
<c.magenta>你告诉Persistent Store</c>


109
00:05:05,239 --> 00:05:09,076 line:90%,end
<c.magenta>它应该通过</c>
<c.magenta>将Exporter设置为一个选项</c>


110
00:05:09,543 --> 00:05:12,145 line:90%,end
<c.magenta>将其内容导出到</c>
<c.magenta>Core Spotlight</c>


111
00:05:12,212 --> 00:05:15,215 line:90%,end
<c.magenta>当你在PersistentStoreCoordinator上</c>


112
00:05:15,482 --> 00:05:16,750 line:90%,end
<c.magenta>调用NSPersistentStore</c>


113
00:05:17,451 --> 00:05:20,988 line:90%,end
<c.magenta>如果你不喜欢默认行为</c>
<c.magenta>也可以进行重写</c>


114
00:05:21,054 --> 00:05:25,826 line:90%,end
<c.magenta>重写方法是 NSDataCoreSpotlight</c>
<c.magenta>delegate attribute set for object:</c>


115
00:05:26,126 --> 00:05:28,495 line:90%,end
<c.magenta>重写方法可能是这样的</c>


116
00:05:28,896 --> 00:05:30,864 line:90%,end
<c.magenta>我们有一个基本方法</c>


117
00:05:30,931 --> 00:05:33,600 line:90%,end
<c.magenta>它获取超类返回的属性集</c>


118
00:05:34,601 --> 00:05:37,371 line:90%,end
<c.magenta>它通过对象发现</c>
<c.magenta>这是一张照片的实例</c>


119
00:05:37,437 --> 00:05:40,607 line:90%,end
<c.magenta>因为这是一个照片应用</c>
<c.magenta>而且这些照片具有标记</c>


120
00:05:40,674 --> 00:05:42,743 line:90%,end
<c.magenta>当有人搜索内容时…</c>


121
00:05:43,844 --> 00:05:46,847 line:90%,end
<c.magenta>当用户搜索内容时</c>
<c.magenta>将返回具有一个这种标记的结果</c>


122
00:05:46,914 --> 00:05:49,183 line:90%,end
<c.magenta>我想要返回一张</c>
<c.magenta>具有这个标记的照片</c>


123
00:05:49,550 --> 00:05:51,351 line:90%,end
<c.magenta>因此标记本身并不吸引人</c>


124
00:05:51,885 --> 00:05:53,987 line:90%,end
<c.magenta>因此我会把所有标记信息</c>


125
00:05:54,054 --> 00:05:57,491 line:90%,end
<c.magenta>堆集到照片对象上</c>
<c.magenta>当Spotlight中有匹配项时</c>


126
00:05:57,691 --> 00:05:59,226 line:90%,end
<c.magenta>将会返回照片</c>


127
00:06:00,027 --> 00:06:02,029 line:90%,end
<c.magenta>然后我返回属性集</c>


128
00:06:02,663 --> 00:06:04,665 line:90%,end
<c.magenta>你们大多数人</c>
<c.magenta>都需要写这么多的代码</c>


129
00:06:04,731 --> 00:06:05,966 line:90%,end
<c.magenta>来实现此功能</c>


130
00:06:07,901 --> 00:06:09,002 line:90%,end
<c.magenta>现在我进行演示</c>


131
00:06:09,369 --> 00:06:10,404 line:90%,end
<c.magenta>（演示）</c>


132
00:06:16,410 --> 00:06:17,978 line:90%,end
<c.magenta>这里有一个小应用</c>


133
00:06:20,247 --> 00:06:22,349 line:90%,end
<c.magenta>请忽略后面的X Code</c>


134
00:06:23,917 --> 00:06:25,485 line:90%,end
<c.magenta>这个应用显示照片</c>


135
00:06:26,220 --> 00:06:27,754 line:90%,end
<c.magenta>你可以滚动 查看内容</c>


136
00:06:29,489 --> 00:06:32,659 line:90%,end
<c.magenta>点击可以查看</c>


137
00:06:33,794 --> 00:06:34,995 line:90%,end
<c.magenta>是各种各样的人像照片</c>


138
00:06:35,062 --> 00:06:36,730 line:90%,end
<c.magenta>含有少量的元数据信息</c>


139
00:06:37,231 --> 00:06:38,232 line:90%,end
<c.magenta>但是有趣的是</c>


140
00:06:38,832 --> 00:06:41,602 line:90%,end
<c.magenta>现在我可以调出Spotlight</c>
<c.magenta>输入搜索内容</c>


141
00:06:44,171 --> 00:06:48,842 line:90%,end
<c.magenta>例如 在Spotlight中</c>
<c.magenta>输入我所知道的内容</c>


142
00:06:48,909 --> 00:06:51,712 line:90%,end
<c.magenta>它会自动激活我的应用</c>


143
00:06:51,778 --> 00:06:55,215 line:90%,end
<c.magenta>调用application</c>
<c.magenta>continue user activity方法</c>


144
00:06:55,549 --> 00:06:56,917 line:90%,end
<c.magenta>使用NS user activity</c>


145
00:06:57,317 --> 00:07:00,521 line:90%,end
<c.magenta>我已经跳入这个方法</c>
<c.magenta>看看其执行结果</c>


146
00:07:00,687 --> 00:07:03,390 line:90%,end
<c.magenta>“有人打开了某物”</c>


147
00:07:03,624 --> 00:07:07,261 line:90%,end
<c.magenta>我要挖掘用户活动用户信息</c>


148
00:07:07,327 --> 00:07:09,096 line:90%,end
<c.magenta>因为那里有我们需要的内容</c>


149
00:07:10,497 --> 00:07:11,798 line:90%,end
<c.magenta>然后查找标识符</c>


150
00:07:12,432 --> 00:07:14,434 line:90%,end
<c.magenta>如果我打印出标识符</c>
<c.magenta>我们可以看到</c>


151
00:07:14,635 --> 00:07:18,539 line:90%,end
<c.magenta>有很多的标识符和用户信息</c>


152
00:07:18,605 --> 00:07:21,108 line:90%,end
<c.magenta>是托管对象ID</c>
<c.magenta>字符串表示</c>


153
00:07:21,608 --> 00:07:24,411 line:90%,end
<c.magenta>我要将它转换成为URI</c>


154
00:07:24,711 --> 00:07:28,282 line:90%,end
<c.magenta>要求persistent StoreCoordinator</c>
<c.magenta>将它转换成为托管对象ID</c>


155
00:07:30,717 --> 00:07:31,985 line:90%,end
<c.magenta>然后我继续</c>


156
00:07:33,854 --> 00:07:34,922 line:90%,end
<c.magenta>哇</c>


157
00:07:36,623 --> 00:07:40,093 line:90%,end
<c.magenta>我打开了用户请求的照片</c>


158
00:07:40,928 --> 00:07:43,964 line:90%,end
<c.magenta>多么可爱的视图</c>


159
00:07:46,366 --> 00:07:47,201 line:90%,end
<c.magenta>这就是</c>


160
00:07:47,768 --> 00:07:49,870 line:90%,end
<c.magenta>Core Spotlight Integration工作原理</c>


161
00:07:49,937 --> 00:07:51,238 line:90%,end
<c.magenta>我们已经完成大部分工作</c>


162
00:07:51,305 --> 00:07:56,176 line:90%,end
<c.magenta>你需要实现方法就可以了</c>


163
00:07:56,877 --> 00:07:58,512 line:90%,end
<c.magenta>这就是Core Spotlight Integration</c>


164
00:07:59,379 --> 00:08:00,948 line:90%,end
<c.magenta>（便利之处）</c>


165
00:08:01,014 --> 00:08:03,984 line:90%,end
<c.magenta>我们为你提供一些</c>
<c.magenta>非常好用的便利功能</c>


166
00:08:04,451 --> 00:08:06,820 line:90%,end
<c.magenta>如果你决定启用</c>
<c.magenta>Core Spotlight Integration</c>


167
00:08:07,354 --> 00:08:09,990 line:90%,end
<c.magenta>传递exporter至…</c>
<c.magenta>作为选项之一</c>


168
00:08:10,057 --> 00:08:12,259 line:90%,end
<c.magenta>当你添加store到persistent</c>
<c.magenta>store coordinator时</c>


169
00:08:12,659 --> 00:08:14,361 line:90%,end
<c.magenta>当你的应用首次启动时</c>


170
00:08:14,428 --> 00:08:16,797 line:90%,end
<c.magenta>我们将自动开始导出到</c>
<c.magenta>Core Spotlight</c>


171
00:08:16,864 --> 00:08:19,766 line:90%,end
<c.magenta>将会继续导出</c>
<c.magenta>自动导出所有数据</c>


172
00:08:19,833 --> 00:08:21,835 line:90%,end
<c.magenta>即使你的应用已经退出</c>


173
00:08:21,902 --> 00:08:23,837 line:90%,end
<c.magenta>如果你的用户同时退出应用</c>


174
00:08:24,304 --> 00:08:25,873 line:90%,end
<c.magenta>我们使用持续性历史跟踪功能</c>


175
00:08:25,939 --> 00:08:27,574 line:90%,end
<c.magenta>确保所有数据被推入</c>


176
00:08:28,075 --> 00:08:30,544 line:90%,end
<c.magenta>即使你的应用崩溃 退出</c>


177
00:08:31,078 --> 00:08:33,145 line:90%,end
<c.magenta>运行不正常</c>


178
00:08:35,249 --> 00:08:36,450 line:90%,end
<c.magenta>（不便之处）</c>


179
00:08:36,517 --> 00:08:37,818 line:90%,end
<c.magenta>有少量的不便之处</c>


180
00:08:37,885 --> 00:08:39,653 line:90%,end
<c.magenta>Core Spotlight</c>
<c.magenta>和Spotlight Integration</c>


181
00:08:39,720 --> 00:08:41,722 line:90%,end
<c.magenta>如果你同时实现这两种功能</c>
<c.magenta>它们是互相排斥的</c>


182
00:08:41,788 --> 00:08:43,890 line:90%,end
<c.magenta>如果你将实体设置到</c>
<c.magenta>Core Spotlight</c>


183
00:08:44,458 --> 00:08:48,362 line:90%,end
<c.magenta>Display Name Expression</c>
<c.magenta>属性存储在外部记录中</c>


184
00:08:49,496 --> 00:08:51,298 line:90%,end
<c.magenta>模型编译器将会报错</c>


185
00:08:52,132 --> 00:08:54,735 line:90%,end
<c.magenta>目前我们不追踪</c>
<c.magenta>批处理操作的结果</c>


186
00:08:56,770 --> 00:08:58,138 line:90%,end
<c.magenta>一些不便之处</c>


187
00:08:58,205 --> 00:09:00,374 line:90%,end
<c.magenta>第一个是我在调试时发现的</c>


188
00:09:00,440 --> 00:09:03,277 line:90%,end
<c.magenta>因为我在单独框架中</c>
<c.magenta>构建我的所有单元测试</c>


189
00:09:03,343 --> 00:09:06,747 line:90%,end
<c.magenta>由XCTest运行</c>
<c.magenta>并没有这种授权</c>


190
00:09:06,813 --> 00:09:09,550 line:90%,end
<c.magenta>这会造成困惑</c>
<c.magenta>让我无法与Spotlight对话</c>


191
00:09:10,350 --> 00:09:12,719 line:90%,end
<c.magenta>无论任何应用</c>
<c.magenta>想要与Spotlight对话</c>


192
00:09:12,786 --> 00:09:16,723 line:90%,end
<c.magenta>都需要com.apple.</c>
<c.magenta>application-identifier授权</c>


193
00:09:17,157 --> 00:09:18,458 line:90%,end
<c.magenta>你们大多数都会默认获得授权</c>


194
00:09:18,525 --> 00:09:21,562 line:90%,end
<c.magenta>但是如果你想要编写单元测试</c>
<c.magenta>并由XCTtest运行</c>


195
00:09:22,229 --> 00:09:23,230 line:90%,end
<c.magenta>请认识到这一点</c>


196
00:09:23,463 --> 00:09:25,532 line:90%,end
<c.magenta>当然你需要处理搜索结果</c>


197
00:09:26,934 --> 00:09:29,002 line:90%,end
<c.magenta>你需在application delegate上</c>


198
00:09:30,237 --> 00:09:32,773 line:90%,end
<c.magenta>实现Application</c>
<c.magenta>Continue User Activity</c>


199
00:09:33,140 --> 00:09:34,908 line:90%,end
<c.magenta>设置你想要的内容</c>


200
00:09:35,209 --> 00:09:36,710 line:90%,end
<c.magenta>我们可以在屏幕上看到</c>


201
00:09:37,177 --> 00:09:39,446 line:90%,end
<c.magenta>也可以在演示中看到</c>
<c.magenta>我在这里显示给大家看</c>


202
00:09:39,880 --> 00:09:41,281 line:90%,end
<c.magenta>这是你们要实现的方法</c>


203
00:09:41,682 --> 00:09:44,685 line:90%,end
<c.magenta>非常简单 抓取用户活动用户信息</c>


204
00:09:45,819 --> 00:09:48,622 line:90%,end
<c.magenta>托管对象ID标识符位于这里</c>


205
00:09:48,689 --> 00:09:51,258 line:90%,end
<c.magenta>隶属于KCS Searchable Item</c>
<c.magenta>Activity Identifier</c>


206
00:09:52,192 --> 00:09:54,027 line:90%,end
<c.magenta>我已经把它转换为托管对象ID</c>


207
00:09:54,494 --> 00:09:56,129 line:90%,end
<c.magenta>然后你们就可以进行想要的操作</c>


208
00:09:56,964 --> 00:10:00,767 line:90%,end
<c.magenta>比如查看新窗口</c>
<c.magenta>缩放到正确的视图大小等</c>


209
00:10:02,836 --> 00:10:05,005 line:90%,end
<c.magenta>存在一些不便之处</c>


210
00:10:05,172 --> 00:10:07,708 line:90%,end
<c.magenta>如果你使用旧的</c>
<c.magenta>Spotlight Integration</c>


211
00:10:08,609 --> 00:10:13,046 line:90%,end
<c.magenta>你需要决定是否删除旧引用文件</c>
<c.magenta>如果磁盘上有这些文件</c>


212
00:10:13,113 --> 00:10:15,182 line:90%,end
<c.magenta>因为我们不知道</c>
<c.magenta>这些文件是否有语义学意义</c>


213
00:10:16,383 --> 00:10:19,286 line:90%,end
<c.magenta>Core Spotlight API是x86指令</c>


214
00:10:19,353 --> 00:10:21,722 line:90%,end
<c.magenta>这意味着此功能</c>
<c.magenta>仅支持x86处理</c>


215
00:10:21,788 --> 00:10:23,724 line:90%,end
<c.magenta>现在是时候升级你的应用了</c>


216
00:10:26,026 --> 00:10:27,027 line:90%,end
<c.magenta>（新Indexing API）</c>


217
00:10:27,094 --> 00:10:31,198 line:90%,end
<c.magenta>关于Core Spotlight就是这些</c>
<c.magenta>我们还增加了新Indexing API</c>


218
00:10:32,833 --> 00:10:35,269 line:90%,end
<c.magenta>那么 indexing是什么呢？</c>
<c.magenta>Indexing让你能够</c>


219
00:10:35,335 --> 00:10:37,404 line:90%,end
<c.magenta>配置你的数据库</c>
<c.magenta>更快地进行搜索</c>


220
00:10:38,438 --> 00:10:40,474 line:90%,end
<c.magenta>你可以有多个索引</c>


221
00:10:40,908 --> 00:10:42,009 line:90%,end
<c.magenta>每个索引可以有多个列</c>


222
00:10:42,075 --> 00:10:44,344 line:90%,end
<c.magenta>一个列可以属于多个索引</c>


223
00:10:44,411 --> 00:10:46,480 line:90%,end
<c.magenta>这让你能够设置大量索引</c>


224
00:10:46,847 --> 00:10:49,850 line:90%,end
<c.magenta>数据库可以使用这些索引</c>
<c.magenta>来选择最高效的索引</c>


225
00:10:50,184 --> 00:10:52,286 line:90%,end
<c.magenta>执行想要的查询</c>


226
00:10:52,352 --> 00:10:54,121 line:90%,end
<c.magenta>其表达方式好像是：</c>


227
00:10:54,388 --> 00:10:57,257 line:90%,end
<c.magenta>“我想要使用这些列</c>
<c.magenta>我将使用这个索引”</c>


228
00:10:57,324 --> 00:10:58,892 line:90%,end
<c.magenta>（题外话：INDEXING）</c>


229
00:10:58,959 --> 00:11:01,261 line:90%,end
<c.magenta>现在我想讨论一些</c>
<c.magenta>关于indexing的题话外</c>


230
00:11:01,328 --> 00:11:03,263 line:90%,end
<c.magenta>主要是针对</c>
<c.magenta>不喜欢使用数据库的人</c>


231
00:11:04,198 --> 00:11:07,067 line:90%,end
<c.magenta>基本的索引形式是二叉树索引</c>


232
00:11:07,134 --> 00:11:08,302 line:90%,end
<c.magenta>支持任何位置和任何数据</c>


233
00:11:09,469 --> 00:11:11,839 line:90%,end
<c.magenta>但是它们仅支持严格比较</c>


234
00:11:11,905 --> 00:11:14,007 line:90%,end
<c.magenta>它们进行数据位比较</c>


235
00:11:14,074 --> 00:11:16,610 line:90%,end
<c.magenta>如果不相同 索引就不匹配</c>


236
00:11:18,145 --> 00:11:20,280 line:90%,end
<c.magenta>但是 更多类型的索引</c>


237
00:11:20,347 --> 00:11:21,915 line:90%,end
<c.magenta>开始得到应用</c>


238
00:11:21,982 --> 00:11:24,051 line:90%,end
<c.magenta>最近 一种非常有用的索引</c>


239
00:11:24,685 --> 00:11:26,653 line:90%,end
<c.magenta>是RTree Index</c>


240
00:11:27,054 --> 00:11:30,657 line:90%,end
<c.magenta>它是一种经过优化的索引</c>
<c.magenta>适用于各种基础搜索</c>


241
00:11:31,291 --> 00:11:33,026 line:90%,end
<c.magenta>二进制索引看起来是这样的</c>


242
00:11:33,093 --> 00:11:34,995 line:90%,end
<c.magenta>这是你的数据</c>


243
00:11:35,062 --> 00:11:36,663 line:90%,end
<c.magenta>设备尺寸之类的数据</c>


244
00:11:36,930 --> 00:11:40,033 line:90%,end
<c.magenta>如果构建一个BTree</c>
<c.magenta>你就会得到这样的东西</c>


245
00:11:40,100 --> 00:11:41,401 line:90%,end
<c.magenta>（二叉树索引）</c>


246
00:11:41,468 --> 00:11:43,770 line:90%,end
<c.magenta>所有节点…</c>


247
00:11:43,837 --> 00:11:46,907 line:90%,end
<c.magenta>子节点中较小的数</c>


248
00:11:46,974 --> 00:11:48,709 line:90%,end
<c.magenta>位于左边</c>


249
00:11:48,775 --> 00:11:51,278 line:90%,end
<c.magenta>所有节点中较大的数</c>
<c.magenta>位于右边</c>


250
00:11:51,345 --> 00:11:53,347 line:90%,end
<c.magenta>然后向下检索</c>
<c.magenta>非常简单</c>


251
00:11:54,014 --> 00:11:56,283 line:90%,end
<c.magenta>但是 RTree Data</c>
<c.magenta>看上去通常是这样的</c>


252
00:11:56,350 --> 00:11:59,286 line:90%,end
<c.magenta>形成很多奇怪的形状</c>


253
00:11:59,353 --> 00:12:00,654 line:90%,end
<c.magenta>是多维图形</c>


254
00:12:00,854 --> 00:12:03,657 line:90%,end
<c.magenta>它们通常互相重叠</c>
<c.magenta>看上去比较奇怪</c>


255
00:12:04,024 --> 00:12:06,627 line:90%,end
<c.magenta>并没有一个很好的方法组织它们</c>


256
00:12:06,693 --> 00:12:09,263 line:90%,end
<c.magenta>以形成方向线性二叉树</c>


257
00:12:09,696 --> 00:12:12,332 line:90%,end
<c.magenta>RTree Data的存储方式</c>
<c.magenta>通常是这样的</c>


258
00:12:12,399 --> 00:12:15,035 line:90%,end
<c.magenta>有一个范围零</c>
<c.magenta>是最小边界块</c>


259
00:12:15,102 --> 00:12:18,539 line:90%,end
<c.magenta>围绕着它的所有子部分</c>
<c.magenta>或称集合元素</c>


260
00:12:19,339 --> 00:12:24,278 line:90%,end
<c.magenta>比如 范围元素</c>
<c.magenta>包含范围R6和R10</c>


261
00:12:24,344 --> 00:12:28,749 line:90%,end
<c.magenta>R6又包含子元素R7</c>
<c.magenta>R7又包含更多子元素</c>


262
00:12:29,049 --> 00:12:30,918 line:90%,end
<c.magenta>这是一种轻度不平衡RTree</c>


263
00:12:30,984 --> 00:12:32,085 line:90%,end
<c.magenta>我们将会适应它</c>


264
00:12:34,755 --> 00:12:37,224 line:90%,end
<c.magenta>当前的indexing API</c>
<c.magenta>有两种类型</c>


265
00:12:37,991 --> 00:12:40,527 line:90%,end
<c.magenta>你可以创建自己的资产索引</c>


266
00:12:40,594 --> 00:12:44,364 line:90%,end
<c.magenta>通过调用</c>
<c.magenta>NSAttributeDescription.isIndexed</c>


267
00:12:44,431 --> 00:12:46,600 line:90%,end
<c.magenta>设置那个资产</c>
<c.magenta>然后为它创建索引</c>


268
00:12:47,100 --> 00:12:48,402 line:90%,end
<c.magenta>如果你想要使用多列索引</c>


269
00:12:48,468 --> 00:12:51,205 line:90%,end
<c.magenta>需要调用NS Entity Description</c>
<c.magenta>compound Indexes</c>


270
00:12:51,505 --> 00:12:52,973 line:90%,end
<c.magenta>这让你能够创建一个索引</c>


271
00:12:53,040 --> 00:12:54,842 line:90%,end
<c.magenta>含有三、四、五个列</c>


272
00:12:55,542 --> 00:12:58,579 line:90%,end
<c.magenta>这些API自动创建</c>


273
00:12:58,645 --> 00:13:01,548 line:90%,end
<c.magenta>一个升序二叉树索引</c>


274
00:13:03,183 --> 00:13:05,185 line:90%,end
<c.magenta>我们希望升级</c>
<c.magenta>Core Data API</c>


275
00:13:05,252 --> 00:13:06,386 line:90%,end
<c.magenta>让它们变得更强大</c>


276
00:13:06,787 --> 00:13:08,956 line:90%,end
<c.magenta>它们能够指向新的数据类型</c>


277
00:13:09,556 --> 00:13:10,424 line:90%,end
<c.magenta>可配置性更强</c>


278
00:13:10,991 --> 00:13:13,327 line:90%,end
<c.magenta>我们增加了大量的新模型类</c>


279
00:13:14,328 --> 00:13:18,799 line:90%,end
<c.magenta>第一个是NSFetchIndexDescription</c>
<c.magenta>NSFetchIndexElementDescription</c>


280
00:13:18,866 --> 00:13:21,935 line:90%,end
<c.magenta>我们为</c>
<c.magenta>NSEntityDescription.indexes</c>


281
00:13:22,002 --> 00:13:24,905 line:90%,end
<c.magenta>增加新方法</c>
<c.magenta>它使用Fetch Index Description</c>


282
00:13:25,339 --> 00:13:27,908 line:90%,end
<c.magenta>一个Fetch index descriptions数组</c>
<c.magenta>作为其参数</c>


283
00:13:28,809 --> 00:13:30,410 line:90%,end
<c.magenta>我们还增加一些函数</c>


284
00:13:30,477 --> 00:13:33,614 line:90%,end
<c.magenta>数据库是否应该使用特定的参数</c>


285
00:13:33,680 --> 00:13:35,582 line:90%,end
<c.magenta>是否进行给定查询求值</c>


286
00:13:36,183 --> 00:13:38,418 line:90%,end
<c.magenta>我们增加索引 让你能够声明</c>


287
00:13:38,485 --> 00:13:39,953 line:90%,end
<c.magenta>“嘿 确实使用这个索引”</c>


288
00:13:40,521 --> 00:13:43,423 line:90%,end
<c.magenta>始终都有索引存在</c>


289
00:13:43,891 --> 00:13:46,326 line:90%,end
<c.magenta>能够比用户查询优化器更准确</c>


290
00:13:46,393 --> 00:13:50,097 line:90%,end
<c.magenta>可以指定不要为where语句</c>
<c.magenta>使用这个特定的索引组件</c>


291
00:13:52,499 --> 00:13:55,836 line:90%,end
<c.magenta>NSFetchIndexElementDescription</c>
<c.magenta>是一个基本组件</c>


292
00:13:55,903 --> 00:14:00,107 line:90%,end
<c.magenta>它允许你指定索引元素</c>
<c.magenta>后者是一个属性</c>


293
00:14:00,974 --> 00:14:03,911 line:90%,end
<c.magenta>你可以指定为属性创建</c>
<c.magenta>何种类型的索引</c>


294
00:14:03,977 --> 00:14:06,613 line:90%,end
<c.magenta>可以是二叉树类型</c>
<c.magenta>或RTree类型</c>


295
00:14:07,047 --> 00:14:09,650 line:90%,end
<c.magenta>如果是二叉树索引</c>
<c.magenta>将会使用指定的检索方向</c>


296
00:14:09,716 --> 00:14:11,051 line:90%,end
<c.magenta>升序或降序</c>


297
00:14:11,251 --> 00:14:13,854 line:90%,end
<c.magenta>如果进行特定类型的搜索</c>
<c.magenta>这一点很重要</c>


298
00:14:13,921 --> 00:14:16,256 line:90%,end
<c.magenta>比如 如果搜索邮件</c>
<c.magenta>你可能想要</c>


299
00:14:16,323 --> 00:14:19,493 line:90%,end
<c.magenta>首先显示最近的邮件</c>
<c.magenta>而不是以前的邮件</c>


300
00:14:19,927 --> 00:14:24,698 line:90%,end
<c.magenta>因此 搜索方向会改变数据库的</c>


301
00:14:24,765 --> 00:14:25,966 line:90%,end
<c.magenta>索引内容查找顺序</c>


302
00:14:28,569 --> 00:14:32,840 line:90%,end
<c.magenta>FetchIndexDescription允许你</c>
<c.magenta>将一系列的Fetch Index Elements</c>


303
00:14:32,906 --> 00:14:35,709 line:90%,end
<c.magenta>组合成一个索引</c>
<c.magenta>然后你可以命名</c>


304
00:14:36,343 --> 00:14:38,545 line:90%,end
<c.magenta>而且你可以设置预测规则</c>


305
00:14:38,712 --> 00:14:42,883 line:90%,end
<c.magenta>规定仅将匹配</c>
<c.magenta>此预测规则的行放入索引</c>


306
00:14:43,617 --> 00:14:46,253 line:90%,end
<c.magenta>它还进行一些索引内容验证</c>


307
00:14:46,320 --> 00:14:49,189 line:90%,end
<c.magenta>确保创建的索引是合理的</c>


308
00:14:50,691 --> 00:14:54,761 line:90%,end
<c.magenta>这里有一些不足之处</c>
<c.magenta>现在你不能混合和匹配索引元素类型</c>


309
00:14:55,095 --> 00:14:57,764 line:90%,end
<c.magenta>要么是RTree索引</c>
<c.magenta>要么是二叉树索引</c>


310
00:14:58,465 --> 00:15:02,069 line:90%,end
<c.magenta>Range Index只能为小于或等于32位的</c>


311
00:15:02,135 --> 00:15:03,237 line:90%,end
<c.magenta>数值资产创建范围索引</c>


312
00:15:03,403 --> 00:15:06,039 line:90%,end
<c.magenta>这是基本SQLite数据库</c>
<c.magenta>所受到的限制</c>


313
00:15:06,940 --> 00:15:09,142 line:90%,end
<c.magenta>如果你要创建自己的增量存储</c>


314
00:15:10,010 --> 00:15:12,813 line:90%,end
<c.magenta>这是一个限制</c>
<c.magenta>如果你遇到问题 请告诉我们</c>


315
00:15:12,880 --> 00:15:13,881 line:90%,end
<c.magenta>也许我们能够想出办法</c>


316
00:15:15,482 --> 00:15:20,020 line:90%,end
<c.magenta>但被放入Ranged Index</c>
<c.magenta>的属性不能是可选的</c>


317
00:15:20,587 --> 00:15:22,623 line:90%,end
<c.magenta>目前没有定义null范围</c>


318
00:15:23,690 --> 00:15:27,027 line:90%,end
<c.magenta>如果你们使用代码构建模型</c>
<c.magenta>有一些人会这样做</c>


319
00:15:27,094 --> 00:15:29,396 line:90%,end
<c.magenta>我曾经在WWDC大会上</c>
<c.magenta>为你们提供帮助</c>


320
00:15:30,163 --> 00:15:33,967 line:90%,end
<c.magenta>如果在设置索引后 改变实体结构</c>


321
00:15:34,434 --> 00:15:36,036 line:90%,end
<c.magenta>我们必须放弃索引</c>


322
00:15:36,103 --> 00:15:38,305 line:90%,end
<c.magenta>这实际上应用于整个实体层级结构</c>


323
00:15:38,372 --> 00:15:40,941 line:90%,end
<c.magenta>如果你在层级结构中</c>


324
00:15:41,008 --> 00:15:43,610 line:90%,end
<c.magenta>增加或删除一个实体</c>


325
00:15:43,677 --> 00:15:46,446 line:90%,end
<c.magenta>我们不能再确定索引是否有效</c>
<c.magenta>因此我们必须放弃索引</c>


326
00:15:46,947 --> 00:15:47,814 line:90%,end
<c.magenta>始终放弃索引</c>


327
00:15:50,751 --> 00:15:56,657 line:90%,end
<c.magenta>你们可能知道 在以前的版本中</c>
<c.magenta>对实体更改索引</c>


328
00:15:56,723 --> 00:15:59,059 line:90%,end
<c.magenta>并不会更改实体版本Hash</c>


329
00:15:59,126 --> 00:16:01,361 line:90%,end
<c.magenta>当用户使用新索引</c>


330
00:16:01,428 --> 00:16:06,433 line:90%,end
<c.magenta>首次启动新版本应用时</c>


331
00:16:06,500 --> 00:16:07,968 line:90%,end
<c.magenta>这意味着不会进行数据迁移</c>


332
00:16:08,402 --> 00:16:09,670 line:90%,end
<c.magenta>因此不会造成性能损失</c>


333
00:16:09,736 --> 00:16:11,872 line:90%,end
<c.magenta>另一方面</c>
<c.magenta>这也不需要迁移数据</c>


334
00:16:11,939 --> 00:16:14,241 line:90%,end
<c.magenta>因此不需要更新索引</c>


335
00:16:14,908 --> 00:16:16,910 line:90%,end
<c.magenta>如果想要迁移索引</c>


336
00:16:16,977 --> 00:16:19,746 line:90%,end
<c.magenta>而且更新索引 你需要调用</c>


337
00:16:19,813 --> 00:16:23,383 line:90%,end
<c.magenta>模型版本Hash Identifier</c>
<c.magenta>这将触发迁移</c>


338
00:16:24,351 --> 00:16:27,487 line:90%,end
<c.magenta>SQL store将会忽略</c>
<c.magenta>它无法理解的任何索引</c>


339
00:16:27,988 --> 00:16:30,490 line:90%,end
<c.magenta>这意味着如果你打开数据库</c>


340
00:16:30,557 --> 00:16:33,026 line:90%,end
<c.magenta>你认为你已经添加索引</c>
<c.magenta>但是却看不到它们</c>


341
00:16:33,594 --> 00:16:35,762 line:90%,end
<c.magenta>可以转到应用控制台</c>
<c.magenta>控制台会告诉你</c>


342
00:16:35,829 --> 00:16:36,964 line:90%,end
<c.magenta>你为什么看不到索引</c>


343
00:16:38,599 --> 00:16:39,967 line:90%,end
<c.magenta>我要再次进行演示</c>


344
00:16:41,034 --> 00:16:42,202 line:90%,end
<c.magenta>这里有一个模型</c>


345
00:16:42,836 --> 00:16:46,006 line:90%,end
<c.magenta>我不想使用</c>


346
00:16:46,073 --> 00:16:49,843 line:90%,end
<c.magenta>因为这是演示</c>
<c.magenta>我可能会输入出错</c>


347
00:16:50,978 --> 00:16:56,149 line:90%,end
<c.magenta>我在新的建模工具中</c>
<c.magenta>添加新索引看起来很简单</c>


348
00:16:56,216 --> 00:17:00,754 line:90%,end
<c.magenta>选择想要添加索引的实体</c>
<c.magenta>然后来到这里</c>


349
00:17:01,188 --> 00:17:05,959 line:90%,end
<c.magenta>添加实体 现在你可以看到</c>
<c.magenta>它有一个Add Fetch Index选项</c>


350
00:17:06,292 --> 00:17:08,362 line:90%,end
<c.magenta>你可以添加一个</c>
<c.magenta>将它命名为by Location</c>


351
00:17:10,864 --> 00:17:13,165 line:90%,end
<c.magenta>然后我可以添加多个属性</c>


352
00:17:14,501 --> 00:17:17,171 line:90%,end
<c.magenta>latitude和longitude属性</c>


353
00:17:18,105 --> 00:17:20,507 line:90%,end
<c.magenta>在这里 选择照片</c>


354
00:17:21,474 --> 00:17:24,278 line:90%,end
<c.magenta>然后在这里 更改</c>
<c.magenta>Version Hash Modifier</c>


355
00:17:27,748 --> 00:17:29,650 line:90%,end
<c.magenta>现在 当用户启动</c>


356
00:17:29,716 --> 00:17:32,286 line:90%,end
<c.magenta>一个使用此模型版本</c>
<c.magenta>的应用时</c>


357
00:17:33,854 --> 00:17:35,689 line:90%,end
<c.magenta>将会使用新的RTree索引</c>


358
00:17:36,523 --> 00:17:39,359 line:90%,end
<c.magenta>我会运行我的演示应用</c>


359
00:17:39,793 --> 00:17:41,495 line:90%,end
<c.magenta>它已经内建这种索引</c>


360
00:17:44,598 --> 00:17:45,832 line:90%,end
<c.magenta>然后…</c>


361
00:17:49,102 --> 00:17:50,337 line:90%,end
<c.magenta>来到这里</c>


362
00:17:50,671 --> 00:17:54,241 line:90%,end
<c.magenta>获取我细心设置的</c>
<c.magenta>Predicate</c>


363
00:17:56,577 --> 00:17:57,678 line:90%,end
<c.magenta>我忘了一件事情</c>


364
00:18:00,414 --> 00:18:03,383 line:90%,end
<c.magenta>我要来到这里 编辑scheme</c>
<c.magenta>因为我们想要看到</c>


365
00:18:03,450 --> 00:18:05,319 line:90%,end
<c.magenta>Core Data</c>
<c.magenta>向数据库发送什么</c>


366
00:18:06,086 --> 00:18:09,223 line:90%,end
<c.magenta>我已经设置</c>
<c.magenta>Com Apple SQL Debug Argument</c>


367
00:18:09,957 --> 00:18:12,993 line:90%,end
<c.magenta>如果你们熟悉SQL Debug</c>
<c.magenta>将会注意到</c>


368
00:18:13,327 --> 00:18:14,995 line:90%,end
<c.magenta>与Core Data中的功能一样</c>


369
00:18:15,395 --> 00:18:17,431 line:90%,end
<c.magenta>你可以非常熟悉</c>


370
00:18:17,497 --> 00:18:19,299 line:90%,end
<c.magenta>1和2作为数字…</c>


371
00:18:19,366 --> 00:18:20,534 line:90%,end
<c.magenta>你即将设置的级别</c>


372
00:18:20,968 --> 00:18:24,771 line:90%,end
<c.magenta>我们增加一个新级别4</c>
<c.magenta>将打印SQLite使用的查询计划</c>


373
00:18:24,838 --> 00:18:29,209 line:90%,end
<c.magenta>和Core Data发送至</c>


374
00:18:29,276 --> 00:18:30,878 line:90%,end
<c.magenta>数据库的所有语句</c>


375
00:18:31,278 --> 00:18:35,682 line:90%,end
<c.magenta>因此我将运行我的应用</c>
<c.magenta>将版本设置为4</c>


376
00:18:38,485 --> 00:18:39,353 line:90%,end
<c.magenta>然后回过头来</c>


377
00:18:41,855 --> 00:18:42,890 line:90%,end
<c.magenta>重置预测规则</c>


378
00:18:44,358 --> 00:18:45,759 line:90%,end
<c.magenta>运行搜索</c>


379
00:18:47,661 --> 00:18:50,898 line:10%
<c.magenta>现在我们来看上次搜索</c>


380
00:18:53,567 --> 00:18:55,702 line:10%
<c.magenta>这更有意思 我来这里</c>


381
00:18:55,769 --> 00:19:00,340 line:10%
<c.magenta>我把早期的版本</c>
<c.magenta>复制并粘贴到Text Edit之中</c>


382
00:19:00,407 --> 00:19:02,075 line:90%,end
<c.magenta>在这里我要放大文本</c>


383
00:19:04,211 --> 00:19:07,781 line:90%,end
<c.magenta>现在我要选择一小段文本</c>


384
00:19:08,916 --> 00:19:10,450 line:90%,end
<c.magenta>Z Photo by Location</c>


385
00:19:10,984 --> 00:19:13,253 line:90%,end
<c.magenta>如果查看查询计划</c>


386
00:19:13,453 --> 00:19:15,489 line:90%,end
<c.magenta>你可以看到</c>
<c.magenta>这是一个虚拟表索引</c>


387
00:19:15,789 --> 00:19:18,592 line:90%,end
<c.magenta>实际是在引导位置查询</c>


388
00:19:18,892 --> 00:19:21,929 line:90%,end
<c.magenta>将经度查询导向</c>
<c.magenta>一个单独的RTree表</c>


389
00:19:22,896 --> 00:19:27,901 line:90%,end
<c.magenta>在这里我们看到</c>
<c.magenta>查询16行用时0.056秒</c>


390
00:19:27,968 --> 00:19:30,737 line:90%,end
<c.magenta>如果与未使用RTree的版本比较</c>


391
00:19:32,372 --> 00:19:34,241 line:90%,end
<c.magenta>这是我们以前的查询</c>


392
00:19:34,308 --> 00:19:36,310 line:90%,end
<c.magenta>这个与这个之间的Z经度</c>


393
00:19:37,177 --> 00:19:41,949 line:90%,end
<c.magenta>我们可以看到</c>
<c.magenta>查询16行用时0.062</c>


394
00:19:42,216 --> 00:19:44,685 line:90%,end
<c.magenta>性能提升约10%</c>


395
00:19:45,118 --> 00:19:48,288 line:90%,end
<c.magenta>在配备SSD Fast Cash</c>
<c.magenta>的笔记本上</c>


396
00:19:48,555 --> 00:19:51,225 line:90%,end
<c.magenta>在你的设备上</c>
<c.magenta>搜索速度提升了10%</c>


397
00:19:51,291 --> 00:19:52,926 line:90%,end
<c.magenta>这是一个很小的数据集</c>


398
00:19:53,160 --> 00:19:56,096 line:90%,end
<c.magenta>如果你设备上的数据大量上升</c>


399
00:19:56,530 --> 00:19:59,800 line:90%,end
<c.magenta>RTree搜索速度相比</c>
<c.magenta>常规Binary Indexes会有大幅提升</c>


400
00:20:01,068 --> 00:20:03,003 line:90%,end
<c.magenta>而且…</c>


401
00:20:04,605 --> 00:20:05,739 line:90%,end
<c.magenta>我已经证明这一点</c>


402
00:20:06,840 --> 00:20:08,008 line:90%,end
<c.magenta>这就是…</c>


403
00:20:10,744 --> 00:20:11,945 line:90%,end
<c.magenta>这就是RTree搜索</c>


404
00:20:12,946 --> 00:20:15,315 line:90%,end
<c.magenta>还有另外一张幻灯片</c>
<c.magenta>然后我将舞台交给瑞希</c>


405
00:20:15,883 --> 00:20:17,851 line:90%,end
<c.magenta>我们还增加一些混杂的</c>


406
00:20:19,720 --> 00:20:21,021 line:90%,end
<c.magenta>新的属性类型</c>


407
00:20:21,455 --> 00:20:25,559 line:90%,end
<c.magenta>增加了NSUUIDA属性类型</c>
<c.magenta>和NSURL属性类型</c>


408
00:20:25,759 --> 00:20:28,962 line:90%,end
<c.magenta>由UUID和URL值类提供支持</c>


409
00:20:33,967 --> 00:20:36,537 line:90%,end
<c.magenta>很高兴你们欣赏</c>
<c.magenta>我们所做的工作</c>


410
00:20:37,004 --> 00:20:38,472 line:90%,end
<c.magenta>现在我邀请瑞希上台</c>


411
00:20:38,539 --> 00:20:40,707 line:90%,end
<c.magenta>（持续性历史跟踪）</c>


412
00:20:41,675 --> 00:20:42,676 line:90%,end
<c.magenta>谢谢</c>


413
00:20:47,514 --> 00:20:49,016 line:90%,end
<c.magenta>大家好 我是瑞希·维尔马</c>


414
00:20:49,082 --> 00:20:51,018 line:90%,end
<c.magenta>我将为大家介绍持续性历史跟踪</c>


415
00:20:52,586 --> 00:20:54,421 line:90%,end
<c.magenta>让我们先聊聊你们的应用</c>


416
00:20:54,955 --> 00:20:57,691 line:90%,end
<c.magenta>你们开发了很多不错的应用</c>
<c.magenta>希望你们已经采用</c>


417
00:20:57,758 --> 00:21:00,394 line:90%,end
<c.magenta>NS Persistent Container</c>
<c.magenta>那是我们去年推出的</c>


418
00:21:00,460 --> 00:21:01,995 line:90%,end
<c.magenta>假设你已经设置</c>
<c.magenta>View Context</c>


419
00:21:02,329 --> 00:21:03,564 line:90%,end
<c.magenta>和Background Context</c>


420
00:21:04,164 --> 00:21:08,001 line:90%,end
<c.magenta>而且创建Shared Container</c>
<c.magenta>而且已设置Persistent Store</c>


421
00:21:09,069 --> 00:21:12,639 line:90%,end
<c.magenta>现在你的View Context是一个连接</c>
<c.magenta>Background Context是另外一个连接</c>


422
00:21:13,106 --> 00:21:17,010 line:90%,end
<c.magenta>也许你已设置Background</c>
<c.magenta>Context 从远程站点</c>


423
00:21:17,077 --> 00:21:19,112 line:90%,end
<c.magenta>下载内容</c>


424
00:21:20,614 --> 00:21:24,017 line:90%,end
<c.magenta>你们是非常勤勉的开发者</c>
<c.magenta>你们创建了</c>


425
00:21:24,084 --> 00:21:28,388 line:90%,end
<c.magenta>文档扩展、共享扩展和照片编辑扩展</c>


426
00:21:28,655 --> 00:21:32,025 line:90%,end
<c.magenta>现在所有这些</c>
<c.magenta>与persistent store之间的连接</c>


427
00:21:32,092 --> 00:21:35,028 line:90%,end
<c.magenta>都可以在任何进程中运行</c>
<c.magenta>因为它们是扩展</c>


428
00:21:35,095 --> 00:21:37,865 line:90%,end
<c.magenta>或者可能来自于程序中的任何上下文</c>


429
00:21:37,931 --> 00:21:40,434 line:90%,end
<c.magenta>你们可能不知道</c>
<c.magenta>这些数据来自于何处</c>


430
00:21:41,235 --> 00:21:43,704 line:90%,end
<c.magenta>我们把它们进行细分</c>
<c.magenta>看看会发生什么</c>


431
00:21:45,973 --> 00:21:47,040 line:90%,end
<c.magenta>不好意思</c>


432
00:21:47,674 --> 00:21:50,277 line:90%,end
<c.magenta>现在我们进入应用</c>


433
00:21:52,479 --> 00:21:54,348 line:90%,end
<c.magenta>用户看到View Context</c>


434
00:21:54,815 --> 00:21:56,450 line:90%,end
<c.magenta>同时还有Background Context</c>


435
00:21:56,517 --> 00:21:59,052 line:90%,end
<c.magenta>正在从某个远程资源下载信息</c>


436
00:21:59,620 --> 00:22:01,788 line:90%,end
<c.magenta>不幸的是我们经常看到的情况是</c>


437
00:22:01,855 --> 00:22:04,391 line:90%,end
<c.magenta>Background Context</c>
<c.magenta>正在下载数据</c>


438
00:22:04,725 --> 00:22:07,494 line:90%,end
<c.magenta>但是View Context可能</c>
<c.magenta>对这些对象并不知情</c>


439
00:22:07,895 --> 00:22:09,897 line:90%,end
<c.magenta>或者它甚至并不关心这些对象</c>


440
00:22:10,364 --> 00:22:13,867 line:90%,end
<c.magenta>但是Save Notifications进入后</c>
<c.magenta>必须处理它们</c>


441
00:22:14,468 --> 00:22:18,605 line:90%,end
<c.magenta>因此如果忽略Background Context</c>


442
00:22:18,672 --> 00:22:19,806 line:90%,end
<c.magenta>可能会忽略一些变更</c>


443
00:22:20,073 --> 00:22:21,808 line:90%,end
<c.magenta>很可能会发生这样的情况</c>


444
00:22:22,075 --> 00:22:24,878 line:90%,end
<c.magenta>你可能忽略Batch Updates</c>
<c.magenta>Batch Deletes</c>


445
00:22:25,078 --> 00:22:26,813 line:90%,end
<c.magenta>它们并不生成保存通知</c>


446
00:22:28,315 --> 00:22:32,553 line:10%
<c.magenta>现在用户进入Safari</c>
<c.magenta>决定共享一些东西</c>


447
00:22:33,053 --> 00:22:34,821 line:10%
<c.magenta>这将写入数据库</c>


448
00:22:35,155 --> 00:22:37,024 line:90%,end
<c.magenta>当开发人员返回应用时</c>


449
00:22:37,925 --> 00:22:41,094 line:90%,end
<c.magenta>或用户返回应用时</c>
<c.magenta>并不知道已经发生哪些变化</c>


450
00:22:41,595 --> 00:22:44,798 line:90%,end
<c.magenta>你知道已经发生变化</c>
<c.magenta>但是并不知详情</c>


451
00:22:45,098 --> 00:22:47,467 line:90%,end
<c.magenta>因此你必须重新扫描</c>
<c.magenta>整个数据库并且查看</c>


452
00:22:47,534 --> 00:22:49,469 line:90%,end
<c.magenta>自你上次离开之后</c>
<c.magenta>发生了哪些变化</c>


453
00:22:50,704 --> 00:22:53,040 line:90%,end
<c.magenta>不幸的是有时候</c>
<c.magenta>我们的应用会崩溃</c>


454
00:22:53,740 --> 00:22:56,743 line:90%,end
<c.magenta>可能是因为用户退出应用</c>


455
00:22:57,110 --> 00:22:59,246 line:90%,end
<c.magenta>而此时Background Context</c>
<c.magenta>正在运行</c>


456
00:22:59,313 --> 00:23:00,547 line:90%,end
<c.magenta>当你的应用恢复运行时</c>


457
00:23:00,981 --> 00:23:04,117 line:90%,end
<c.magenta>Background Context并不知道</c>
<c.magenta>上次离开位置</c>


458
00:23:04,318 --> 00:23:05,719 line:90%,end
<c.magenta>从而扫描本地数据库</c>


459
00:23:06,186 --> 00:23:09,923 line:90%,end
<c.magenta>因此它必须检查远程内容</c>
<c.magenta>重新扫描整个本地数据库</c>


460
00:23:10,123 --> 00:23:12,059 line:90%,end
<c.magenta>以了解需要从何处重新开始</c>


461
00:23:13,794 --> 00:23:15,996 line:90%,end
<c.magenta>让我们来仔细看这个例子</c>


462
00:23:16,630 --> 00:23:19,600 line:90%,end
<c.magenta>我们有一个应用决定载入一些数据</c>


463
00:23:19,900 --> 00:23:24,338 line:90%,end
<c.magenta>因此Background Context载入数据</c>
<c.magenta>然后View Context开始更新</c>


464
00:23:24,938 --> 00:23:28,575 line:90%,end
<c.magenta>现在 用户暂停应用</c>
<c.magenta>文档扩展开始运行</c>


465
00:23:29,843 --> 00:23:32,045 line:90%,end
<c.magenta>我们将看到数据插入两个新对象</c>


466
00:23:33,146 --> 00:23:37,584 line:90%,end
<c.magenta>然后共享扩展开始运行</c>
<c.magenta>更新一个对象并插入另一个对象</c>


467
00:23:38,051 --> 00:23:39,920 line:90%,end
<c.magenta>照片扩展也是如此</c>


468
00:23:40,988 --> 00:23:44,358 line:90%,end
<c.magenta>这些工作完成后 返回应用</c>


469
00:23:45,092 --> 00:23:48,562 line:90%,end
<c.magenta>注意到一些数据已经过时</c>


470
00:23:49,930 --> 00:23:55,202 line:10%
<c.magenta>我们的应用仅知道最初的六个对象</c>


471
00:23:55,669 --> 00:23:57,804 line:10%
<c.magenta>数据库的其余部分已经修改过</c>


472
00:23:57,871 --> 00:24:00,240 line:10%
<c.magenta>或者应用不知道这些对象</c>


473
00:24:00,874 --> 00:24:02,943 line:90%,end
<c.magenta>因此必须查找和扫描所有内容</c>


474
00:24:03,010 --> 00:24:05,179 line:90%,end
<c.magenta>弄清楚哪些内容</c>
<c.magenta>是View Context</c>


475
00:24:05,546 --> 00:24:06,980 line:90%,end
<c.magenta>或Background Context</c>
<c.magenta>所需要的</c>


476
00:24:09,650 --> 00:24:12,152 line:90%,end
<c.magenta>现在我们推出了</c>
<c.magenta>NS Persistent History</c>


477
00:24:12,853 --> 00:24:13,754 line:90%,end
<c.magenta>它相当简单</c>


478
00:24:14,755 --> 00:24:17,558 line:90%,end
<c.magenta>抓取你的Container</c>
<c.magenta>抓取你的Store Description</c>


479
00:24:18,659 --> 00:24:20,894 line:90%,end
<c.magenta>瞧</c>


480
00:24:22,696 --> 00:24:25,432 line:90%,end
<c.magenta>将NS Persistent History Tracking</c>
<c.magenta>选项设置为真</c>


481
00:24:25,933 --> 00:24:29,136 line:90%,end
<c.magenta>现在 我们将跟踪数据库的所有变化</c>


482
00:24:31,572 --> 00:24:34,174 line:90%,end
<c.magenta>让我们回到前面的…</c>
<c.magenta>谢谢</c>


483
00:24:37,344 --> 00:24:39,046 line:90%,end
<c.magenta>我们回到前面的例子</c>


484
00:24:39,313 --> 00:24:40,647 line:90%,end
<c.magenta>回到View Context之中</c>


485
00:24:40,714 --> 00:24:42,549 line:90%,end
<c.magenta>此时Background Context加载数据</c>


486
00:24:43,383 --> 00:24:46,453 line:90%,end
<c.magenta>我们将看到</c>
<c.magenta>事务处理内部所发生的事情</c>


487
00:24:46,787 --> 00:24:48,889 line:90%,end
<c.magenta>此事务处理</c>
<c.magenta>对我的数据库执行写操作</c>


488
00:24:49,223 --> 00:24:53,227 line:90%,end
<c.magenta>我可以看到它是</c>
<c.magenta>由Background Context在应用中完成的</c>


489
00:24:54,161 --> 00:24:58,065 line:90%,end
<c.magenta>当我的跳出应用</c>
<c.magenta>用户启动文档扩展</c>


490
00:25:02,035 --> 00:25:05,539 line:90%,end
<c.magenta>我们看到这也会生成一个事务处理</c>


491
00:25:06,240 --> 00:25:08,208 line:90%,end
<c.magenta>在我的共享扩展上</c>


492
00:25:11,712 --> 00:25:14,548 line:90%,end
<c.magenta>共享扩展也会注意到已经发生修改</c>


493
00:25:14,615 --> 00:25:17,684 line:90%,end
<c.magenta>在这里不会进行插入</c>


494
00:25:18,485 --> 00:25:21,054 line:90%,end
<c.magenta>在照片扩展上 我们也会看到</c>


495
00:25:21,121 --> 00:25:22,422 line:90%,end
<c.magenta>发生第四个事务处理</c>


496
00:25:23,824 --> 00:25:25,492 line:90%,end
<c.magenta>我们将看到它在照片中完成</c>


497
00:25:26,527 --> 00:25:29,730 line:10%
<c.magenta>现在当我的应用回到前台时</c>


498
00:25:30,330 --> 00:25:34,368 line:10%
<c.magenta>仍然有数据</c>
<c.magenta>但是我知道我在历史表中的位置</c>


499
00:25:34,635 --> 00:25:37,271 line:10%
<c.magenta>只需要遍历事务处理1-4</c>


500
00:25:37,804 --> 00:25:39,373 line:10%
<c.magenta>瞧 已经更新了</c>


501
00:25:42,609 --> 00:25:44,344 line:90%,end
<c.magenta>我们引入新的</c>


502
00:25:44,411 --> 00:25:46,947 line:90%,end
<c.magenta>Store Request</c>
<c.magenta>让你获取历史记录</c>


503
00:25:47,447 --> 00:25:49,917 line:90%,end
<c.magenta>其名称为 NS Persistent History</c>
<c.magenta>Change Request</c>


504
00:25:50,384 --> 00:25:52,052 line:90%,end
<c.magenta>你可以启动它</c>


505
00:25:52,119 --> 00:25:55,522 line:90%,end
<c.magenta>通过日期、令牌或事务处理</c>


506
00:25:57,457 --> 00:25:59,993 line:90%,end
<c.magenta>而且你可以很容易地</c>
<c.magenta>设置结果类型</c>


507
00:26:00,427 --> 00:26:03,697 line:90%,end
<c.magenta>变化数量即手可得</c>
<c.magenta>就像状态变量一样</c>


508
00:26:03,964 --> 00:26:05,566 line:90%,end
<c.magenta>也可以获得所有详情</c>


509
00:26:05,666 --> 00:26:08,068 line:90%,end
<c.magenta>获取所有事务处理和所有变更</c>


510
00:26:09,603 --> 00:26:13,307 line:90%,end
<c.magenta>另外 利用变更请求</c>
<c.magenta>你还可以清空历史记录</c>


511
00:26:13,473 --> 00:26:17,311 line:90%,end
<c.magenta>你可以重头开始</c>
<c.magenta>删除特定日期、令牌</c>


512
00:26:17,411 --> 00:26:20,380 line:90%,end
<c.magenta>或事务处理之前的历史记录</c>


513
00:26:21,081 --> 00:26:25,953 line:90%,end
<c.magenta>持续性历史是线性的</c>
<c.magenta>始终保持较短的长度</c>


514
00:26:27,754 --> 00:26:33,527 line:90%,end
<c.magenta>我们希望你记住 进行删除时</c>
<c.magenta>你应该保护历史记录</c>


515
00:26:34,294 --> 00:26:37,397 line:90%,end
<c.magenta>这样它就会知道</c>


516
00:26:37,464 --> 00:26:41,235 line:90%,end
<c.magenta>你曾经使用你所需要的历史记录</c>
<c.magenta>你的客户曾经用过它</c>


517
00:26:41,301 --> 00:26:43,804 line:90%,end
<c.magenta>你就不会删除</c>


518
00:26:43,871 --> 00:26:46,773 line:90%,end
<c.magenta>其他应用用户所需要的东西</c>


519
00:26:47,140 --> 00:26:50,244 line:90%,end
<c.magenta>现在 我们有了</c>
<c.magenta>NS Persistent History Transaction</c>


520
00:26:50,711 --> 00:26:56,383 line:90%,end
<c.magenta>这是一个大型数据集记录</c>
<c.magenta>哪些人对你的数据库进行过事务处理</c>


521
00:26:56,550 --> 00:27:00,554 line:90%,end
<c.magenta>你可以看到 我们有Store ID</c>
<c.magenta>Bundle ID、Process ID</c>


522
00:27:00,988 --> 00:27:02,389 line:90%,end
<c.magenta>我们还有令牌</c>


523
00:27:02,456 --> 00:27:04,925 line:90%,end
<c.magenta>由于历史记录是线性的</c>


524
00:27:05,492 --> 00:27:08,161 line:90%,end
<c.magenta>我们为你提供一个令牌</c>
<c.magenta>可以加密到磁盘</c>


525
00:27:08,228 --> 00:27:09,897 line:90%,end
<c.magenta>这样 当应用退出时</c>


526
00:27:09,963 --> 00:27:13,233 line:90%,end
<c.magenta>可以跟踪应用的历史位置</c>


527
00:27:13,300 --> 00:27:15,802 line:90%,end
<c.magenta>只需重启应用 调出令牌</c>


528
00:27:15,869 --> 00:27:18,839 line:90%,end
<c.magenta>取回历史记录</c>
<c.magenta>一切就会恢复正常</c>


529
00:27:19,406 --> 00:27:22,309 line:90%,end
<c.magenta>现在 在事务处理中</c>
<c.magenta>我们允许开发人员</c>


530
00:27:22,609 --> 00:27:26,513 line:90%,end
<c.magenta>希望你们进入</c>
<c.magenta>Manage Object Context</c>


531
00:27:26,580 --> 00:27:30,083 line:90%,end
<c.magenta>告知谁是这个Context</c>


532
00:27:30,150 --> 00:27:33,220 line:90%,end
<c.magenta>或这个Save Batch Update</c>
<c.magenta>或Batch Delete的编写者</c>


533
00:27:33,954 --> 00:27:37,925 line:90%,end
<c.magenta>我们允许你进入</c>
<c.magenta>Manage Object Context</c>


534
00:27:38,058 --> 00:27:39,993 line:90%,end
<c.magenta>设置事务编写者</c>


535
00:27:40,661 --> 00:27:43,163 line:90%,end
<c.magenta>做这些工作</c>
<c.magenta>然后保存或执行请求</c>


536
00:27:43,230 --> 00:27:47,234 line:90%,end
<c.magenta>我们将获取这个字符串</c>
<c.magenta>放入事务处理 这样你就可以知道</c>


537
00:27:47,334 --> 00:27:50,003 line:90%,end
<c.magenta>后来哪些人对你的数据库</c>
<c.magenta>进行了哪些操作</c>


538
00:27:51,839 --> 00:27:54,842 line:90%,end
<c.magenta>作为每个事务处理的一部分</c>
<c.magenta>都有一组变更</c>


539
00:27:55,142 --> 00:27:58,579 line:90%,end
<c.magenta>变更表示对</c>
<c.magenta>对象进行的某项操作</c>


540
00:27:58,645 --> 00:28:01,481 line:90%,end
<c.magenta>每个事务处理</c>
<c.magenta>包含许多变更</c>


541
00:28:01,615 --> 00:28:05,419 line:10%
<c.magenta>比如插入、更新、删除</c>


542
00:28:05,819 --> 00:28:09,890 line:10%
<c.magenta>在更新时 将会告知</c>
<c.magenta>哪些属性已经更新</c>


543
00:28:10,157 --> 00:28:14,828 line:10%
<c.magenta>无论属性或关系</c>
<c.magenta>进行删除操作时</c>


544
00:28:16,697 --> 00:28:21,001 line:90%,end
<c.magenta>将会告知tombstone是什么</c>
<c.magenta>你可以在模型编辑器中</c>


545
00:28:21,068 --> 00:28:25,138 line:90%,end
<c.magenta>设置一组属性</c>
<c.magenta>允许你标识算后检查对象</c>


546
00:28:25,205 --> 00:28:29,476 line:90%,end
<c.magenta>它已经不在数据库之中</c>
<c.magenta>因此对象ID已经无关紧要</c>


547
00:28:29,543 --> 00:28:32,913 line:90%,end
<c.magenta>但是利用tombstone</c>
<c.magenta>你仍然可以标识对象</c>


548
00:28:33,280 --> 00:28:35,382 line:90%,end
<c.magenta>以后进行处理</c>


549
00:28:36,450 --> 00:28:38,619 line:90%,end
<c.magenta>现在我们进入模型编辑器</c>


550
00:28:40,721 --> 00:28:41,922 line:90%,end
<c.magenta>（模型编辑器）</c>


551
00:28:42,089 --> 00:28:44,691 line:90%,end
<c.magenta>这个实体有一个唯一标识符</c>


552
00:28:44,758 --> 00:28:49,229 line:90%,end
<c.magenta>可以为它设置tombstone</c>
<c.magenta>我们进入并标记为</c>


553
00:28:49,329 --> 00:28:50,964 line:90%,end
<c.magenta>“删除后保留”</c>


554
00:28:51,331 --> 00:28:54,301 line:90%,end
<c.magenta>非常简单</c>
<c.magenta>将会显示在tombstone之中</c>


555
00:28:55,736 --> 00:28:58,338 line:90%,end
<c.magenta>我将进行简短演示</c>


556
00:28:58,572 --> 00:29:02,042 line:90%,end
<c.magenta>这里有一个简单的应用</c>
<c.magenta>它获取我的贴子内容</c>


557
00:29:02,109 --> 00:29:04,311 line:90%,end
<c.magenta>然后将放入我的社交媒体内容源</c>


558
00:29:04,511 --> 00:29:08,715 line:90%,end
<c.magenta>这里我设置几个按钮</c>
<c.magenta>一个下载按钮</c>


559
00:29:08,782 --> 00:29:13,020 line:90%,end
<c.magenta>将会在Background Context</c>
<c.magenta>从云端读取信息</c>


560
00:29:13,387 --> 00:29:17,124 line:90%,end
<c.magenta>一个后台任务将会运行</c>
<c.magenta>发布我的信息</c>


561
00:29:17,191 --> 00:29:20,794 line:90%,end
<c.magenta>然后我设置一个标签页</c>
<c.magenta>在里面可以看到历史记录</c>


562
00:29:21,361 --> 00:29:25,132 line:90%,end
<c.magenta>在我的代码中</c>
<c.magenta>Use Persistent History设置为假</c>


563
00:29:25,299 --> 00:29:28,535 line:90%,end
<c.magenta>但是为我的store启用它</c>
<c.magenta>这样就可以看到发生了哪些变化</c>


564
00:29:30,304 --> 00:29:32,840 line:90%,end
<c.magenta>在这里有一条用户贴子</c>


565
00:29:33,140 --> 00:29:35,442 line:90%,end
<c.magenta>用户说：</c>
<c.magenta>“演示太棒！真不错”</c>


566
00:29:35,509 --> 00:29:38,478 line:90%,end
<c.magenta>我可以在后台下载</c>


567
00:29:38,946 --> 00:29:41,915 line:90%,end
<c.magenta>可以看到 我已经标记</c>
<c.magenta>贴子的来源</c>


568
00:29:41,982 --> 00:29:44,985 line:90%,end
<c.magenta>第一个来自于用户</c>
<c.magenta>第二个来自于后台</c>


569
00:29:45,953 --> 00:29:49,223 line:90%,end
<c.magenta>现在我们跳出转至共享扩展</c>


570
00:29:49,890 --> 00:29:52,759 line:90%,end
<c.magenta>在这里分享Apple信息非常快速</c>


571
00:29:52,960 --> 00:29:54,328 line:90%,end
<c.magenta>（活动历史演示）</c>


572
00:29:56,663 --> 00:29:57,497 line:90%,end
<c.magenta>（取消 发布）</c>


573
00:29:57,865 --> 00:30:00,968 line:90%,end
<c.magenta>我可以发布这条信息</c>
<c.magenta>然后在应用中看到</c>


574
00:30:01,802 --> 00:30:05,772 line:90%,end
<c.magenta>我们回到应用</c>
<c.magenta>等等 我丢失了一些灵气</c>


575
00:30:05,839 --> 00:30:06,974 line:90%,end
<c.magenta>真是奇怪</c>


576
00:30:07,074 --> 00:30:10,677 line:90%,end
<c.magenta>肯定是出错了</c>
<c.magenta>但是如果我返回历史记录</c>


577
00:30:10,744 --> 00:30:14,681 line:90%,end
<c.magenta>可以看到应用中有一条消息</c>
<c.magenta>而且我已经获得远程内容</c>


578
00:30:14,982 --> 00:30:17,351 line:90%,end
<c.magenta>我甚至可以看到共享扩展</c>


579
00:30:17,651 --> 00:30:19,720 line:90%,end
<c.magenta>但是 我在这里没有看到</c>


580
00:30:20,587 --> 00:30:22,389 line:90%,end
<c.magenta>与用户一样 我开始添加数据</c>


581
00:30:22,456 --> 00:30:24,725 line:90%,end
<c.magenta>尝试弄清楚</c>
<c.magenta>这个UI出了什么问题</c>


582
00:30:25,726 --> 00:30:28,529 line:90%,end
<c.magenta>持续性历史正在显示所有内容</c>


583
00:30:28,629 --> 00:30:29,997 line:90%,end
<c.magenta>真奇怪</c>


584
00:30:30,230 --> 00:30:35,169 line:90%,end
<c.magenta>突然我的应用显出</c>
<c.magenta>我刚才加载的刷新内容</c>


585
00:30:35,269 --> 00:30:37,404 line:90%,end
<c.magenta>在一些视图基础上</c>


586
00:30:37,471 --> 00:30:40,340 line:90%,end
<c.magenta>我最终获取数据库内容</c>
<c.magenta>并且重新刷新所有内容</c>


587
00:30:40,841 --> 00:30:43,810 line:90%,end
<c.magenta>只有通过这种方法</c>
<c.magenta>我才能解决这个问题</c>


588
00:30:43,877 --> 00:30:45,979 line:90%,end
<c.magenta>这让用户感到困惑</c>


589
00:30:46,713 --> 00:30:49,383 line:90%,end
<c.magenta>但是如果开启</c>


590
00:30:49,449 --> 00:30:52,019 line:90%,end
<c.magenta>不再进行跟踪</c>
<c.magenta>将会发生什么呢？</c>


591
00:30:52,119 --> 00:30:53,720 line:90%,end
<c.magenta>我开启它</c>


592
00:30:53,887 --> 00:30:59,660 line:90%,end
<c.magenta>你可以看到</c>
<c.magenta>我很快就完成Background Context设置</c>


593
00:30:59,826 --> 00:31:01,895 line:90%,end
<c.magenta>和View Context设置</c>


594
00:31:01,962 --> 00:31:04,231 line:90%,end
<c.magenta>我让它们互相侦听</c>


595
00:31:06,600 --> 00:31:10,871 line:90%,end
<c.magenta>我还设置事务编写者</c>
<c.magenta>非常简单</c>


596
00:31:10,938 --> 00:31:12,639 line:90%,end
<c.magenta>这样我们就可以看到运行过程</c>


597
00:31:13,507 --> 00:31:16,510 line:90%,end
<c.magenta>我可以非常快速地停止应用</c>
<c.magenta>然后重新启动</c>


598
00:31:16,877 --> 00:31:18,579 line:10%
<c.magenta>（构建成功）</c>


599
00:31:21,014 --> 00:31:21,949 line:90%,end
<c.magenta>（库）</c>


600
00:31:24,451 --> 00:31:27,287 line:90%,end
<c.magenta>这次我们的应用使用历史</c>


601
00:31:27,754 --> 00:31:30,791 line:90%,end
<c.magenta>让我们转到贴子分享功能</c>
<c.magenta>以前曾经问题重重</c>


602
00:31:31,892 --> 00:31:36,296 line:90%,end
<c.magenta>High Sierra看上去很酷</c>
<c.magenta>让我们来快速分享它</c>


603
00:31:37,798 --> 00:31:38,966 line:90%,end
<c.magenta>（High Sierra预览）</c>


604
00:31:39,032 --> 00:31:40,801 line:90%,end
<c.magenta>我们来分享它</c>


605
00:31:40,934 --> 00:31:43,837 line:90%,end
<c.magenta>非常快</c>
<c.magenta>让我们来分享其它内容</c>


606
00:31:44,371 --> 00:31:45,906 line:90%,end
<c.magenta>很酷的新watchOS</c>


607
00:31:51,044 --> 00:31:52,012 line:90%,end
<c.magenta>（发布）</c>


608
00:31:55,549 --> 00:31:57,284 line:90%,end
<c.magenta>现在 当我们返回应用…</c>


609
00:32:01,021 --> 00:32:02,322 line:90%,end
<c.magenta>瞧！它们出现了</c>


610
00:32:02,523 --> 00:32:06,026 line:90%,end
<c.magenta>我做的只是当视图重新载入时</c>
<c.magenta>吸取历史记录</c>


611
00:32:06,927 --> 00:32:09,129 line:90%,end
<c.magenta>而且可以快速地跳转到那段代码</c>


612
00:32:11,498 --> 00:32:12,533 line:90%,end
<c.magenta>（取回更改）</c>


613
00:32:15,302 --> 00:32:16,436 line:90%,end
<c.magenta>（跳转到定义）</c>


614
00:32:18,172 --> 00:32:20,140 line:90%,end
<c.magenta>在以前</c>
<c.magenta>如果我使用Fetch Hit</c>


615
00:32:20,207 --> 00:32:23,477 line:90%,end
<c.magenta>而不使用持续性历史</c>
<c.magenta>将会获取所有内容</c>


616
00:32:23,544 --> 00:32:26,547 line:90%,end
<c.magenta>现在我做的是取回历史</c>


617
00:32:26,613 --> 00:32:29,616 line:90%,end
<c.magenta>从历史吸取合并上下文</c>


618
00:32:29,683 --> 00:32:31,652 line:90%,end
<c.magenta>这为我提供更小的子集</c>


619
00:32:31,718 --> 00:32:35,155 line:90%,end
<c.magenta>我不再需要扫描整个数据库</c>
<c.magenta>来了解发生了哪些变化</c>


620
00:32:40,127 --> 00:32:42,896 line:90%,end
<c.magenta>简单地说 事情变得更简单</c>


621
00:32:43,130 --> 00:32:46,667 line:90%,end
<c.magenta>很容易启用持续性历史</c>
<c.magenta>它只是store中的一个选项</c>


622
00:32:47,801 --> 00:32:50,003 line:90%,end
<c.magenta>它发现那些被忽略的变化</c>


623
00:32:50,070 --> 00:32:52,873 line:90%,end
<c.magenta>你可能已经生成</c>
<c.magenta>Background Context</c>


624
00:32:53,006 --> 00:32:55,542 line:90%,end
<c.magenta>你可能未注意到</c>
<c.magenta>你忽略了一个通知</c>


625
00:32:55,609 --> 00:32:58,011 line:90%,end
<c.magenta>你已经使用</c>
<c.magenta>Batch Updates、Batch Deletes</c>


626
00:32:58,078 --> 00:33:01,648 line:90%,end
<c.magenta>它们不会生成通知</c>
<c.magenta>你可以发现所有这些操作</c>


627
00:33:01,949 --> 00:33:05,319 line:90%,end
<c.magenta>而不会对数据库的变化一无所知</c>


628
00:33:05,385 --> 00:33:06,587 line:90%,end
<c.magenta>（回顾历史 充满乐趣！）</c>


629
00:33:06,653 --> 00:33:07,621 line:90%,end
<c.magenta>（迁移变得更简单）</c>


630
00:33:07,754 --> 00:33:10,958 line:90%,end
<c.magenta>关于使用持续性历史的两个要点：</c>


631
00:33:11,024 --> 00:33:12,793 line:90%,end
<c.magenta>首先是迁移</c>


632
00:33:12,860 --> 00:33:16,730 line:90%,end
<c.magenta>我们在迁移时尽可能多地</c>
<c.magenta>保存你的历史记录</c>


633
00:33:17,998 --> 00:33:19,166 line:90%,end
<c.magenta>两种情况除外</c>


634
00:33:19,399 --> 00:33:21,902 line:90%,end
<c.magenta>如果删除模型中的实体</c>


635
00:33:21,969 --> 00:33:24,705 line:90%,end
<c.magenta>我们已经拥有这些实体的历史</c>


636
00:33:25,005 --> 00:33:28,909 line:90%,end
<c.magenta>必须删除它们的历史记录</c>
<c.magenta>这将形成空白</c>


637
00:33:29,343 --> 00:33:31,278 line:90%,end
<c.magenta>另一种情况是tombstones</c>


638
00:33:32,145 --> 00:33:33,213 line:90%,end
<c.magenta>对于tombstones</c>


639
00:33:33,280 --> 00:33:37,184 line:90%,end
<c.magenta>你并不想在以后</c>
<c.magenta>使用特定的数据来标识对象</c>


640
00:33:37,251 --> 00:33:41,255 line:90%,end
<c.magenta>也许它会成为安全隐患</c>
<c.magenta>因此称之为tombstone</c>


641
00:33:41,321 --> 00:33:45,225 line:90%,end
<c.magenta>我们将做同样的事情</c>
<c.magenta>从模型中删除它的值</c>


642
00:33:45,559 --> 00:33:49,429 line:90%,end
<c.magenta>但是如果删除任何数据</c>
<c.magenta>将会在历史中留下空白</c>


643
00:33:49,496 --> 00:33:53,567 line:90%,end
<c.magenta>这样只会保存在上次事务处理</c>
<c.magenta>完成之后的历史记录</c>


644
00:33:53,634 --> 00:33:58,605 line:90%,end
<c.magenta>这样你可以跟踪历史而不会跌入陷阱</c>


645
00:33:58,672 --> 00:34:01,875 line:90%,end
<c.magenta>让我因为空白而忽略变化</c>


646
00:34:03,210 --> 00:34:04,511 line:90%,end
<c.magenta>在性能方面</c>


647
00:34:06,046 --> 00:34:10,384 line:90%,end
<c.magenta>每次保存和批处理</c>
<c.magenta>会造成轻微的性能影响</c>


648
00:34:10,884 --> 00:34:13,320 line:90%,end
<c.magenta>根据批处理的保存操作量</c>


649
00:34:13,420 --> 00:34:17,391 line:90%,end
<c.magenta>将会计算哪些内容发生变化</c>
<c.magenta>并写入数据库</c>


650
00:34:17,456 --> 00:34:22,094 line:90%,end
<c.magenta>在操作完成之后 占用的内存</c>


651
00:34:22,161 --> 00:34:23,463 line:90%,end
<c.magenta>将会交还给你</c>


652
00:34:23,530 --> 00:34:27,266 line:90%,end
<c.magenta>还会有少量的存储开销</c>
<c.magenta>但是历史记录将会被清空</c>


653
00:34:27,333 --> 00:34:30,771 line:90%,end
<c.magenta>从而能够重新收回占用的空间</c>


654
00:34:33,739 --> 00:34:35,309 line:90%,end
<c.magenta>这就是持续性历史跟踪</c>


655
00:34:43,483 --> 00:34:47,387 line:90%,end
<c.magenta>让我们总结本场演讲的内容</c>
<c.magenta>梅利莎介绍了Core Spotlight</c>


656
00:34:47,487 --> 00:34:51,425 line:90%,end
<c.magenta>这项技术容易使用</c>
<c.magenta>便于通过Spotlight分享数据</c>


657
00:34:51,491 --> 00:34:52,960 line:90%,end
<c.magenta>提供深度链接</c>


658
00:34:53,025 --> 00:34:56,763 line:90%,end
<c.magenta>用户可以在手机上的任何位置</c>
<c.magenta>找到你的应用中的数据</c>


659
00:34:57,364 --> 00:35:00,934 line:90%,end
<c.magenta>新Indexing API</c>
<c.magenta>让搜索变得更加快速</c>


660
00:35:01,001 --> 00:35:03,036 line:90%,end
<c.magenta>让你的应用变得更快</c>


661
00:35:03,570 --> 00:35:06,740 line:90%,end
<c.magenta>最后持续性历史让你知道</c>


662
00:35:06,807 --> 00:35:09,009 line:90%,end
<c.magenta>用户进行的变更</c>
<c.magenta>不会遗漏任何历史记录</c>


663
00:35:09,076 --> 00:35:11,378 line:90%,end
<c.magenta>让你始终知道</c>
<c.magenta>谁对你的数据库进行了哪些操作</c>


664
00:35:12,980 --> 00:35:15,782 line:90%,end
<c.magenta>另外还有一件事情 文件漏洞</c>


665
00:35:16,149 --> 00:35:19,119 line:90%,end
<c.magenta>如果你遇到问题</c>
<c.magenta>如果你有任何需求</c>


666
00:35:19,953 --> 00:35:22,556 line:90%,end
<c.magenta>请访问bugreport.apple.com</c>
<c.magenta>我们将会倾听你的意见</c>


667
00:35:22,956 --> 00:35:24,291 line:90%,end
<c.magenta>请去访问</c>


668
00:35:25,859 --> 00:35:28,795 line:90%,end
<c.magenta>有关更多信息</c>
<c.magenta>请访问WWDC网站</c>


669
00:35:29,530 --> 00:35:33,200 line:90%,end
<c.magenta>另外还有一些相关演讲</c>
<c.magenta>我们之前举行了“Cocoa新特性”演讲</c>


670
00:35:33,267 --> 00:35:34,835 line:90%,end
<c.magenta>你们可以观看视频</c>


671
00:35:34,902 --> 00:35:37,337 line:90%,end
<c.magenta>接下来我们还有</c>
<c.magenta>“Foundation新特性”演讲</c>


672
00:35:37,704 --> 00:35:41,208 line:90%,end
<c.magenta>在星期三</c>
<c.magenta>“Core Spotlight新特性”演讲</c>


673
00:35:41,275 --> 00:35:42,776 line:90%,end
<c.magenta>将会和大家分享一些有趣的内容</c>


674
00:35:42,843 --> 00:35:46,213 line:90%,end
<c.magenta>另外请留意星期五上午的</c>
<c.magenta>“Cocoa开发小技巧”演讲</c>


675
00:35:46,547 --> 00:35:47,481 line:90%,end
<c.magenta>谢谢大家 非常感谢</c>

