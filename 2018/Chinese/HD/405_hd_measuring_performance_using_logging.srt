1
00:00:06,516 --> 00:00:16,500
[ 音乐 ]


2
00:00:22,516 --> 00:00:30,756
[ 掌声 ]


3
00:00:31,256 --> 00:00:33,646
>> 下午好


4
00:00:34,516 --> 00:00:35,556
我叫 Shane


5
00:00:35,956 --> 00:00:37,476
我来自 Darwin Runtime 团队


6
00:00:37,756 --> 00:00:39,146
欢迎大家来到


7
00:00:39,146 --> 00:00:40,856
“使用日志来


8
00:00:40,856 --> 00:00:41,226
衡量性能”


9
00:00:42,616 --> 00:00:44,676
我们在周一听到了很多


10
00:00:44,766 --> 00:00:46,086
关于性能的东西


11
00:00:46,706 --> 00:00:47,696
性能是


12
00:00:47,696 --> 00:00:49,526
良好用户体验的


13
00:00:49,526 --> 00:00:50,516
关键之一


14
00:00:50,936 --> 00:00:52,816
人们希望他们的游戏


15
00:00:52,906 --> 00:00:54,176
和 App 能跑得快


16
00:00:54,936 --> 00:00:56,126
同时兼具流畅性和灵敏性


17
00:00:57,416 --> 00:01:02,066
但软件是复杂的


18
00:01:02,066 --> 00:01:04,916
这意味着当你的 App 在运行时


19
00:01:05,036 --> 00:01:06,596
有时还同时发生着很多事情


20
00:01:06,596 --> 00:01:09,876
这意味着你可以


21
00:01:09,876 --> 00:01:11,486
从一些意想不到的地方


22
00:01:11,486 --> 00:01:12,746
找到性能的突出点


23
00:01:13,716 --> 00:01:16,106
这么做的话


24
00:01:16,106 --> 00:01:18,066
发觉这些性能突出点需要你


25
00:01:18,136 --> 00:01:20,076
对程序的行为有所理解 


26
00:01:20,076 --> 00:01:21,616
有时需要


27
00:01:21,616 --> 00:01:22,416
更深的理解


28
00:01:23,046 --> 00:01:24,746
它要求你知道


29
00:01:24,746 --> 00:01:26,376
你的代码具体在什么时候运行


30
00:01:26,506 --> 00:01:28,696
一段运算具体花了多少时间


31
00:01:29,546 --> 00:01:31,256
所以这是一个


32
00:01:31,406 --> 00:01:33,706
能让好工具真正发挥作用的地方


33
00:01:34,536 --> 00:01:36,146
我们知道开发更好的工具


34
00:01:36,146 --> 00:01:37,816
并交给你们使用


35
00:01:37,816 --> 00:01:39,936
可以使我们


36
00:01:39,936 --> 00:01:41,136
帮助你们成为


37
00:01:41,136 --> 00:01:42,116
更有效率的开发者


38
00:01:42,776 --> 00:01:44,416
所以今天我要说说


39
00:01:44,416 --> 00:01:45,236
一个这样的工具


40
00:01:45,636 --> 00:01:47,076
今天我要说说


41
00:01:47,406 --> 00:01:48,226
Signposts


42
00:01:48,796 --> 00:01:50,796
Signposts 是 OSLog 家族中的


43
00:01:50,796 --> 00:01:51,756
新成员


44
00:01:52,696 --> 00:01:56,296
你可以在 macOS 中使用


45
00:01:56,436 --> 00:01:58,206
你也可以在 iOS 中使用


46
00:01:58,296 --> 00:01:59,866
你可以在 Swift 和 C 里面使用


47
00:02:00,196 --> 00:02:02,596
但最酷的是


48
00:02:02,736 --> 00:02:04,936
我们将它整合进了 Instruments


49
00:02:05,466 --> 00:02:06,606
这意味着 Instruments 可以


50
00:02:06,606 --> 00:02:07,766
获得 Signposts 产生的数据


51
00:02:07,766 --> 00:02:12,136
让你对程序的行为 有更深的理解


52
00:02:13,496 --> 00:02:15,476
首先简单讲下历史


53
00:02:16,556 --> 00:02:18,926
我们在几年前就推出了 OSLog


54
00:02:19,696 --> 00:02:21,826
这是我们关于日志设备


55
00:02:21,826 --> 00:02:22,746
的新想法


56
00:02:23,006 --> 00:02:26,076
这是我们从系统中 获取调试信息的方式


57
00:02:26,456 --> 00:02:29,186
我们是怀着提升效率的目标


58
00:02:29,356 --> 00:02:31,586
并牢记着隐私的重要性 来开发它的


59
00:02:32,696 --> 00:02:34,146
这里你可以看到一段


60
00:02:34,146 --> 00:02:35,796
OSLog 的代码示例


61
00:02:35,796 --> 00:02:37,256
我刚刚创建了一个简单的日志句柄


62
00:02:37,256 --> 00:02:39,566
并把 “hello world” 传给了它


63
00:02:40,326 --> 00:02:43,016
Signposts 继承了 OSLog 的 API


64
00:02:43,796 --> 00:02:44,536
但它是为了描述


65
00:02:44,536 --> 00:02:45,576
性能使用的情况


66
00:02:45,816 --> 00:02:46,486
这意味着它们在传达


67
00:02:46,486 --> 00:02:48,156
和性能有关的信息


68
00:02:48,156 --> 00:02:49,676
并且我们把它


69
00:02:49,756 --> 00:02:51,026
整合进了我们的开发者工具中


70
00:02:51,026 --> 00:02:52,846
也就是说你可以


71
00:02:52,936 --> 00:02:53,876
用 Signposts 来给你的


72
00:02:53,876 --> 00:02:55,486
代码加上注释然后打开


73
00:02:55,486 --> 00:02:57,176
Instruments 就能看到这个


74
00:02:58,526 --> 00:02:59,866
在这里 Instruments 向你展示了


75
00:03:00,406 --> 00:03:03,736
关于程序行为和 Signposts 活动


76
00:03:03,736 --> 00:03:05,596
的一个漂亮时间线


77
00:03:06,046 --> 00:03:07,186
然后在底部


78
00:03:07,186 --> 00:03:09,486
有一个聚合了


79
00:03:09,546 --> 00:03:11,316
Signposts 统计和分析数据


80
00:03:11,316 --> 00:03:13,216
的表格


81
00:03:13,216 --> 00:03:15,056
通过筛选拆解


82
00:03:15,056 --> 00:03:16,706
来检查你程序的


83
00:03:16,876 --> 00:03:17,126
行为


84
00:03:18,506 --> 00:03:20,476
此次会议中我会讲


85
00:03:20,706 --> 00:03:21,986
如何在你的代码中使用


86
00:03:21,986 --> 00:03:23,366
Signposts 并向你展示


87
00:03:23,366 --> 00:03:24,086
它的功能


88
00:03:24,536 --> 00:03:25,226
然后我们将展示


89
00:03:25,226 --> 00:03:29,436
新的 Instrument 和 Signposts 的图像


90
00:03:29,436 --> 00:03:31,296
使你对 Signposts 和 Instrument


91
00:03:31,296 --> 00:03:34,736
的协作有直观的理解 让我们开始吧


92
00:03:35,556 --> 00:03:38,946
我先从一个非常简单的例子开始


93
00:03:39,766 --> 00:03:42,466
假设这是你的 App


94
00:03:43,116 --> 00:03:44,586
你想调查


95
00:03:44,586 --> 00:03:46,836
一块特定界面


96
00:03:46,896 --> 00:03:49,456
刷新所需要的时间


97
00:03:49,966 --> 00:03:51,856
要达到这个目标


98
00:03:51,856 --> 00:03:53,566
你要加载一些图片并将它们


99
00:03:53,566 --> 00:03:54,176
放在屏幕上


100
00:03:54,696 --> 00:03:57,576
所以简单来说从 App 的


101
00:03:57,576 --> 00:04:01,346
这个 App 做的工作就是抓取素材


102
00:04:01,486 --> 00:04:02,456
当你抓取完所有素材以后


103
00:04:02,456 --> 00:04:04,296
界面就刷新了


104
00:04:05,436 --> 00:04:07,116
一个 Signpost 允许我们


105
00:04:07,176 --> 00:04:09,466
标记一段行为的开始


106
00:04:09,466 --> 00:04:11,196
和结束然后将


107
00:04:11,196 --> 00:04:12,586
这时间上的两点


108
00:04:12,586 --> 00:04:14,476
和这两个日志事件关联


109
00:04:15,326 --> 00:04:18,086
它们通过调用了一个


110
00:04:18,086 --> 00:04:19,106
os_signpost 函数来完成


111
00:04:19,305 --> 00:04:20,516
有两种调用方式


112
00:04:20,616 --> 00:04:23,296
一种是 .begin 一种是 .end


113
00:04:23,726 --> 00:04:25,776
这里我用一个下面


114
00:04:25,776 --> 00:04:27,526
带 b 的箭头代表开始


115
00:04:27,926 --> 00:04:29,446
用下面带 e 的箭头


116
00:04:29,446 --> 00:04:31,626
代表结束


117
00:04:31,626 --> 00:04:32,936
然后我们将这两点


118
00:04:32,936 --> 00:04:34,126
联系起来


119
00:04:34,126 --> 00:04:36,296
让你知道


120
00:04:36,366 --> 00:04:37,736
这个间隔经过了多少时间


121
00:04:37,736 --> 00:04:39,276
好了


122
00:04:40,126 --> 00:04:42,246
代码里这里有一段


123
00:04:42,246 --> 00:04:44,076
这个算法的简单应用


124
00:04:44,556 --> 00:04:45,886
对于界面的每个元素


125
00:04:45,886 --> 00:04:47,236
我们都要获取素材


126
00:04:47,236 --> 00:04:49,296
并且想要测量


127
00:04:49,296 --> 00:04:51,506
这个操作所需的时间


128
00:04:52,426 --> 00:04:53,786
要将 signpost 导入


129
00:04:53,786 --> 00:04:55,716
这段代码里


130
00:04:55,716 --> 00:04:57,396
我们只需将包含这个功能


131
00:04:57,596 --> 00:04:59,636
的 os.signpost 模块导入


132
00:05:00,506 --> 00:05:02,496
然后因为 Signposts 是


133
00:05:02,496 --> 00:05:04,146
OSLog 功能的一部分


134
00:05:04,586 --> 00:05:06,276
我们要创建一个日志句柄


135
00:05:06,796 --> 00:05:08,406
这里 这个日志句柄有两个参数


136
00:05:08,406 --> 00:05:10,296
一个 subsystem 和一个 category


137
00:05:11,216 --> 00:05:13,896
subsystem 可能在你整个


138
00:05:13,896 --> 00:05:14,566
项目中都是


139
00:05:14,566 --> 00:05:15,096
一样的


140
00:05:15,516 --> 00:05:16,676
它看起来非常像你的套装 ID


141
00:05:16,676 --> 00:05:18,666
它代表着软件的


142
00:05:18,666 --> 00:05:19,996
组成部分


143
00:05:19,996 --> 00:05:21,246
可能是你使用的框架


144
00:05:22,816 --> 00:05:24,726
category 是用来关联


145
00:05:25,346 --> 00:05:27,266
将相关的操作或者相关的


146
00:05:27,266 --> 00:05:28,586
signposts 组合在一起


147
00:05:29,136 --> 00:05:30,236
稍后你将在会议中看到


148
00:05:30,236 --> 00:05:33,096
为什么它很有用


149
00:05:33,256 --> 00:05:34,596
当我们有了日志句柄后


150
00:05:35,416 --> 00:05:37,516
我们将调用 os_signpost 函数两次


151
00:05:37,826 --> 00:05:39,036
一次用 .begin. 一次用 .end.


152
00:05:39,036 --> 00:05:41,486
我们将日志句柄传给


153
00:05:41,486 --> 00:05:42,876
这几次调用


154
00:05:42,876 --> 00:05:44,566
第三个参数


155
00:05:44,956 --> 00:05:46,686
是 signpost 名称


156
00:05:47,826 --> 00:05:49,396
signpost 名称是


157
00:05:49,396 --> 00:05:51,156
一个字符串常量


158
00:05:51,186 --> 00:05:52,996
用来确定间隔时间


159
00:05:53,056 --> 00:05:54,676
用来确定我们想要测量的操作


160
00:05:55,696 --> 00:05:57,326
这个字符串常量是


161
00:05:57,326 --> 00:05:59,346
用来匹配我们


162
00:05:59,346 --> 00:06:00,806
通过调用的 os_signpost 函数


163
00:06:00,806 --> 00:06:02,756
注释或标记过的


164
00:06:02,966 --> 00:06:04,606
开始点和结束点


165
00:06:05,026 --> 00:06:07,416
所以在我们的时间线上


166
00:06:07,416 --> 00:06:08,086
看起来就像这样


167
00:06:08,086 --> 00:06:09,676
在每段工作的开始


168
00:06:09,676 --> 00:06:11,696
我们放了一个


169
00:06:11,696 --> 00:06:12,246
os_signpost


170
00:06:12,366 --> 00:06:13,336
在每段工作的结束


171
00:06:13,336 --> 00:06:14,776
我们放了一个 os_signpost


172
00:06:15,086 --> 00:06:16,646
因为这些字符串常量


173
00:06:16,646 --> 00:06:17,756
在开始和结束的调用点上


174
00:06:17,756 --> 00:06:19,286
按顺序排好了


175
00:06:19,286 --> 00:06:20,856
我们可以将它俩匹配


176
00:06:20,856 --> 00:06:23,266
但是如果我们想要


177
00:06:23,266 --> 00:06:25,346
测量整段操作


178
00:06:25,346 --> 00:06:26,836
完成全部刷新


179
00:06:26,836 --> 00:06:27,866
所花的时间呢


180
00:06:28,526 --> 00:06:31,236
在我们代码里


181
00:06:31,236 --> 00:06:32,966
我们只需添加另一对 os_signpost


182
00:06:32,966 --> 00:06:34,646
begin 和 end 调用


183
00:06:34,836 --> 00:06:35,346
非常简单


184
00:06:35,836 --> 00:06:37,196
这次我赋予了一个


185
00:06:37,306 --> 00:06:38,446
不同的字符串常量


186
00:06:38,556 --> 00:06:39,756
所以就有一个不一样的 signpost 名称


187
00:06:39,836 --> 00:06:41,616
这次用了 “Refresh Panel”


188
00:06:41,616 --> 00:06:43,206
来表示这是一个独立的间隔时间


189
00:06:43,206 --> 00:06:45,166
和循环里的间隔时间相独立


190
00:06:47,236 --> 00:06:50,536
在我们的时间线上


191
00:06:50,536 --> 00:06:51,846
我们标记了另外两个


192
00:06:51,846 --> 00:06:52,656
signposts


193
00:06:54,166 --> 00:06:55,606
而匹配的字符串常量


194
00:06:55,606 --> 00:06:57,296
“Refresh Panel”


195
00:06:57,296 --> 00:06:58,426
让系统知道


196
00:06:58,426 --> 00:07:01,326
这两点是相关联的


197
00:07:02,846 --> 00:07:03,136
好了


198
00:07:03,926 --> 00:07:05,796
这并不是个超级简单的例子


199
00:07:06,226 --> 00:07:07,876
如果你的程序一直


200
00:07:07,906 --> 00:07:09,736
按第一步第二步


201
00:07:09,736 --> 00:07:11,046
然后第三步的顺序来走


202
00:07:11,166 --> 00:07:11,816
这么做是可以的


203
00:07:12,256 --> 00:07:14,706
但在我们系统中


204
00:07:14,706 --> 00:07:16,686
经常有很多工作是异步发生的


205
00:07:17,146 --> 00:07:17,386
嗯


206
00:07:17,796 --> 00:07:19,816
并不是有第一步


207
00:07:19,816 --> 00:07:21,066
第二步第三步


208
00:07:21,066 --> 00:07:23,136
我们通常按顺序开始


209
00:07:23,136 --> 00:07:24,796
对吧 然后


210
00:07:24,796 --> 00:07:25,956
稍后再完成它们


211
00:07:26,296 --> 00:07:27,106
这意味着


212
00:07:27,736 --> 00:07:28,766
这些操作可以


213
00:07:28,766 --> 00:07:29,346
同时发生


214
00:07:29,346 --> 00:07:30,086
他们可以重叠


215
00:07:31,226 --> 00:07:32,786
在这种情况下我们需要


216
00:07:32,786 --> 00:07:34,046
给系统一些


217
00:07:34,046 --> 00:07:35,636
额外的信息


218
00:07:35,636 --> 00:07:36,836
以让它区分开


219
00:07:36,836 --> 00:07:38,126
这些 signposts


220
00:07:39,156 --> 00:07:42,096
要做到这一点


221
00:07:42,096 --> 00:07:43,366
目前我们只用到了名称


222
00:07:43,716 --> 00:07:43,886
对吧


223
00:07:43,886 --> 00:07:45,726
这个名称会匹配


224
00:07:45,726 --> 00:07:46,566
开始和结束点


225
00:07:47,276 --> 00:07:48,436
所以字符串常量现在


226
00:07:48,436 --> 00:07:50,026
已经标识了时间段


227
00:07:50,026 --> 00:07:51,236
但还没有让我们可以


228
00:07:51,236 --> 00:07:53,436
区分重叠的时间段


229
00:07:54,236 --> 00:07:55,346
要做到这一点我们给


230
00:07:55,346 --> 00:07:56,606
Signpost 调用添加


231
00:07:56,606 --> 00:07:58,816
了另一块信息 叫做 signpost ID


232
00:08:00,256 --> 00:08:02,196
signpost ID 会告诉系统


233
00:08:02,196 --> 00:08:04,076
这些是同一类型的操作


234
00:08:04,076 --> 00:08:06,516
但是它们之间


235
00:08:06,546 --> 00:08:07,586
又互相不一样


236
00:08:08,366 --> 00:08:11,276
所以如果两项操作重叠了


237
00:08:11,276 --> 00:08:12,376
但它们有着不同的 signpost ID 


238
00:08:12,376 --> 00:08:13,446
系统就会知道


239
00:08:13,486 --> 00:08:14,686
它们是不同的时间段


240
00:08:15,096 --> 00:08:16,516
只要你将相同的


241
00:08:16,516 --> 00:08:18,046
signpost ID 传给了开始调用点


242
00:08:18,046 --> 00:08:19,196
和结束调用点


243
00:08:19,626 --> 00:08:21,096
这两个 signpost 就会


244
00:08:21,316 --> 00:08:22,546
相互关联


245
00:08:23,596 --> 00:08:25,936
你可以通过这个构造函数


246
00:08:25,936 --> 00:08:27,196
使用一个日志句柄


247
00:08:27,196 --> 00:08:29,666
来创建 signpost ID 但你也可以


248
00:08:29,666 --> 00:08:31,736
通过对象来创建


249
00:08:32,606 --> 00:08:33,765
如果你有一些对象


250
00:08:33,765 --> 00:08:35,226
代表你想做的事


251
00:08:35,226 --> 00:08:36,426
那么这样就很方便


252
00:08:36,895 --> 00:08:38,515
只要你使用了


253
00:08:38,515 --> 00:08:39,736
对象的同一实例


254
00:08:39,736 --> 00:08:41,456
就会生成同样的 signpost ID


255
00:08:41,826 --> 00:08:42,756
这意味着你不需要


256
00:08:42,806 --> 00:08:44,876
到处携带和存储 signpost ID


257
00:08:44,876 --> 00:08:46,756
你可以直接使用对象


258
00:08:48,966 --> 00:08:51,646
直观上你可以将


259
00:08:51,646 --> 00:08:53,616
signpost ID 想成允许我们


260
00:08:53,616 --> 00:08:55,086
向每次 signpost 调用


261
00:08:55,086 --> 00:08:56,926
传递一点额外的背景信息


262
00:08:57,926 --> 00:09:00,576
对于一段特定的操作


263
00:09:00,576 --> 00:09:03,036
它可以将开始和结束标记联系起来


264
00:09:03,716 --> 00:09:04,916
这很重要因为这些操作


265
00:09:04,916 --> 00:09:06,336
不仅可能会重叠


266
00:09:06,336 --> 00:09:08,116
它们还通常需要花


267
00:09:08,186 --> 00:09:11,896
不一样的时间


268
00:09:12,116 --> 00:09:14,666
让我们到示例代码中看看


269
00:09:15,716 --> 00:09:16,466
这就是我们的代码


270
00:09:16,466 --> 00:09:18,026
我要将同步获取


271
00:09:18,026 --> 00:09:20,066
异步调用转换成


272
00:09:20,066 --> 00:09:21,036
异步获取


273
00:09:21,946 --> 00:09:23,266
现在我要给它一个


274
00:09:23,396 --> 00:09:24,436
completionHandler


275
00:09:24,436 --> 00:09:25,756
当素材获取完毕后


276
00:09:25,846 --> 00:09:27,236
这个闭包就会运行


277
00:09:28,446 --> 00:09:29,486
然后我又添加了


278
00:09:29,486 --> 00:09:30,946
一个闭包一个 completionHandler


279
00:09:31,346 --> 00:09:34,076
在素材获取完后就运行


280
00:09:35,006 --> 00:09:36,676
在每种情况下我都将


281
00:09:36,676 --> 00:09:38,266
os_signpost 结束调用


282
00:09:38,306 --> 00:09:40,426
放在了闭包内来指示


283
00:09:40,426 --> 00:09:42,256
这就是我想要标记时段


284
00:09:42,256 --> 00:09:42,916
结束的时间


285
00:09:44,266 --> 00:09:44,526
OK


286
00:09:45,796 --> 00:09:47,426
因为我们觉得


287
00:09:48,296 --> 00:09:49,616
这些时段会互相重叠


288
00:09:49,616 --> 00:09:51,046
我们想针对每个时段


289
00:09:51,076 --> 00:09:52,456
创建新的 signpost ID


290
00:09:52,876 --> 00:09:54,416
注意在上面的例子中我已经


291
00:09:54,606 --> 00:09:55,756
通过构造函数使用日志句柄


292
00:09:55,756 --> 00:09:56,576
创建了一个


293
00:09:56,686 --> 00:09:58,106
第二个 我是通过


294
00:10:01,116 --> 00:10:03,436
然后我将这些


295
00:10:03,436 --> 00:10:06,226
signpost ID 传给调用处


296
00:10:06,676 --> 00:10:07,126
做完了


297
00:10:07,876 --> 00:10:10,706
你可以将 signpost 想成


298
00:10:10,706 --> 00:10:12,146
整理好的一种


299
00:10:12,146 --> 00:10:13,846
分类或者层次


300
00:10:14,336 --> 00:10:14,566
对吧


301
00:10:15,066 --> 00:10:16,616
所有这些操作都由


302
00:10:16,616 --> 00:10:17,936
日志句柄相关联


303
00:10:18,036 --> 00:10:19,396
代表日志类型


304
00:10:20,106 --> 00:10:21,456
对我们感兴趣的每段操作


305
00:10:21,456 --> 00:10:22,706
我们赋予了它一个


306
00:10:22,706 --> 00:10:23,616
signpost 名称


307
00:10:25,096 --> 00:10:26,786
然后因为这些 signpost


308
00:10:26,986 --> 00:10:28,256
可能互相重叠


309
00:10:28,256 --> 00:10:29,626
我们给了它们 signpost ID


310
00:10:29,626 --> 00:10:32,016
告诉系统这是


311
00:10:32,016 --> 00:10:34,656
那段时间的一个


312
00:10:34,656 --> 00:10:35,136
特定实例


313
00:10:36,596 --> 00:10:39,396
这个界面专门


314
00:10:39,666 --> 00:10:42,836
设计得很灵活


315
00:10:42,836 --> 00:10:44,196
这样你就可以在开始点


316
00:10:44,196 --> 00:10:46,416
和结束点控制所有的参数


317
00:10:46,416 --> 00:10:47,956
你可以控制 signpost 名称


318
00:10:47,956 --> 00:10:51,036
赋予的日志句柄和 ID


319
00:10:51,036 --> 00:10:52,276
我们这么做是因为


320
00:10:52,276 --> 00:10:53,966
只要你在开始点


321
00:10:54,126 --> 00:10:55,656
和结束点提供了相同的参数


322
00:10:55,656 --> 00:10:57,406
那两个 signpost 


323
00:10:57,406 --> 00:10:59,126
就能够互相匹配


324
00:10:59,526 --> 00:11:01,586
这意味着你的开始和结束点


325
00:11:01,586 --> 00:11:02,096
可以在不同的函数中


326
00:11:02,736 --> 00:11:03,816
它们可以和不同的对象


327
00:11:03,816 --> 00:11:04,776
相关联


328
00:11:04,816 --> 00:11:05,946
它们甚至可以存在不同的


329
00:11:05,946 --> 00:11:06,646
源文件中


330
00:11:07,356 --> 00:11:08,746
我们这么做是因为我们想


331
00:11:08,746 --> 00:11:10,556
让你可以在你的代码里使用它


332
00:11:10,856 --> 00:11:12,366
所以无论你有什么


333
00:11:12,366 --> 00:11:14,576
进入和退出的条件


334
00:11:14,626 --> 00:11:17,726
你都可以调用


335
00:11:17,876 --> 00:11:20,886
这就是如何使用 signposts


336
00:11:20,886 --> 00:11:22,366
来测量间隔时间


337
00:11:22,906 --> 00:11:24,516
可能你还想随 signposts


338
00:11:24,516 --> 00:11:25,716
传达一些额外的信息


339
00:11:25,716 --> 00:11:26,916
一些额外的


340
00:11:26,916 --> 00:11:28,496
和性能有关的信息


341
00:11:28,496 --> 00:11:30,396
对于这个 我们有办法


342
00:11:30,396 --> 00:11:32,306
向 signpost 调用添加元数据


343
00:11:33,526 --> 00:11:35,796
这是你的基础 signpost 调用


344
00:11:36,106 --> 00:11:37,256
在此基础上我们可以


345
00:11:37,256 --> 00:11:39,056
添加一个字符串常量参数


346
00:11:39,796 --> 00:11:40,846
这允许你为你的


347
00:11:40,846 --> 00:11:42,626
开始和结束调用点添加一些


348
00:11:42,626 --> 00:11:43,316
背景信息


349
00:11:44,366 --> 00:11:46,016
对于一段特定的操作


350
00:11:46,206 --> 00:11:47,896
你可能有很多进入和退出点


351
00:11:47,896 --> 00:11:50,416
但是字符串常量


352
00:11:50,416 --> 00:11:52,756
也是一个 OSLog 格式的字符串


353
00:11:53,226 --> 00:11:54,756
这意味着我可以拿它来


354
00:11:54,756 --> 00:11:57,406
向 signpost 传递额外的数据


355
00:11:57,686 --> 00:11:59,226
这里 比如说


356
00:11:59,226 --> 00:12:01,556
我使用了 %d 传递了四个整数


357
00:12:02,806 --> 00:12:04,846
但是因为这是一个 OSLog 格式的


358
00:12:04,846 --> 00:12:06,986
字符串 我还可以使用它来


359
00:12:06,986 --> 00:12:08,626
传递许多不同类型的参数


360
00:12:08,786 --> 00:12:09,766
这里我传递了一些


361
00:12:09,766 --> 00:12:10,796
浮点数


362
00:12:10,916 --> 00:12:12,266
我甚至使用了格式说明符


363
00:12:12,266 --> 00:12:14,726
来告诉系统


364
00:12:14,726 --> 00:12:15,736
我想要的精确度


365
00:12:16,246 --> 00:12:19,396
你也可以使用字符串常量


366
00:12:19,396 --> 00:12:20,926
formatter 来传递动态字符串


367
00:12:21,746 --> 00:12:23,086
这样我们可以


368
00:12:23,086 --> 00:12:24,186
传递来自函数调用


369
00:12:24,186 --> 00:12:25,656
或者来自


370
00:12:25,656 --> 00:12:27,186
用户输入的信息


371
00:12:28,046 --> 00:12:30,036
而我们使用


372
00:12:30,036 --> 00:12:31,756
固定大小的存储量来引用


373
00:12:31,756 --> 00:12:33,516
这个格式的字符串常量


374
00:12:33,516 --> 00:12:34,906
这意味着你可以想


375
00:12:34,906 --> 00:12:36,746
让它多长和易于理解


376
00:12:36,746 --> 00:12:37,136
都行


377
00:12:39,136 --> 00:12:41,356
这段易于理解的字符串


378
00:12:41,356 --> 00:12:42,346
跟之后 Instruments 渲染的


379
00:12:42,346 --> 00:12:43,656
是一样的


380
00:12:44,046 --> 00:12:45,986
所以你可以随意给它一些背景


381
00:12:45,986 --> 00:12:47,106
我在这里列举了


382
00:12:47,106 --> 00:12:48,006
很多参数


383
00:12:48,446 --> 00:12:49,866
Instruments 能够展示


384
00:12:49,866 --> 00:12:51,146
完整的渲染后的字符串


385
00:12:51,576 --> 00:12:53,146
或者它仍然对所附的


386
00:12:53,146 --> 00:12:55,486
数据有程序访问权限


387
00:12:57,756 --> 00:12:59,816
除了这些时段的


388
00:12:59,816 --> 00:13:01,226
元数据以外你可能还想


389
00:13:01,226 --> 00:13:03,496
添加独立的时间点


390
00:13:04,156 --> 00:13:06,236
也就是说除了


391
00:13:06,236 --> 00:13:08,246
开始 signpost 和结束 signpost 以外


392
00:13:08,246 --> 00:13:09,356
你还可以有这样一个 signpost


393
00:13:09,356 --> 00:13:10,726
它没有跟一个特定的


394
00:13:10,786 --> 00:13:12,646
时间段绑定


395
00:13:12,646 --> 00:13:14,406
而是跟一个固定的时刻绑定


396
00:13:14,636 --> 00:13:16,596
对于这个我们有一个


397
00:13:16,596 --> 00:13:17,946
类型为 event 的 os_signpost


398
00:13:18,886 --> 00:13:20,136
event 类型的 os_signpost


399
00:13:20,136 --> 00:13:21,926
的调用和开始结束的调用


400
00:13:21,926 --> 00:13:23,676
看起来一样


401
00:13:23,676 --> 00:13:24,966
只不过多了 event 的类型


402
00:13:25,706 --> 00:13:27,706
它标记了一个特定的时间点


403
00:13:28,656 --> 00:13:29,806
你可以在时间段的


404
00:13:29,806 --> 00:13:32,186
范围内使用它


405
00:13:32,186 --> 00:13:33,266
或者可能你想追踪


406
00:13:33,266 --> 00:13:34,506
独立于一个时间段的事件


407
00:13:34,506 --> 00:13:36,176
比如一次用户交互


408
00:13:36,966 --> 00:13:39,436
所以对于我们刚刚讲的


409
00:13:39,436 --> 00:13:41,066
获取素材的时间间隔


410
00:13:41,066 --> 00:13:42,206
你可能想知道


411
00:13:42,206 --> 00:13:43,556
你在什么时候连接到了


412
00:13:43,596 --> 00:13:44,616
提供这个素材的服务


413
00:13:45,066 --> 00:13:45,906
或者你可能想知道


414
00:13:45,906 --> 00:13:47,466
你在什么时候 接收到了其中的几个字节


415
00:13:48,416 --> 00:13:49,636
你可以使用这个


416
00:13:49,636 --> 00:13:51,056
在一个时间段过程中


417
00:13:51,056 --> 00:13:52,556
多次更新


418
00:13:52,596 --> 00:13:54,986
此时间段的状态和进展


419
00:13:56,426 --> 00:13:58,416
或者你可能想追踪一个


420
00:13:58,416 --> 00:14:00,776
触发事件比如


421
00:14:00,776 --> 00:14:02,336
一次用户界面交互


422
00:14:02,336 --> 00:14:04,196
比如有人刚滑动屏幕


423
00:14:04,196 --> 00:14:05,276
来更新界面


424
00:14:05,816 --> 00:14:07,206
虽然如果你真的在


425
00:14:07,206 --> 00:14:08,306
研究一个性能问题


426
00:14:08,336 --> 00:14:09,846
他们可能滑动了很多次


427
00:14:09,846 --> 00:14:12,436
所以这可能是你看到的


428
00:14:14,786 --> 00:14:17,136
如果你启用了 signpost


429
00:14:17,636 --> 00:14:18,686
默认情况下它们是开启的


430
00:14:19,396 --> 00:14:20,366
但是我想讲讲


431
00:14:20,486 --> 00:14:22,216
有条件地开启和关闭它们


432
00:14:23,986 --> 00:14:25,546
首先我想强调


433
00:14:25,546 --> 00:14:26,766
我们把 signpost 设计得


434
00:14:26,906 --> 00:14:27,536
轻便小巧


435
00:14:28,066 --> 00:14:29,986
这意味着我们做了很多


436
00:14:29,986 --> 00:14:32,146
来优化它们的启动时间


437
00:14:32,666 --> 00:14:33,376
我们通过优化了编译器


438
00:14:33,376 --> 00:14:34,796
使得任务能


439
00:14:34,796 --> 00:14:36,546
提前进行而非


440
00:14:36,606 --> 00:14:37,436
在运行时


441
00:14:37,926 --> 00:14:39,416
我们还推迟了很多事情


442
00:14:39,416 --> 00:14:40,796
使它们可以在 Instruments


443
00:14:40,796 --> 00:14:41,656
后台运行


444
00:14:41,946 --> 00:14:43,406
这意味着当


445
00:14:43,406 --> 00:14:44,376
在发送 signposts 时


446
00:14:44,376 --> 00:14:46,416
它们只会占用非常少的系统资源


447
00:14:46,876 --> 00:14:47,896
我们这么做是因为我们想


448
00:14:47,896 --> 00:14:49,456
最小化它给你的代码运行


449
00:14:49,456 --> 00:14:50,436
带来的影响


450
00:14:50,916 --> 00:14:52,096
我们这么做还因为


451
00:14:52,096 --> 00:14:53,236
我们想确保即使


452
00:14:53,236 --> 00:14:55,076
你的时间跨度非常小


453
00:14:55,076 --> 00:14:56,946
你也能发送很多


454
00:14:56,946 --> 00:14:57,866
signpost 来得到一些


455
00:14:57,866 --> 00:14:58,976
精确的测量结果


456
00:15:00,236 --> 00:15:01,566
但是你也可能想要


457
00:15:01,566 --> 00:15:03,066
关闭你的 signpost


458
00:15:03,406 --> 00:15:05,186
你可能想要通过


459
00:15:05,186 --> 00:15:06,836
特定路径中的代码消除


460
00:15:06,836 --> 00:15:07,656
尽可能多的开销


461
00:15:08,176 --> 00:15:10,186
或者你可能有两种类型的


462
00:15:10,186 --> 00:15:11,386
signposts 两种的体量


463
00:15:11,386 --> 00:15:14,546
都非常大 但是在某一时刻


464
00:15:14,546 --> 00:15:16,016
你仅仅想对其中一种


465
00:15:16,016 --> 00:15:17,096
进行除错


466
00:15:17,876 --> 00:15:19,536
要这么做的话


467
00:15:19,536 --> 00:15:20,806
我们要利用 OSLog 的一个功能


468
00:15:20,856 --> 00:15:23,266
禁用的日志句柄


469
00:15:24,136 --> 00:15:25,896
禁用的日志句柄是一个


470
00:15:26,386 --> 00:15:27,226
简单的句柄


471
00:15:27,276 --> 00:15:30,036
它的功能是把


472
00:15:30,096 --> 00:15:31,846
对于该句柄的


473
00:15:31,846 --> 00:15:33,766
OSLog 和 os_signpost 调用


474
00:15:33,766 --> 00:15:35,736
都变成类似于空操作的东西


475
00:15:36,556 --> 00:15:38,186
事实上 如果你在 C 当中使用它


476
00:15:38,466 --> 00:15:39,576
我们甚至会帮你检查行


477
00:15:39,626 --> 00:15:41,506
我们甚至不会


478
00:15:41,506 --> 00:15:42,856
评估剩下的参数


479
00:15:43,546 --> 00:15:45,246
所以你可以在运行时


480
00:15:45,246 --> 00:15:46,156
修改这个句柄


481
00:15:46,566 --> 00:15:47,746
让我给你看个例子


482
00:15:48,426 --> 00:15:51,226
让我们回到一开始


483
00:15:51,226 --> 00:15:53,146
使用的第一段代码示例


484
00:15:53,146 --> 00:15:54,846
你可以在上面看到初始化的


485
00:15:54,846 --> 00:15:56,066
日志句柄


486
00:15:56,896 --> 00:15:59,066
而我现在要让这个初始化


487
00:15:59,106 --> 00:16:00,596
有条件地发生


488
00:16:01,076 --> 00:16:02,866
所以我要么将它分配给


489
00:16:02,976 --> 00:16:04,546
普通的 os_log 构造函数


490
00:16:05,066 --> 00:16:05,906
或者把它分配给


491
00:16:05,906 --> 00:16:07,196
禁用的日志句柄


492
00:16:07,776 --> 00:16:11,126
如果我们采取第一种方法


493
00:16:11,126 --> 00:16:12,776
所有的 os_signpost 调用都会


494
00:16:12,776 --> 00:16:14,546
按照我刚刚说的一样进行


495
00:16:14,546 --> 00:16:15,996
但如果我们采取第二种方法


496
00:16:15,996 --> 00:16:17,256
这些 os_signpost 调用都会变成


497
00:16:17,256 --> 00:16:18,026
接近于空操作


498
00:16:18,876 --> 00:16:21,696
我刚刚说过


499
00:16:21,696 --> 00:16:22,886
我没有必要调用任何我的


500
00:16:22,886 --> 00:16:24,196
调用 我没有必要改变


501
00:16:24,196 --> 00:16:25,126
我的任何调用


502
00:16:25,126 --> 00:16:26,756
我只需要改变初始化


503
00:16:27,566 --> 00:16:29,346
我让初始化条件


504
00:16:29,346 --> 00:16:31,446
依赖于环境变量


505
00:16:31,696 --> 00:16:32,716
你可以在


506
00:16:32,716 --> 00:16:34,046
对程序进行调试时


507
00:16:34,046 --> 00:16:35,136
在 Xcode scheme 中


508
00:16:35,136 --> 00:16:37,236
对此进行设置


509
00:16:37,836 --> 00:16:39,126
我刚才说你没有必要


510
00:16:39,126 --> 00:16:40,346
在调用处内进行改变


511
00:16:40,346 --> 00:16:41,326
但是你可能有一些


512
00:16:41,326 --> 00:16:44,506
用于特定 instrumentation 的功能


513
00:16:44,586 --> 00:16:46,346
也就是说虽然代价高昂


514
00:16:46,346 --> 00:16:47,586
但可能只有在调试时


515
00:16:47,586 --> 00:16:48,086
才使用它


516
00:16:48,926 --> 00:16:50,976
这种情况下你可以检查一个


517
00:16:50,976 --> 00:16:52,486
特定的日志句柄


518
00:16:52,486 --> 00:16:53,736
看看在启用 signpost


519
00:16:54,076 --> 00:16:55,536
属性中是否启用了 signpost


520
00:16:56,036 --> 00:16:57,256
启用了 signpost 的属性


521
00:16:57,256 --> 00:16:58,656
可以用来控制


522
00:16:58,656 --> 00:17:00,526
额外的操作


523
00:17:02,586 --> 00:17:02,876
好的


524
00:17:03,426 --> 00:17:05,076
我刚展示过的所有例子


525
00:17:05,076 --> 00:17:06,646
都是用的 Swift


526
00:17:07,356 --> 00:17:11,175
但是 signposts 也可以用于 C


527
00:17:13,086 --> 00:17:13,925
我刚刚讲过的


528
00:17:13,955 --> 00:17:15,476
所有功能都可以用


529
00:17:15,476 --> 00:17:17,266
日志句柄


530
00:17:17,675 --> 00:17:18,665
发送三种不同的


531
00:17:18,665 --> 00:17:21,236
signpost 以及管理


532
00:17:21,236 --> 00:17:22,476
你的 signpost 标识符


533
00:17:23,066 --> 00:17:23,816
对于那些对使用 C


534
00:17:23,816 --> 00:17:25,726
感兴趣的人来说


535
00:17:25,726 --> 00:17:26,876
我鼓励你们阅读标题文档


536
00:17:26,876 --> 00:17:28,086
标题文档涵盖了所有


537
00:17:28,086 --> 00:17:29,566
我刚讲的信息但是是从


538
00:17:29,566 --> 00:17:30,896
C 语言开发者的角度写的


539
00:17:32,236 --> 00:17:32,806
好了


540
00:17:33,476 --> 00:17:34,876
现在你知道了如何在


541
00:17:34,876 --> 00:17:35,866
代码中使用 signpost


542
00:17:36,356 --> 00:17:38,006
或许你对它们代表的东西


543
00:17:38,006 --> 00:17:39,386
有了一个思维模型


544
00:17:39,956 --> 00:17:41,436
所以我想让你们看看


545
00:17:41,436 --> 00:17:43,126
signposts 如何与


546
00:17:43,306 --> 00:17:43,926
Instruments 协作


547
00:17:44,486 --> 00:17:45,936
这一块 我要把


548
00:17:45,936 --> 00:17:46,906
剩下的环节交给


549
00:17:46,906 --> 00:17:48,416
我的同事 Chad


550
00:17:49,016 --> 00:17:49,276
谢谢


551
00:17:50,516 --> 00:17:56,796
[ 掌声 ]


552
00:17:57,296 --> 00:17:57,926
>> 好了


553
00:17:58,646 --> 00:17:59,246
谢谢你 Shane


554
00:18:00,486 --> 00:18:02,606
今天我要向大家演示


555
00:18:02,606 --> 00:18:04,036
Instruments 10 的


556
00:18:04,036 --> 00:18:05,016
三个重要的新功能


557
00:18:05,016 --> 00:18:06,776
帮助你更好地


558
00:18:06,776 --> 00:18:07,616
处理 signpost 数据


559
00:18:08,506 --> 00:18:10,436
第一个就是新的 os_signpost instrument


560
00:18:10,686 --> 00:18:11,656
这个 instrument 允许你


561
00:18:11,656 --> 00:18:13,186
记录 图形化


562
00:18:13,186 --> 00:18:14,986
并分析你 App


563
00:18:14,986 --> 00:18:16,736
的所有 signpost 活动


564
00:18:17,636 --> 00:18:20,036
下一个功能是 points of interest


565
00:18:20,036 --> 00:18:20,846
我会大概讲讲什么是


566
00:18:20,846 --> 00:18:22,316
points of interest


567
00:18:22,426 --> 00:18:23,946
你会在什么时候使用它


568
00:18:24,396 --> 00:18:26,026
然后我会向大家展示


569
00:18:26,026 --> 00:18:27,636
新的自定义 instrument 功能


570
00:18:27,636 --> 00:18:29,086
以及如何同 os_signpost


571
00:18:29,086 --> 00:18:31,946
使用它来得到关于


572
00:18:32,286 --> 00:18:34,536
signpost 的更精确的


573
00:18:34,536 --> 00:18:35,386
一个表示


574
00:18:35,986 --> 00:18:37,616
让我们看看


575
00:18:37,616 --> 00:18:38,346
操作示范吧


576
00:18:39,116 --> 00:18:39,216
好的


577
00:18:42,626 --> 00:18:44,526
首先让我们


578
00:18:44,526 --> 00:18:47,106
看看我们的示例程序


579
00:18:47,256 --> 00:18:48,986
这是我们的 Trailblazer App


580
00:18:50,046 --> 00:18:53,016
这个 App 向你展示了


581
00:18:53,016 --> 00:18:54,056
当地的登山路线


582
00:18:54,476 --> 00:18:56,626
当我们往下滑时


583
00:18:56,656 --> 00:18:58,756
它会为你下载这些好看的图片


584
00:18:59,916 --> 00:19:01,476
你会注意到最开始


585
00:19:01,566 --> 00:19:03,216
是白色的背景然后


586
00:19:03,216 --> 00:19:04,896
图片随后出现 填充了背景


587
00:19:04,896 --> 00:19:06,486
对于这类 App


588
00:19:06,486 --> 00:19:08,536
这是非常常见的现象


589
00:19:08,536 --> 00:19:09,526
有时它植入了


590
00:19:09,526 --> 00:19:12,466
future 或者 promise


591
00:19:12,466 --> 00:19:13,796
但是这个现象 虽然它对


592
00:19:13,896 --> 00:19:15,746
性能很有帮助


593
00:19:15,746 --> 00:19:17,496
它也很难被配置


594
00:19:17,556 --> 00:19:19,896
原因在于有很多异步的


595
00:19:19,896 --> 00:19:21,486
活动在同时进行


596
00:19:21,876 --> 00:19:23,796
当用户滑动时


597
00:19:23,796 --> 00:19:25,996
有一些下载在同时进行


598
00:19:25,996 --> 00:19:27,316
如果用户像这样


599
00:19:27,316 --> 00:19:29,226
飞快地滑动时那么


600
00:19:29,226 --> 00:19:31,646
在图像单元重新被使用


601
00:19:31,776 --> 00:19:33,536
之前下载可能还没有完成


602
00:19:34,066 --> 00:19:35,826
那么我们就得取消下载


603
00:19:36,076 --> 00:19:37,986
如果我们取消失败了


604
00:19:37,986 --> 00:19:40,236
那么一些下载就会


605
00:19:40,236 --> 00:19:41,326
并行运行但是我们


606
00:19:41,326 --> 00:19:42,276
并不想这样


607
00:19:42,936 --> 00:19:44,196
让我们看看如何


608
00:19:44,196 --> 00:19:46,416
使用 signposts 来分析


609
00:19:46,416 --> 00:19:47,866
我们的 Trailblazer 的 App


610
00:19:48,546 --> 00:19:51,326
在路线单元中


611
00:19:51,326 --> 00:19:53,026
有一个方式叫做


612
00:19:53,206 --> 00:19:54,956
startImageDownload


613
00:19:55,286 --> 00:19:56,486
当我们需要下载新图像时


614
00:19:56,486 --> 00:19:58,736
它就会被调用


615
00:19:58,996 --> 00:20:00,726
它传递了需要被下载的


616
00:20:01,016 --> 00:20:01,856
图像名称


617
00:20:02,506 --> 00:20:03,666
现在我们在这里有一个


618
00:20:04,256 --> 00:20:05,896
download helper 的类 


619
00:20:05,896 --> 00:20:07,386
我们创建一个传递名称的实例


620
00:20:07,386 --> 00:20:08,546
将我们自己设为委托


621
00:20:08,546 --> 00:20:09,626
当它下载完后就会


622
00:20:09,656 --> 00:20:10,136
回调我们


623
00:20:10,136 --> 00:20:13,486
这种情况下


624
00:20:13,486 --> 00:20:15,386
既然 downloader 代表


625
00:20:15,566 --> 00:20:16,816
同时进行的活动


626
00:20:16,816 --> 00:20:19,016
这个异步的工作


627
00:20:19,016 --> 00:20:20,836
就是 signpost ID 的绝佳依据


628
00:20:21,046 --> 00:20:22,046
我们现在用我们的


629
00:20:22,046 --> 00:20:25,156
downloader 对象来创建 signpost ID 


630
00:20:26,606 --> 00:20:27,746
要启用我们的 signposts


631
00:20:27,746 --> 00:20:29,356
我们要做一个 os_signpost begin


632
00:20:29,656 --> 00:20:30,886
我们将它发送到


633
00:20:30,886 --> 00:20:32,836
我们的 networking 日志句柄


634
00:20:32,876 --> 00:20:34,606
快速浏览下我们的


635
00:20:34,606 --> 00:20:35,616
networking 日志句柄


636
00:20:35,926 --> 00:20:37,516
你可以看到我们使用了


637
00:20:37,516 --> 00:20:39,446
Trailblazer 套装 ID 和


638
00:20:39,446 --> 00:20:40,906
networking 类别


639
00:20:41,606 --> 00:20:45,786
现在我们要传递一张图像


640
00:20:45,786 --> 00:20:47,896
不好意思是背景图片的


641
00:20:47,896 --> 00:20:49,086
signpost 名称这样我们


642
00:20:49,086 --> 00:20:50,216
就能看到所有背景


643
00:20:50,216 --> 00:20:51,106
图片的下载


644
00:20:51,106 --> 00:20:52,936
它会传递我们创建的


645
00:20:52,936 --> 00:20:53,756
signpost ID


646
00:20:53,816 --> 00:20:56,356
我们给开始附上一些


647
00:20:56,356 --> 00:20:59,206
元数据来传达我们


648
00:20:59,206 --> 00:21:01,016
下载的图像的名称


649
00:21:01,636 --> 00:21:02,476
然后我们开始下载


650
00:21:02,476 --> 00:21:04,556
我们设置属性


651
00:21:04,796 --> 00:21:06,526
来追踪下载


652
00:21:06,526 --> 00:21:08,096
目前设为 runningDownloader


653
00:21:09,196 --> 00:21:10,406
这个完成后我们会在这里


654
00:21:10,406 --> 00:21:12,736
有一个 didReceiveImage 回调


655
00:21:13,126 --> 00:21:15,266
然后我们将图像视图


656
00:21:15,266 --> 00:21:16,266
设为接收到的图像


657
00:21:17,376 --> 00:21:19,686
然后我们结束调用 signpost


658
00:21:19,926 --> 00:21:21,316
然后我们将使用完全


659
00:21:21,316 --> 00:21:23,266
一样的日志句柄 一样的名称


660
00:21:23,266 --> 00:21:25,666
一样的 signpost ID 但这次


661
00:21:25,666 --> 00:21:27,686
我们将附上一些


662
00:21:27,686 --> 00:21:29,286
结束的元数据比如


663
00:21:29,286 --> 00:21:29,846
“finished with size”


664
00:21:30,726 --> 00:21:32,686
你会注意到这里


665
00:21:33,296 --> 00:21:35,896
我们给了这个参数标记了


666
00:21:35,896 --> 00:21:38,406
Xcode:size-in-bytes 的特征


667
00:21:38,406 --> 00:21:40,056
这个东西告诉


668
00:21:40,336 --> 00:21:42,276
Xcode 和 Instruments


669
00:21:42,276 --> 00:21:43,676
这项参数在显示


670
00:21:43,676 --> 00:21:45,566
和分析中都应被当做


671
00:21:45,716 --> 00:21:46,536
size-in-bytes


672
00:21:47,756 --> 00:21:49,166
这些叫工程类型


673
00:21:49,166 --> 00:21:50,336
你可以在 Instruments


674
00:21:50,336 --> 00:21:51,656
开发者帮助指南中


675
00:21:51,656 --> 00:21:52,986
读到 就在 Instruments


676
00:21:52,986 --> 00:21:54,206
的帮助菜单中


677
00:21:54,956 --> 00:21:57,676
当我们完成下载后


678
00:21:57,676 --> 00:21:59,556
我们可以将它设为 nil


679
00:22:00,106 --> 00:22:02,366
我们有两种方式来


680
00:22:02,366 --> 00:22:03,656
结束下载


681
00:22:03,656 --> 00:22:05,766
一种是成功的情况


682
00:22:06,036 --> 00:22:07,576
而我们还要考虑


683
00:22:07,576 --> 00:22:08,206
取消的情况


684
00:22:08,896 --> 00:22:11,176
准备重新使用时 如果我们


685
00:22:11,176 --> 00:22:12,136
现在有一个正在运行的


686
00:22:12,136 --> 00:22:13,656
downloader 我们首先需要


687
00:22:13,716 --> 00:22:15,486
取消这个 downloader


688
00:22:16,316 --> 00:22:17,406
这种情况下我们要


689
00:22:17,406 --> 00:22:18,916
为这个时间段创建结束点


690
00:22:19,106 --> 00:22:20,936
然后我们使用同一个


691
00:22:21,306 --> 00:22:24,766
日志句柄 signpost 名称 signpost ID


692
00:22:25,296 --> 00:22:27,046
然后我们使用 cancelled


693
00:22:27,046 --> 00:22:29,456
作为结束元数据来隔开它


694
00:22:29,456 --> 00:22:31,066
当我们成功完成时


695
00:22:32,116 --> 00:22:33,606
这些应该足够


696
00:22:33,606 --> 00:22:34,356
来配置了


697
00:22:34,356 --> 00:22:38,146
现在我们到这里来配置产品


698
00:22:38,146 --> 00:22:40,086
而当我们完成


699
00:22:40,086 --> 00:22:43,876
构建和安装后它就会


700
00:22:43,916 --> 00:22:44,816
启动 Instruments


701
00:22:44,816 --> 00:22:47,146
它会在这里启动 Instruments


702
00:22:47,266 --> 00:22:49,666
我们可以创建一个空白的


703
00:22:49,666 --> 00:22:50,156
新文档


704
00:22:50,536 --> 00:22:52,456
然后我们到 library 中


705
00:22:52,546 --> 00:22:54,156
我可以向你展示如何使用


706
00:22:54,156 --> 00:22:56,126
新的 os_signpost instrument


707
00:22:56,646 --> 00:22:59,256
这里有我们新的 os_signpost instrument


708
00:22:59,386 --> 00:23:03,806
然后我们把它拖动 挪到这里


709
00:23:04,186 --> 00:23:05,116
我们给它在这里


710
00:23:05,116 --> 00:23:07,176
多留点空间然后我们


711
00:23:07,176 --> 00:23:08,376
按下录制


712
00:23:08,646 --> 00:23:12,226
然后我们拿出 iPhone


713
00:23:12,396 --> 00:23:13,556
回到开始状态


714
00:23:13,876 --> 00:23:14,066
好了


715
00:23:14,066 --> 00:23:15,076
现在我们要开始滑动


716
00:23:15,076 --> 00:23:16,226
然后我们也会


717
00:23:16,226 --> 00:23:17,126
非常 非常快得滑动屏幕


718
00:23:17,196 --> 00:23:20,116
然后我们让它停下


719
00:23:20,576 --> 00:23:22,236
现在我们返回到


720
00:23:22,236 --> 00:23:23,326
Instruments 中看看我们记录下了


721
00:23:23,326 --> 00:23:24,096
什么数据


722
00:23:24,796 --> 00:23:26,776
现在我要停止录制


723
00:23:27,636 --> 00:23:29,716
现在你可以注意到


724
00:23:30,006 --> 00:23:31,406
在轨迹视图中


725
00:23:31,406 --> 00:23:33,206
我们可以直观地看到


726
00:23:33,206 --> 00:23:34,636
所有背景图片时间间隔


727
00:23:34,636 --> 00:23:35,706
这是 signpost 名称


728
00:23:35,996 --> 00:23:37,706
如果我们按住选项键


729
00:23:37,706 --> 00:23:40,236
然后放大你可以看到


730
00:23:40,646 --> 00:23:41,546
有一些时间段


731
00:23:41,766 --> 00:23:43,946
时间段被


732
00:23:43,946 --> 00:23:45,846
开始元数据和结束


733
00:23:45,846 --> 00:23:47,176
元数据标记


734
00:23:48,126 --> 00:23:50,106
如果我们缩回去


735
00:23:50,386 --> 00:23:52,066
然后再次观察轨迹


736
00:23:52,066 --> 00:23:54,786
我们会注意到


737
00:23:54,876 --> 00:23:57,546
只有少于五张的图片


738
00:23:57,546 --> 00:23:58,466
在同时进行下载


739
00:23:58,466 --> 00:23:59,546
这是一件好事


740
00:24:00,006 --> 00:24:01,646
这意味着我们取消成功了


741
00:24:01,646 --> 00:24:04,276
如果我们想确认的话


742
00:24:04,276 --> 00:24:05,346
我们可以到这里然后


743
00:24:05,346 --> 00:24:07,606
你可以看到许多


744
00:24:07,606 --> 00:24:09,536
时间间隔的元数据都


745
00:24:09,536 --> 00:24:11,936
写着下载时被取消


746
00:24:12,706 --> 00:24:14,506
如果你想 如果


747
00:24:14,506 --> 00:24:16,716
你想看看数据


748
00:24:17,076 --> 00:24:18,346
或者说你想看看


749
00:24:18,346 --> 00:24:19,586
这些间隔的持续时间


750
00:24:19,586 --> 00:24:22,196
那么你可以来这里


751
00:24:22,246 --> 00:24:23,726
看看这些间隔的概要


752
00:24:24,126 --> 00:24:26,726
然后我们看到按类别


753
00:24:26,726 --> 00:24:28,886
进行了细分 然后按 signpost


754
00:24:28,886 --> 00:24:30,616
名称然后按开始信息


755
00:24:30,616 --> 00:24:32,456
然后按结束信息


756
00:24:33,386 --> 00:24:35,326
如果我们把这个缩小


757
00:24:35,326 --> 00:24:38,056
你可以看到我们


758
00:24:38,056 --> 00:24:41,306
发送了 93 次图片下载请求


759
00:24:42,236 --> 00:24:44,236
其中 12 次是针对于位置 1


760
00:24:45,426 --> 00:24:46,506
在这 12 次中


761
00:24:46,506 --> 00:24:48,776
7 次被取消 5 次完成


762
00:24:48,806 --> 00:24:50,736
大小为 3.31 MB


763
00:24:52,006 --> 00:24:53,036
如果你现在看这里


764
00:24:53,036 --> 00:24:54,716
这些是关于时段的


765
00:24:54,716 --> 00:24:55,386
统计数据


766
00:24:55,776 --> 00:24:58,496
然后你们可以看到


767
00:24:58,736 --> 00:25:00,506
被取消的最小和平均


768
00:25:01,106 --> 00:25:02,966
时间段比


769
00:25:02,966 --> 00:25:04,816
下载完全的时间段


770
00:25:05,066 --> 00:25:06,056
要小很多


771
00:25:06,056 --> 00:25:07,086
这就是在这种


772
00:25:07,086 --> 00:25:08,826
情况下你期待看到的


773
00:25:09,866 --> 00:25:11,086
现在如果你想要看所有


774
00:25:11,086 --> 00:25:12,926
被取消掉的事件


775
00:25:12,926 --> 00:25:13,966
因为你对这些很感兴趣


776
00:25:13,966 --> 00:25:16,186
你可以按下这个聚焦箭头


777
00:25:16,216 --> 00:25:19,586
然后它会带你跳转到一个


778
00:25:19,586 --> 00:25:21,586
列表视图你可以在这里看到


779
00:25:21,586 --> 00:25:24,186
所有地方 其中位置 1 


780
00:25:24,186 --> 00:25:25,626
有结束信息 “cancelled”


781
00:25:26,386 --> 00:25:28,156
并且当我们浏览的时候


782
00:25:28,156 --> 00:25:29,146
你会看到轨迹


783
00:25:29,146 --> 00:25:30,636
上方的探头


784
00:25:31,016 --> 00:25:32,566
会移到每一个


785
00:25:32,566 --> 00:25:33,206
时间间隔处


786
00:25:33,336 --> 00:25:35,066
所以你可以追踪所有


787
00:25:35,066 --> 00:25:36,086
失败的情况如果你


788
00:25:36,086 --> 00:25:36,556
感兴趣的话


789
00:25:36,666 --> 00:25:40,076
这是一个查看这些


790
00:25:40,316 --> 00:25:42,756
间隔的时间


791
00:25:42,756 --> 00:25:44,096
时间点的好方法


792
00:25:44,456 --> 00:25:46,926
但是如果你想进行对这些


793
00:25:46,926 --> 00:25:48,536
元数据进行分析呢


794
00:25:49,316 --> 00:25:50,886
如果你想确定


795
00:25:51,046 --> 00:25:53,426
有多少字节的图像数据


796
00:25:53,426 --> 00:25:54,916
是我们已经从网络上下载了呢


797
00:25:55,696 --> 00:25:57,906
我们已经发送了元数据信息


798
00:25:57,906 --> 00:25:59,946
比如 “Finished with size”


799
00:25:59,996 --> 00:26:01,026
然后是它的大小


800
00:26:01,026 --> 00:26:02,516
如果我们能把这些参数加起来


801
00:26:02,576 --> 00:26:04,536
那就太棒了


802
00:26:05,266 --> 00:26:06,546
所以，如果你想这么做


803
00:26:06,546 --> 00:26:07,256
你可以在这里选择


804
00:26:07,256 --> 00:26:09,286
“summary of metadata statistics”


805
00:26:10,616 --> 00:26:11,696
你可以看到


806
00:26:11,696 --> 00:26:13,276
我们将它分解成了子系统


807
00:26:13,826 --> 00:26:17,076
种类和格式化字符串


808
00:26:17,076 --> 00:26:18,636
在格式化字符串下面


809
00:26:18,636 --> 00:26:19,606
是它的参数


810
00:26:19,816 --> 00:26:20,996
由于我们的格式化字符串


811
00:26:20,996 --> 00:26:22,926
只有一个参数 所以就是 arg0


812
00:26:22,926 --> 00:26:26,416
现在 Instruments 已经将这些加在一起了


813
00:26:26,416 --> 00:26:27,896
并且它知道这是一个


814
00:26:27,896 --> 00:26:28,776
以字节计的大小


815
00:26:28,776 --> 00:26:29,866
它给了我们一个精准的计算


816
00:26:29,866 --> 00:26:31,986
结果为 80MB


817
00:26:32,036 --> 00:26:33,626
所以我们一共下载了


818
00:26:33,656 --> 00:26:34,856
80MB 的图像数据


819
00:26:35,046 --> 00:26:37,666
现在你在这里可以


820
00:26:37,666 --> 00:26:38,186
看到不同的列


821
00:26:38,186 --> 00:26:39,196
有最小值 最大值 平均值


822
00:26:39,196 --> 00:26:40,166
还有标准差


823
00:26:40,256 --> 00:26:41,776
所以这是一个很好的方式


824
00:26:41,846 --> 00:26:43,976
来查看你通过


825
00:26:43,976 --> 00:26:47,706
元数据传递的值的统计分析


826
00:26:48,306 --> 00:26:49,296
Shane 刚刚提到


827
00:26:49,296 --> 00:26:51,766
signposts 非常轻量


828
00:26:52,056 --> 00:26:54,596
这是完全正确的


829
00:26:54,806 --> 00:26:55,916
除非你像我 刚刚跑 Instruments


830
00:26:55,916 --> 00:26:56,816
那样运行 Instruments


831
00:26:57,016 --> 00:27:00,056
在 immediate 模式下


832
00:27:00,056 --> 00:27:01,166
即默认录制模式下


833
00:27:01,166 --> 00:27:03,126
Instruments 几乎是在


834
00:27:03,126 --> 00:27:06,416
实时展现和记录数据


835
00:27:07,056 --> 00:27:07,926
所以当它进入到


836
00:27:07,926 --> 00:27:09,556
immediate 模式录制时


837
00:27:09,626 --> 00:27:11,636
所有的 signposts 都必须直接


838
00:27:11,636 --> 00:27:12,826
发给 Instruments


839
00:27:13,326 --> 00:27:15,106
我们就避开了


840
00:27:15,106 --> 00:27:16,176
在操作系统中


841
00:27:16,176 --> 00:27:18,486
缓冲能获得的优化


842
00:27:19,196 --> 00:27:21,966
现在，通过我们的 signposts


843
00:27:21,966 --> 00:27:23,576
通过我们的 signposts App


844
00:27:24,036 --> 00:27:25,546
我们并不会真正创建足够多的


845
00:27:25,546 --> 00:27:27,176
时间间隔使我们注意到花销


846
00:27:27,176 --> 00:27:29,186
但是如果你有一个游戏引擎


847
00:27:29,186 --> 00:27:30,156
并且你想要每秒发送


848
00:27:30,156 --> 00:27:32,146
数千个 signpost


849
00:27:32,146 --> 00:27:34,836
这时开销就会开始累积变多


850
00:27:35,266 --> 00:27:37,336
所以为了避免这个问题


851
00:27:37,756 --> 00:27:39,376
你可以在你


852
00:27:39,376 --> 00:27:41,176
录制之前改变


853
00:27:41,616 --> 00:27:42,736
Instruments 的录制模式


854
00:27:43,286 --> 00:27:45,016
你可以通过


855
00:27:45,016 --> 00:27:46,956
下拉录制按钮


856
00:27:46,956 --> 00:27:49,266
然后选择录制选项来实现


857
00:27:50,706 --> 00:27:52,496
在这块全局选项


858
00:27:52,646 --> 00:27:55,326
的区域中你可以看到


859
00:27:55,326 --> 00:27:57,176
我们选中了 immediate 模式


860
00:27:57,496 --> 00:27:58,976
我们可以把它变成


861
00:27:58,976 --> 00:27:59,876
last 5 second 模式


862
00:28:00,436 --> 00:28:01,656
这种模式通常被称为


863
00:28:01,656 --> 00:28:02,376
窗口模式


864
00:28:03,206 --> 00:28:04,736
它告诉操作系统


865
00:28:04,736 --> 00:28:05,416
和录制技术


866
00:28:05,416 --> 00:28:07,416
我们不需要


867
00:28:07,416 --> 00:28:08,306
每一个事件


868
00:28:08,306 --> 00:28:09,386
我们只想要最后五秒


869
00:28:09,386 --> 00:28:10,046
的内容


870
00:28:10,366 --> 00:28:11,786
当你这么做时


871
00:28:11,786 --> 00:28:12,946
Instruments 会让开


872
00:28:12,946 --> 00:28:15,416
然后让操作系统来做


873
00:28:15,836 --> 00:28:16,966
这是一个非常常见的模式


874
00:28:16,966 --> 00:28:18,296
我们将它用于系统追踪


875
00:28:18,296 --> 00:28:19,976
我们将它用于 metal 系统追踪


876
00:28:19,976 --> 00:28:21,806
和新的游戏性能模板


877
00:28:22,276 --> 00:28:23,736
所以这是一种在你的 App 中


878
00:28:23,736 --> 00:28:25,776
寻找卡顿和挂机的非常常见的方式


879
00:28:25,846 --> 00:28:26,646
好了


880
00:28:27,256 --> 00:28:30,916
这就是我们的 os_signpost


881
00:28:30,996 --> 00:28:31,426
instrument


882
00:28:32,756 --> 00:28:34,756
现在让我们来说说 points of interest


883
00:28:36,046 --> 00:28:38,216
现在如果我们回到


884
00:28:38,326 --> 00:28:39,476
Trailblazer App


885
00:28:40,216 --> 00:28:43,176
你注意到当我点击一个路线


886
00:28:43,176 --> 00:28:45,166
它就显示详细内容


887
00:28:46,026 --> 00:28:47,326
如果我返回点一个


888
00:28:47,326 --> 00:28:48,676
不同的路线它就显示


889
00:28:48,676 --> 00:28:49,316
不同的详细信息


890
00:28:50,476 --> 00:28:53,186
如果我们能追踪


891
00:28:53,326 --> 00:28:55,026
每一次详细信息界面的


892
00:28:55,026 --> 00:28:56,516
的出现那就好了


893
00:28:56,896 --> 00:28:57,986
因为这样我们就能分辨出


894
00:28:57,986 --> 00:28:59,266
我们的用户在试图做什么


895
00:28:59,266 --> 00:29:00,856
我们知道用户在 App 中


896
00:29:00,856 --> 00:29:01,606
所处位置


897
00:29:02,626 --> 00:29:04,466
你当然可以用一个 signpost


898
00:29:04,466 --> 00:29:07,246
来做这个但是你必须在


899
00:29:07,296 --> 00:29:08,526
os_signpost instrument


900
00:29:08,526 --> 00:29:10,366
里拖动并记录下 App 中


901
00:29:10,366 --> 00:29:12,146
所有 signpost 的活动


902
00:29:12,146 --> 00:29:14,316
它某种程度上降低了


903
00:29:14,316 --> 00:29:16,456
这些用户使用事件


904
00:29:16,456 --> 00:29:17,086
的重要性


905
00:29:17,756 --> 00:29:19,386
所以我们允许你


906
00:29:19,386 --> 00:29:20,826
将它们弄到


907
00:29:20,936 --> 00:29:21,796
points of interest 中去


908
00:29:22,566 --> 00:29:23,746
现在如果我到代码里


909
00:29:23,746 --> 00:29:26,636
查看细节控制器


910
00:29:26,636 --> 00:29:28,406
看我们的 viewDidAppear 方法


911
00:29:28,406 --> 00:29:31,006
你可以看到我正在发布


912
00:29:31,006 --> 00:29:32,426
我正在创建一个 os_signpost 事件


913
00:29:33,076 --> 00:29:34,296
显示 “Detail Appeared”


914
00:29:34,696 --> 00:29:36,136
以及细节的名称


915
00:29:37,186 --> 00:29:38,206
这被发送给我们创建的


916
00:29:38,206 --> 00:29:39,486
一个特别的日志句柄


917
00:29:39,486 --> 00:29:40,516
叫 points of interest


918
00:29:40,986 --> 00:29:42,116
创建它的方式是


919
00:29:42,556 --> 00:29:43,836
创建一个带子系统


920
00:29:43,946 --> 00:29:46,166
标识符和系统


921
00:29:46,256 --> 00:29:47,976
points of interest 类别的


922
00:29:47,976 --> 00:29:48,466
日志句柄


923
00:29:48,666 --> 00:29:49,946
这是一个


924
00:29:49,946 --> 00:29:51,196
Instruments 会查找的特殊类别


925
00:29:51,656 --> 00:29:52,896
当它看到这里的 points


926
00:29:53,246 --> 00:29:55,746
它会把它们放到 points


927
00:29:55,786 --> 00:29:57,196
of interest instrument 里


928
00:29:57,336 --> 00:29:59,856
如果我们回到这里然后点击


929
00:29:59,856 --> 00:30:01,636
time profile 你可以看到


930
00:30:01,636 --> 00:30:03,636
这里自动包含了


931
00:30:03,636 --> 00:30:04,976
points of interest instrument


932
00:30:05,146 --> 00:30:08,706
如果我们录制下来


933
00:30:08,936 --> 00:30:11,246
然后进行同样的基础操作


934
00:30:11,246 --> 00:30:12,636
我们进入 Matt Davis Trail


935
00:30:12,636 --> 00:30:13,426
然后我们回到


936
00:30:13,426 --> 00:30:15,536
Skyline Trail 然后再回来


937
00:30:15,536 --> 00:30:17,896
我们再做一次为了测得更准


938
00:30:19,366 --> 00:30:20,856
现在当你返回到


939
00:30:21,236 --> 00:30:25,176
Instruments 你可以看到


940
00:30:25,176 --> 00:30:26,276
这些 points of interest


941
00:30:26,606 --> 00:30:27,806
突出显示


942
00:30:27,806 --> 00:30:29,776
所以你能看到


943
00:30:29,776 --> 00:30:31,236
在你 App 中 你的用户所处位置


944
00:30:31,236 --> 00:30:32,406
你可以将这个和其他


945
00:30:32,406 --> 00:30:33,316
性能数据关联


946
00:30:33,986 --> 00:30:34,986
所以 points of interest


947
00:30:34,986 --> 00:30:38,626
可以让你 从你的 App 中


948
00:30:38,626 --> 00:30:40,546
选择一些最重要的


949
00:30:40,546 --> 00:30:42,016
兴趣点然后把它们


950
00:30:42,016 --> 00:30:44,036
提供给你团队中


951
00:30:44,036 --> 00:30:45,446
或者开发社区中的


952
00:30:45,446 --> 00:30:46,306
每一位开发者


953
00:30:46,566 --> 00:30:47,736
然后他们可以立即看到


954
00:30:47,736 --> 00:30:48,596
points of interest


955
00:30:49,956 --> 00:30:50,156
好了


956
00:30:50,156 --> 00:30:51,756
这就是 points of interest


957
00:30:51,756 --> 00:30:53,596
instrument 以及如何从


958
00:30:53,596 --> 00:30:54,956
signposts 中创建


959
00:30:54,956 --> 00:30:55,646
points of interest


960
00:30:56,966 --> 00:30:58,926
另一个 Instruments 10 中


961
00:30:59,276 --> 00:31:01,006
很好的功能是


962
00:31:01,006 --> 00:31:03,026
你可以创建自定义的 instrument


963
00:31:03,576 --> 00:31:05,096
为了向大家展示


964
00:31:05,096 --> 00:31:06,456
在 os_signpost 可以对自定义


965
00:31:06,456 --> 00:31:08,816
instrument 做什么 我们创建了


966
00:31:08,816 --> 00:31:11,256
作为项目的一部分


967
00:31:11,256 --> 00:31:12,836
一个 Trailblazer instruments 包


968
00:31:13,916 --> 00:31:16,226
我现在要构建并运行


969
00:31:16,306 --> 00:31:20,306
你可以看到当我们在做时


970
00:31:20,586 --> 00:31:21,996
我们启动了 Instruments


971
00:31:21,996 --> 00:31:24,566
的一个独立备份


972
00:31:24,566 --> 00:31:25,796
里面有我们刚建的包


973
00:31:25,796 --> 00:31:28,796
如果我们将版本调出来


974
00:31:28,796 --> 00:31:30,666
可以看到我们现在


975
00:31:30,726 --> 00:31:32,356
有一个 Trailblazer Networking


976
00:31:32,856 --> 00:31:33,826
轨迹模板


977
00:31:33,826 --> 00:31:36,296
如果我们选中它可以看到


978
00:31:36,456 --> 00:31:38,046
我们有一个 Trailblazer


979
00:31:38,046 --> 00:31:39,616
Networking instrument


980
00:31:39,616 --> 00:31:40,246
在我们的轨迹文档中


981
00:31:41,546 --> 00:31:43,266
让我们开始录制


982
00:31:43,326 --> 00:31:44,226
然后看看我们的 


983
00:31:44,226 --> 00:31:46,666
points of interest 的区别


984
00:31:46,666 --> 00:31:48,176
不好意思 我们的 os_signpost


985
00:31:48,376 --> 00:31:49,736
和自定义 instrument


986
00:31:49,736 --> 00:31:50,016
可以做什么


987
00:31:50,106 --> 00:31:51,416
我们要做同样的事情


988
00:31:51,956 --> 00:31:53,156
我们开始基本的下载


989
00:31:53,246 --> 00:31:57,046
然后回来


990
00:31:57,046 --> 00:31:58,086
然后分析我们的轨迹


991
00:31:59,036 --> 00:32:00,656
现在这里显示的


992
00:32:00,656 --> 00:32:01,646
完全不一样


993
00:32:01,786 --> 00:32:04,676
让我们放大 然后 观察


994
00:32:04,676 --> 00:32:07,076
你看到在这里左边


995
00:32:07,076 --> 00:32:08,066
我们没有按


996
00:32:08,066 --> 00:32:09,396
signpost 名称细分


997
00:32:09,396 --> 00:32:10,906
而是按下载的图像


998
00:32:11,416 --> 00:32:13,466
现在我们可以看到图二


999
00:32:13,656 --> 00:32:17,406
是在这里和这里下载的


1000
00:32:18,256 --> 00:32:20,456
我们在每处标记了


1001
00:32:20,716 --> 00:32:21,896
下载的大小


1002
00:32:21,896 --> 00:32:22,386
单位是兆


1003
00:32:22,996 --> 00:32:25,546
我们把他们标成红色


1004
00:32:25,546 --> 00:32:27,576
如果下载大小大于


1005
00:32:27,576 --> 00:32:28,896
3 1/2 MB 的话


1006
00:32:29,656 --> 00:32:31,846
这是我们创建的自定义图像


1007
00:32:31,846 --> 00:32:33,636
是自定义 instrument 的一部分


1008
00:32:33,956 --> 00:32:35,536
现在在下面我们还


1009
00:32:35,536 --> 00:32:36,446
定义了一些细节


1010
00:32:36,536 --> 00:32:38,516
这里有一张非常简洁的


1011
00:32:38,516 --> 00:32:39,716
下载任务表


1012
00:32:39,836 --> 00:32:41,266
并且你可以通过它们


1013
00:32:41,266 --> 00:32:42,516
来浏览轨迹


1014
00:32:43,476 --> 00:32:46,116
我们还有 让我看看


1015
00:32:46,116 --> 00:32:47,796
能不能把它弄回这里来


1016
00:32:47,996 --> 00:32:50,846
我们还有一个对所有下载


1017
00:32:50,846 --> 00:32:51,466
的概要


1018
00:32:51,536 --> 00:32:52,096
非常简单


1019
00:32:52,506 --> 00:32:54,016
我们只想加起来求和


1020
00:32:54,226 --> 00:32:56,136
我们还有个很棒的东西


1021
00:32:56,136 --> 00:32:57,266
叫 Timeslice


1022
00:32:58,026 --> 00:32:59,806
在 Timeslice 视图中


1023
00:33:00,226 --> 00:33:01,746
我们这么做是想要


1024
00:33:01,746 --> 00:33:02,716
回答我之前提出的问题


1025
00:33:02,716 --> 00:33:04,146
这些东西中


1026
00:33:04,146 --> 00:33:05,636
哪些实际上是并行


1027
00:33:05,636 --> 00:33:06,096
运行的


1028
00:33:06,676 --> 00:33:07,656
如果你想看看


1029
00:33:07,656 --> 00:33:08,506
并行运行的


1030
00:33:08,506 --> 00:33:09,736
时间段你只需要


1031
00:33:09,736 --> 00:33:11,876
拖动这里的


1032
00:33:11,876 --> 00:33:13,216
的探头然后你就可以


1033
00:33:13,216 --> 00:33:14,886
看到在任一时间点上


1034
00:33:15,276 --> 00:33:16,976
和该探头相交


1035
00:33:16,976 --> 00:33:18,196
的部分


1036
00:33:18,706 --> 00:33:20,016
所以这是一个很好的


1037
00:33:20,016 --> 00:33:21,556
但不同的检查 signpost 数据


1038
00:33:21,556 --> 00:33:21,746
的方法


1039
00:33:23,036 --> 00:33:24,556
如果你在和别人


1040
00:33:24,556 --> 00:33:26,056
一起做一个项目或者


1041
00:33:26,056 --> 00:33:26,776
你是开发者社区的


1042
00:33:26,776 --> 00:33:28,606
一员那么使用自定义


1043
00:33:28,606 --> 00:33:29,646
instrument 能够很好地


1044
00:33:29,646 --> 00:33:31,606
获取 signpost 数据


1045
00:33:31,606 --> 00:33:33,336
改造它 这样其他人


1046
00:33:33,386 --> 00:33:35,286
就可以直接使用并


1047
00:33:35,286 --> 00:33:36,126
不需要懂得你代码的


1048
00:33:36,126 --> 00:33:37,956
运行细节就能理解


1049
00:33:37,956 --> 00:33:39,216
所以它们是一个非常重要的功能


1050
00:33:39,576 --> 00:33:42,746
好消息是要创建


1051
00:33:42,746 --> 00:33:44,246
这样的一个 instrument


1052
00:33:44,956 --> 00:33:46,926
全部软件包定义


1053
00:33:46,926 --> 00:33:51,636
只有 115 行 XML


1054
00:33:51,716 --> 00:33:53,386
所以自定义 instruments


1055
00:33:53,386 --> 00:33:55,236
非常有表现力和强大


1056
00:33:55,236 --> 00:33:56,506
但又非常简单


1057
00:33:57,466 --> 00:34:00,226
这就是关于我们演示的总结


1058
00:34:01,516 --> 00:34:08,536
[ 掌声 ]


1059
00:34:09,036 --> 00:34:10,666
在今天的会议中


1060
00:34:10,666 --> 00:34:13,065
我们查看了 signpost API


1061
00:34:13,065 --> 00:34:14,545
我们向你们展示了如何用它


1062
00:34:14,896 --> 00:34:16,216
在你 App 中标注


1063
00:34:16,216 --> 00:34:17,536
值得注意的行为


1064
00:34:17,536 --> 00:34:18,235
和时间段


1065
00:34:19,005 --> 00:34:20,126
我们展示了如何收集


1066
00:34:20,126 --> 00:34:21,835
元数据并将元数据


1067
00:34:22,076 --> 00:34:23,065
放入 Instruments 来


1068
00:34:23,065 --> 00:34:24,826
可视化和做分析


1069
00:34:25,406 --> 00:34:27,916
我们展示了如何在


1070
00:34:28,246 --> 00:34:29,755
os_signpost 中合并


1071
00:34:29,755 --> 00:34:32,646
自定义 instrument 来创建


1072
00:34:32,786 --> 00:34:34,856
更好的 signpost 数据展示


1073
00:34:36,056 --> 00:34:38,626
所有的这些总结下来


1074
00:34:38,686 --> 00:34:41,085
就是我们可以给你


1075
00:34:41,085 --> 00:34:42,346
你需要用来


1076
00:34:42,346 --> 00:34:46,106
提升 App 性能的信息


1077
00:34:46,485 --> 00:34:47,856
所以我们很高兴看到


1078
00:34:47,856 --> 00:34:49,946
你使用 os_signpost 和


1079
00:34:49,946 --> 00:34:51,866
Instruments 来一块提升


1080
00:34:51,866 --> 00:34:53,656
你 App 的用户体验


1081
00:34:54,985 --> 00:34:56,576
这就是今天的内容


1082
00:34:57,016 --> 00:34:58,856
想要了解更多信息


1083
00:34:58,856 --> 00:35:00,946
你可以来实验室找我们


1084
00:35:00,946 --> 00:35:03,546
技术实验室 8 今天下午三点


1085
00:35:03,546 --> 00:35:05,896
同时明天我还有会议 410


1086
00:35:05,896 --> 00:35:06,996
创建自定义 instrument


1087
00:35:07,076 --> 00:35:08,876
我会讲讲


1088
00:35:08,876 --> 00:35:10,106
自定义 instrument


1089
00:35:10,106 --> 00:35:11,686
的工作原理并向你们


1090
00:35:11,686 --> 00:35:13,156
展示我们如何创建的 Trailblazer


1091
00:35:13,156 --> 00:35:14,836
networking instrument 包


1092
00:35:15,696 --> 00:35:16,386
非常感谢


1093
00:35:16,386 --> 00:35:17,936
享受剩下的会议吧


1094
00:35:18,516 --> 00:35:24,480
[ 掌声 ]

